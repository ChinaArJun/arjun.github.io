(window.webpackJsonp=window.webpackJsonp||[]).push([[212],{648:function(t,a,e){"use strict";e.r(a);var n=e(44),r=Object(n.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"_3-19-golang-交叉编译"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-19-golang-交叉编译"}},[t._v("#")]),t._v(" 3.19 Golang 交叉编译")]),t._v(" "),e("p",[t._v("项目地址：https://github.com/EDDYCJY/go-gin-example")]),t._v(" "),e("h2",{attrs:{id:"知识点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#知识点"}},[t._v("#")]),t._v(" 知识点")]),t._v(" "),e("ul",[e("li",[t._v("跨平台编译")])]),t._v(" "),e("h2",{attrs:{id:"本文目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本文目标"}},[t._v("#")]),t._v(" 本文目标")]),t._v(" "),e("p",[t._v("在 "),e("a",{attrs:{href:"https://segmentfault.com/a/1190000013960558",target:"_blank",rel:"noopener noreferrer"}},[t._v("连载九"),e("OutboundLink")],1),t._v(" 讲解"),e("strong",[t._v("构建Scratch镜像")]),t._v("时，我们编译可执行文件用了另外一个形式的命令，如下：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o go-gin-example .\n")])])]),e("p",[t._v("我想你可能会有疑问，今天本文会针对这块进行讲解。")]),t._v(" "),e("h2",{attrs:{id:"说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[t._v("#")]),t._v(" 说明")]),t._v(" "),e("p",[t._v("我们将讲解命令各个参数的作用，希望你在阅读时，将每一项串联起来，你会发现这就是"),e("strong",[t._v("交叉编译相关的小知识")])]),t._v(" "),e("p",[t._v("也就是 "),e("code",[t._v("Golang")]),t._v(" 令人心动的特性之一"),e("strong",[t._v("跨平台编译")])]),t._v(" "),e("h3",{attrs:{id:"一、cgo-enabled"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、cgo-enabled"}},[t._v("#")]),t._v(" 一、CGO_ENABLED")]),t._v(" "),e("p",[e("strong",[t._v("作用：")])]),t._v(" "),e("p",[t._v("用于标识（声明） "),e("code",[t._v("cgo")]),t._v(" 工具是否可用")]),t._v(" "),e("p",[e("strong",[t._v("意义：")])]),t._v(" "),e("p",[t._v("存在交叉编译的情况时，"),e("code",[t._v("cgo")]),t._v(" 工具是不可用的。在标准go命令的上下文环境中，交叉编译意味着程序构建环境的目标计算架构的标识与程序运行环境的目标计算架构的标识不同，或者程序构建环境的目标操作系统的标识与程序运行环境的目标操作系统的标识不同")]),t._v(" "),e("p",[e("strong",[t._v("小结：")])]),t._v(" "),e("p",[t._v("结合案例来说，我们是在宿主机编译的可执行文件，而在 "),e("code",[t._v("Scratch")]),t._v(" 镜像运行的可执行文件；显然两者的计算机架构、运行环境标识你无法确定它是否一致（毕竟构建的 "),e("code",[t._v("docker")]),t._v(" 镜像还可以给他人使用），那么我们就要进行交叉编译，而交叉编译不支持 "),e("code",[t._v("cgo")]),t._v("，因此这里要禁用掉它")]),t._v(" "),e("p",[t._v("关闭 "),e("code",[t._v("cgo")]),t._v(" 后，在构建过程中会忽略 "),e("code",[t._v("cgo")]),t._v(" 并静态链接所有的依赖库，而开启 "),e("code",[t._v("cgo")]),t._v(" 后，方式将转为动态链接")]),t._v(" "),e("p",[e("strong",[t._v("补充：")])]),t._v(" "),e("p",[e("code",[t._v("golang")]),t._v(" 是默认开启 "),e("code",[t._v("cgo")]),t._v(" 工具的，可执行 "),e("code",[t._v("go env")]),t._v(" 命令查看")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('$ go env\nGOARCH="amd64"\nGOBIN=""\nGOCACHE="/root/.cache/go-build"\nGOEXE=""\nGOHOSTARCH="amd64"\nGOHOSTOS="linux"\nGOOS="linux"\n...\nGCCGO="gccgo"\nCC="gcc"\nCXX="g++"\nCGO_ENABLED="1"\n...\n')])])]),e("h3",{attrs:{id:"二、goos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、goos"}},[t._v("#")]),t._v(" 二、GOOS")]),t._v(" "),e("p",[t._v("用于标识（声明）程序构建环境的目标操作系统")]),t._v(" "),e("p",[t._v("如：")]),t._v(" "),e("ul",[e("li",[t._v("linux")]),t._v(" "),e("li",[t._v("windows")])]),t._v(" "),e("h3",{attrs:{id:"三、goarch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、goarch"}},[t._v("#")]),t._v(" 三、GOARCH")]),t._v(" "),e("p",[t._v("用于标识（声明）程序构建环境的目标计算架构")]),t._v(" "),e("p",[t._v("若不设置，默认值与程序运行环境的目标计算架构一致（案例就是采用的默认值）")]),t._v(" "),e("p",[t._v("如：")]),t._v(" "),e("ul",[e("li",[t._v("amd64")]),t._v(" "),e("li",[t._v("386")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("系统")]),t._v(" "),e("th",[t._v("GOOS")]),t._v(" "),e("th",[t._v("GOARCH")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("Windows 32位")]),t._v(" "),e("td",[t._v("windows")]),t._v(" "),e("td",[t._v("386")])]),t._v(" "),e("tr",[e("td",[t._v("Windows 64位")]),t._v(" "),e("td",[t._v("windows")]),t._v(" "),e("td",[t._v("amd64")])]),t._v(" "),e("tr",[e("td",[t._v("OS X 32位")]),t._v(" "),e("td",[t._v("darwin")]),t._v(" "),e("td",[t._v("386")])]),t._v(" "),e("tr",[e("td",[t._v("OS X 64位")]),t._v(" "),e("td",[t._v("darwin")]),t._v(" "),e("td",[t._v("amd64")])]),t._v(" "),e("tr",[e("td",[t._v("Linux 32位")]),t._v(" "),e("td",[t._v("linux")]),t._v(" "),e("td",[t._v("386")])]),t._v(" "),e("tr",[e("td",[t._v("Linux 64位")]),t._v(" "),e("td",[t._v("linux")]),t._v(" "),e("td",[t._v("amd64")])])])]),t._v(" "),e("h3",{attrs:{id:"四、gohostos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、gohostos"}},[t._v("#")]),t._v(" 四、GOHOSTOS")]),t._v(" "),e("p",[t._v("用于标识（声明）程序运行环境的目标操作系统")]),t._v(" "),e("h3",{attrs:{id:"五、gohostarch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五、gohostarch"}},[t._v("#")]),t._v(" 五、GOHOSTARCH")]),t._v(" "),e("p",[t._v("用于标识（声明）程序运行环境的目标计算架构")]),t._v(" "),e("h3",{attrs:{id:"六、go-build"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#六、go-build"}},[t._v("#")]),t._v(" 六、go build")]),t._v(" "),e("h4",{attrs:{id:"a"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a"}},[t._v("#")]),t._v(" -a")]),t._v(" "),e("p",[t._v("强制重新编译，简单来说，就是不利用缓存或已编译好的部分文件，直接所有包都是最新的代码重新编译和关联")]),t._v(" "),e("h4",{attrs:{id:"installsuffix"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#installsuffix"}},[t._v("#")]),t._v(" -installsuffix")]),t._v(" "),e("p",[e("strong",[t._v("作用：")])]),t._v(" "),e("p",[t._v("在软件包安装的目录中"),e("strong",[t._v("增加后缀标识")]),t._v("，以保持输出与默认版本分开")]),t._v(" "),e("p",[e("strong",[t._v("补充：")])]),t._v(" "),e("p",[t._v("如果使用 "),e("code",[t._v("-race")]),t._v(" 标识，则后缀就会默认设置为 "),e("code",[t._v("-race")]),t._v(" 标识，用于区别 "),e("code",[t._v("race")]),t._v(" 和普通的版本")]),t._v(" "),e("h4",{attrs:{id:"o"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#o"}},[t._v("#")]),t._v(" -o")]),t._v(" "),e("p",[t._v("指定编译后的可执行文件名称")]),t._v(" "),e("h3",{attrs:{id:"小结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),e("p",[t._v("大部分参数指令，都有一定关联性，且与交叉编译的知识点相关，可以好好品味一下")]),t._v(" "),e("p",[t._v("最后可以看看 "),e("code",[t._v("go build help")]),t._v(" 加深了解")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ go help build\nusage: go build [-o output] [-i] [build flags] [packages]\n...\n\t-a\n\t\tforce rebuilding of packages that are already up-to-date.\n\t-n\n\t\tprint the commands but do not run them.\n\t-p n\n\t\tthe number of programs, such as build commands or\n\t\ttest binaries, that can be run in parallel.\n\t\tThe default is the number of CPUs available.\n\t-race\n\t\tenable data race detection.\n\t\tSupported only on linux/amd64, freebsd/amd64, darwin/amd64 and windows/amd64.\n\t-msan\n\t\tenable interoperation with memory sanitizer.\n\t\tSupported only on linux/amd64,\n\t\tand only with Clang/LLVM as the host C compiler.\n\t-v\n\t\tprint the names of packages as they are compiled.\n\t-work\n\t\tprint the name of the temporary work directory and\n\t\tdo not delete it when exiting.\n\t-x\n\t\tprint the commands.\n\n\t-asmflags '[pattern=]arg list'\n\t\targuments to pass on each go tool asm invocation.\n\t-buildmode mode\n\t\tbuild mode to use. See 'go help buildmode' for more.\n\t-compiler name\n\t\tname of compiler to use, as in runtime.Compiler (gccgo or gc).\n\t-gccgoflags '[pattern=]arg list'\n\t\targuments to pass on each gccgo compiler/linker invocation.\n\t-gcflags '[pattern=]arg list'\n\t\targuments to pass on each go tool compile invocation.\n\t-installsuffix suffix\n\t\ta suffix to use in the name of the package installation directory,\n\t\tin order to keep output separate from default builds.\n\t\tIf using the -race flag, the install suffix is automatically set to race\n\t\tor, if set explicitly, has _race appended to it. Likewise for the -msan\n\t\tflag. Using a -buildmode option that requires non-default compile flags\n\t\thas a similar effect.\n\t-ldflags '[pattern=]arg list'\n\t\targuments to pass on each go tool link invocation.\n\t-linkshared\n\t\tlink against shared libraries previously created with\n\t\t-buildmode=shared.\n\t-pkgdir dir\n\t\tinstall and load all packages from dir instead of the usual locations.\n\t\tFor example, when building with a non-standard configuration,\n\t\tuse -pkgdir to keep generated packages in a separate location.\n\t-tags 'tag list'\n\t\ta space-separated list of build tags to consider satisfied during the\n\t\tbuild. For more information about build tags, see the description of\n\t\tbuild constraints in the documentation for the go/build package.\n\t-toolexec 'cmd args'\n\t\ta program to use to invoke toolchain programs like vet and asm.\n\t\tFor example, instead of running asm, the go command will run\n\t\t'cmd args /path/to/asm <arguments for asm>'.\n...\n")])])]),e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),e("h3",{attrs:{id:"本系列示例代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本系列示例代码"}},[t._v("#")]),t._v(" 本系列示例代码")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/EDDYCJY/go-gin-example",target:"_blank",rel:"noopener noreferrer"}},[t._v("go-gin-example"),e("OutboundLink")],1)])]),t._v(" "),e("h3",{attrs:{id:"书籍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#书籍"}},[t._v("#")]),t._v(" 书籍")]),t._v(" "),e("ul",[e("li",[t._v("Go并发编程实战 第二版")])]),t._v(" "),e("h2",{attrs:{id:"关于"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关于"}},[t._v("#")]),t._v(" 关于")]),t._v(" "),e("h3",{attrs:{id:"修改记录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改记录"}},[t._v("#")]),t._v(" 修改记录")]),t._v(" "),e("ul",[e("li",[t._v("第一版：2018年02月16日发布文章")]),t._v(" "),e("li",[t._v("第二版：2019年10月01日修改文章")])]),t._v(" "),e("h2",{attrs:{id:"？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#？"}},[t._v("#")]),t._v(" ？")]),t._v(" "),e("p",[t._v("如果有任何疑问或错误，欢迎在 "),e("a",{attrs:{href:"https://github.com/EDDYCJY/blog",target:"_blank",rel:"noopener noreferrer"}},[t._v("issues"),e("OutboundLink")],1),t._v(" 进行提问或给予修正意见，如果喜欢或对你有所帮助，欢迎 Star，对作者是一种鼓励和推进。")]),t._v(" "),e("h3",{attrs:{id:"我的公众号"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#我的公众号"}},[t._v("#")]),t._v(" 我的公众号")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://image.eddycjy.com/8d0b0c3a11e74efd5fdfd7910257e70b.jpg",alt:"image"}})])])}),[],!1,null,null,null);a.default=r.exports}}]);