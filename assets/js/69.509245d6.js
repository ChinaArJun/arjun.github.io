(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{507:function(t,s,a){"use strict";a.r(s);var e=a(44),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_7-solo多机多节点部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-solo多机多节点部署"}},[t._v("#")]),t._v(" 7. Solo多机多节点部署")]),t._v(" "),a("h3",{attrs:{id:"_7-1-准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-准备工作"}},[t._v("#")]),t._v(" 7.1. 准备工作")]),t._v(" "),a("p",[t._v("所有的节点分离部署, 每台主机上有一个节点, 节点的分布如下表:")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("名称")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("IP")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Hostname")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("组织机构")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("orderer")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.247.129")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("orderer.itcast.com")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Orderer")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("peer0")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.247.141")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("peer0.orggo.com")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("OrgGo")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("peer1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.247.142")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("peer1.orggo.com")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("OrgGo")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("peer0")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.247.131")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("peer0.orgcpp.com")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("OrgCpp")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("peer1")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("192.168.247.145")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("peer1.orgcpp.com")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("OrgCpp")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("下面的操作在任意一台主机上做都可以, 下面的例子中, 生成证书和创始块、通道文件操作是在 "),a("code",[t._v("Orderer节点")]),t._v("对应的主机上进行的。")])]),t._v(" "),a("h4",{attrs:{id:"_7-1-1-准备工作-创建工作目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-1-准备工作-创建工作目录"}},[t._v("#")]),t._v(" 7.1.1 准备工作 - 创建工作目录")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# N台主机需要创建一个名字相同的工作目录, 该工作目录名字自己定, 切记名字一定要相同")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 192.168.247.129")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" ~/testwork\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 192.168.247.141")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" ~/testwork\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 192.168.247.131")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" ~/testwork\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 192.168.247.142")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" ~/testwork\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 192.168.247.145")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" ~/testwork\n")])])]),a("h4",{attrs:{id:"_7-1-2-生成组织节点和用户证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-2-生成组织节点和用户证书"}},[t._v("#")]),t._v(" 7.1.2 生成组织节点和用户证书")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("编写配置文件")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# crypto-config.yaml -> 名字可以改, 一般起名为crypto-config.yaml")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OrdererOrgs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ---------------------------------------------------------------------------")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Orderer")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ---------------------------------------------------------------------------")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Orderer\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Domain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Specs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" orderer\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PeerOrgs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ---------------------------------------------------------------------------")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Org1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ---------------------------------------------------------------------------")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" OrgGo\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Domain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" orggo.test.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("EnableNodeOUs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Users")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ---------------------------------------------------------------------------")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Org2: See "Org1" for full specification')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ---------------------------------------------------------------------------")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" OrgCpp\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Domain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" orgcpp.test.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("EnableNodeOUs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Users")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("使用"),a("code",[t._v("cryptogen")]),t._v("生成证书")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ cryptogen generate --config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("crypto-config.yaml\n")])])])])]),t._v(" "),a("h4",{attrs:{id:"_7-1-3-生成通道文件和创始块文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-3-生成通道文件和创始块文件"}},[t._v("#")]),t._v(" 7.1.3 生成通道文件和创始块文件")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("编写配置文件, 名字为 "),a("code",[t._v("configtx.yaml")]),t._v(", 该名字不能改, 是固定的.")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# configtx.yaml -> 名字不能变")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("################################################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   Section: Organizations")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("################################################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Organizations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("&OrdererOrg")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" OrdererOrg\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" OrdererMSP\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MSPDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config/ordererOrganizations/test.com/msp\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("&OrgGo")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" OrgGoMSP\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" OrgGoMSP\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MSPDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config/peerOrganizations/orggo.test.com/msp\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AnchorPeers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" peer0.orggo.test.com\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("&OrgCpp")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" OrgCppMSP\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" OrgCppMSP\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MSPDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config/peerOrganizations/orgcpp.test.com/msp\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AnchorPeers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" peer0.orgcpp.test.com\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("################################################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   SECTION: Capabilities")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("################################################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Capabilities")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("&ChannelCapabilities")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("V1_1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Orderer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("&OrdererCapabilities")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("V1_1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("&ApplicationCapabilities")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("V1_2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("################################################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   SECTION: Application")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("################################################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("&ApplicationDefaults")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Organizations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("################################################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   SECTION: Orderer")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("################################################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Orderer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("&OrdererDefaults")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Available types are "solo" and "kafka"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OrdererType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" solo\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Addresses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" orderer.test.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7050")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BatchTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 2s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BatchSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MaxMessageCount")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("AbsoluteMaxBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 99 MB\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("PreferredMaxBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 512 KB\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Kafka")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Brokers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9092")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Organizations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("################################################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   Profile")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("################################################################################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Profiles")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TwoOrgsOrdererGenesis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Capabilities")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*ChannelCapabilities")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Orderer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*OrdererDefaults")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Organizations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*OrdererOrg")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Capabilities")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*OrdererCapabilities")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Consortiums")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SampleConsortium")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Organizations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*OrgGo")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*OrgCpp")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TwoOrgsChannel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Consortium")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SampleConsortium\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*ApplicationDefaults")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Organizations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*OrgGo")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*OrgCpp")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Capabilities")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[t._v("*ApplicationCapabilities")]),t._v("              \n")])])])]),t._v(" "),a("li",[a("p",[t._v("通过命令"),a("code",[t._v("configtxgen")]),t._v("生成创始块和通道文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 我们先创建一个目录 channel-artifacts 存储生成的文件, 目的是为了和后边的配置文件模板的配置项保持一致")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" channel-artifacts\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成通道文件")]),t._v("\n$ configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成创始块文件")]),t._v("\n$ configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID testchannel\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"_7-2-部署-orderer-排序节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-部署-orderer-排序节点"}},[t._v("#")]),t._v(" 7.2 部署 orderer 排序节点")]),t._v(" "),a("h4",{attrs:{id:"_7-2-1-编写配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-1-编写配置文件"}},[t._v("#")]),t._v(" 7.2.1 编写配置文件")]),t._v(" "),a("blockquote",[a("p",[t._v("编写启动"),a("code",[t._v("orderer")]),t._v("节点容器使用的配置文件 - "),a("code",[t._v("docker-compose.yaml")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("orderer.test.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" orderer.test.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hyperledger/fabric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("orderer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=testwork_default\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ORDERER_GENERAL_LOGLEVEL=INFO\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ORDERER_GENERAL_LISTENADDRESS=0.0.0.0\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ORDERER_GENERAL_LISTENPORT=7050\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ORDERER_GENERAL_GENESISMETHOD=file\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ORDERER_GENERAL_LOCALMSPID=OrdererMSP\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# enabled TLS")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ORDERER_GENERAL_TLS_ENABLED=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ORDERER_GENERAL_TLS_ROOTCAS="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("/var/hyperledger/orderer/tls/ca.crt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working_dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /opt/gopath/src/github.com/hyperledger/fabric\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" orderer\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("artifacts/genesis.block"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/hyperledger/orderer/orderer.genesis.block\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config/ordererOrganizations/test.com/orderers/orderer.test.com/msp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/hyperledger/orderer/msp\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config/ordererOrganizations/test.com/orderers/orderer.test.com/tls/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/hyperledger/orderer/tls\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("aliases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" testwork\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7050"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7050")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("注意的细节:")]),t._v(" "),a("ul",[a("li",[t._v("环境变量"),a("code",[t._v("CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=testwork_default")]),t._v("的名字是"),a("code",[t._v("当前目录名_default")])])])]),t._v(" "),a("h4",{attrs:{id:"_7-2-2-启动orderer容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-2-启动orderer容器"}},[t._v("#")]),t._v(" 7.2.2 启动orderer容器")]),t._v(" "),a("blockquote",[a("p",[t._v("通过上面编写好的docker-compose配置文件就可以启动"),a("code",[t._v("orderer")]),t._v("容器了")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ docker-compose up -d\nCreating network "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testwork_default"')]),t._v(" with the default driver\nCreating orderer.test.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检测是否启动成功")]),t._v("\n$ docker-compose  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n      Name         Command   State           Ports         \n-----------------------------------------------------------\norderer.test.com   orderer   Up      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:7050-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7050")]),t._v("/tcp\n")])])]),a("h3",{attrs:{id:"_7-3-部署-peer0-orggo-节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-部署-peer0-orggo-节点"}},[t._v("#")]),t._v(" 7.3 部署 peer0.orggo 节点")]),t._v(" "),a("h4",{attrs:{id:"_7-3-1-准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-1-准备工作"}},[t._v("#")]),t._v(" 7.3.1 准备工作")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("切换到"),a("code",[t._v("peer0.orggo")]),t._v("主机 - "),a("code",[t._v("192.168.247.141")])])]),t._v(" "),a("li",[a("p",[t._v("进入到工作目录中:")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/testwork\n")])])])]),t._v(" "),a("li",[a("p",[t._v("拷贝文件")]),t._v(" "),a("blockquote",[a("p",[t._v("将"),a("code",[t._v("orderer")]),t._v("节点所在宿主机上生成的"),a("code",[t._v("crypto-config")]),t._v("和"),a("code",[t._v("channel-artifacts")]),t._v("目录拷贝到当前"),a("code",[t._v("testwork")]),t._v("目录中。")]),t._v(" "),a("p",[t._v("我们可以通过"),a("code",[t._v("scp")]),t._v("命令实现远程拷贝, 从"),a("code",[t._v("orderer")]),t._v("节点宿主机拷贝到当前"),a("code",[t._v("peer0.orggo")]),t._v("节点.")]),t._v(" "),a("ul",[a("li",[t._v("orderer节点宿主机"),a("code",[t._v("IP: 192.168.247.129")]),t._v(", 登录用户名: "),a("code",[t._v("itcast")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 通过scp命令远程拷贝")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -r : 表示要拷贝的是目录, 执行递归操作")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# itcast@192.168.247.129:/home/itcast/testwork/channel-artifacts")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# \titcast@192.168.247.129: 从192.168.247.129上拷贝数据, 登录用户名为itcast")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   /home/itcast/testwork/channel-artifacts: 要拷贝192.168.247.129上itcast用户的哪个目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   ./ : 远程目录拷贝到本地的什么地方")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" -r itcast@192.168.247.129:/home/itcast/testwork/channel-artifacts  ./\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" -r itcast@192.168.247.129:/home/itcast/testwork/crypto-config  ./\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看拷贝结果")]),t._v("\n$ tree ./ -L "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n├── channel-artifacts\n└── crypto-config\n")])])])])]),t._v(" "),a("h4",{attrs:{id:"_7-3-2-编写-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-2-编写-配置文件"}},[t._v("#")]),t._v(" 7.3.2 编写 配置文件")]),t._v(" "),a("blockquote",[a("p",[t._v("编写启动 "),a("code",[t._v("peer0-orggo")]),t._v("节点的配置文件 - "),a("code",[t._v("docker-compose.yaml")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose.yaml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("peer0.orggo.test.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" peer0.orggo.test.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hyperledger/fabric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("peer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_VM_ENDPOINT=unix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("///host/var/run/docker.sock\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=testwork_default\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_LOGGING_LEVEL=INFO\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#- CORE_LOGGING_LEVEL=DEBUG")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_GOSSIP_USELEADERELECTION=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_GOSSIP_ORGLEADER=false\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_PROFILE_ENABLED=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_LOCALMSPID=OrgGoMSP\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_ID=peer0.orggo.test.com\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_ADDRESS=peer0.orggo.test.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_GOSSIP_BOOTSTRAP=peer0.orggo.test.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.orggo.test.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TLS")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_ENABLED=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/run/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/host/var/run/\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config/peerOrganizations/orggo.test.com/peers/peer0.orggo.test.com/msp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/hyperledger/fabric/msp\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config/peerOrganizations/orggo.test.com/peers/peer0.orggo.test.com/tls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/hyperledger/fabric/tls\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working_dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /opt/gopath/src/github.com/hyperledger/fabric/peer\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" peer node start\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("aliases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" testwork\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7051"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7053"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7053")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("extra_hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 声明域名和IP的对应关系")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orderer.test.com:192.168.247.129"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"peer0.orgcpp.test.com:192.168.247.131"')]),t._v("\n      \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cli")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cli\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hyperledger/fabric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tools"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stdin_open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GOPATH=/opt/gopath\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_VM_ENDPOINT=unix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("///host/var/run/docker.sock\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#- CORE_LOGGING_LEVEL=DEBUG")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_LOGGING_LEVEL=INFO\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_ID=cli\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_ADDRESS=peer0.orggo.test.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_LOCALMSPID=OrgGoMSP\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_ENABLED=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/orggo.test.com/peers/peer0.orggo.test.com/tls/server.crt\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/orggo.test.com/peers/peer0.orggo.test.com/tls/server.key\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/orggo.test.com/peers/peer0.orggo.test.com/tls/ca.crt\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/orggo.test.com/users/Admin@orggo.test.com/msp\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working_dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /opt/gopath/src/github.com/hyperledger/fabric/peer\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /bin/bash\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/run/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/host/var/run/\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./chaincode/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/gopath/src/github.com/chaincode\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("artifacts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/gopath/src/github.com/hyperledger/fabric/peer/channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("artifacts\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动顺序")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" peer0.orggo.test.com\n    \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("aliases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" testwork\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("extra_hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orderer.test.com:192.168.247.129"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"peer0.orggo.test.com:192.168.247.141"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"peer0.orgcpp.test.com:192.168.247.131"')]),t._v("   \n")])])]),a("h4",{attrs:{id:"_7-3-3-启动容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-3-启动容器"}},[t._v("#")]),t._v(" 7.3.3 启动容器")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("启动容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ docker-compose up -d\nCreating network "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testwork_default"')]),t._v(" with the default driver\nCreating peer0.orgGo.test.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nCreating cli                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看启动状态")]),t._v("\n$ docker-compose "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n        Name               Command       State                       Ports                     \n-----------------------------------------------------------------------------------------------\ncli                    /bin/bash         Up                                                    \npeer0.orgGo.test.com   peer node start   Up      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:7051-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:7053-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7053")]),t._v("/tcp\n")])])])])]),t._v(" "),a("h4",{attrs:{id:"_7-3-4-对peer0-orggo节点的操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-4-对peer0-orggo节点的操作"}},[t._v("#")]),t._v(" 7.3.4 对peer0.orggo节点的操作")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("进入到客户端容器中")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it cli "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("创建通道")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ peer channel create -o orderer.test.com:7050 -c testchannel -f ./channel-artifacts/channel.tx --tls "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/test.com/msp/tlscacerts/tlsca.test.com-cert.pem\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nchannel-artifacts  crypto  "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("testchannel.block"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("  --"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" 生成的通道块文件\n")])])])]),t._v(" "),a("li",[a("p",[t._v("将当前节点加入到通道中")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ peer channel "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" -b testchannel.block\n")])])])]),t._v(" "),a("li",[a("p",[t._v("安装链码")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ peer chaincode "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -n testcc -v "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v(" -l golang -p github.com/chaincode\n")])])])]),t._v(" "),a("li",[a("p",[t._v("初始化链码")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ peer chaincode instantiate -o orderer.test.com:7050 --tls "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/test.com/msp/tlscacerts/tlsca.test.com-cert.pem -C testchannel -n testcc -v "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v(" -l golang -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"Args":["init","a","100","b","200"]}\'')]),t._v(" -P "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"AND ('OrgGoMSP.member', 'OrgCppMSP.member')\"")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("查询")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ peer chaincode query -C testchannel -n testcc -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"Args":["query","a"]}\'')]),t._v("\n$ peer chaincode query -C testchannel -n testcc -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"Args":["query","b"]}\'')]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("将生成的通道文件 "),a("code",[t._v("testchannel.block")]),t._v(" 从cli容器拷贝到宿主机")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从客户端容器退出到宿主机")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exit")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拷贝操作要在宿主机中进行")]),t._v("\n$ docker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" cli:/opt/gopath/src/github.com/hyperledger/fabric/peer/testchannel.block ./\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"_7-4-部署-peer0-orgcpp-节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-部署-peer0-orgcpp-节点"}},[t._v("#")]),t._v(" 7.4 部署 peer0.orgcpp 节点")]),t._v(" "),a("h4",{attrs:{id:"_7-4-1-准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-1-准备工作"}},[t._v("#")]),t._v(" 7.4.1 准备工作")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("切换到"),a("code",[t._v("peer0.orgcpp")]),t._v("主机 - "),a("code",[t._v("192.168.247.131")])])]),t._v(" "),a("li",[a("p",[t._v("进入到工作目录")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~/testwork\n")])])])]),t._v(" "),a("li",[a("p",[t._v("远程拷贝文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从主机192.168.247.141的zoro用户下拷贝目录crypto-config到当前目录下")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" -r zoro@192.168.247.141:/home/zoro/testwork/crypto-config  ./\t\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 链码拷贝")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" -r zoro@192.168.247.141:/home/zoro/testwork/chaincode  ./\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从主机192.168.247.141的zoro用户下拷贝文件testchannel.block到当前目录下")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scp")]),t._v(" zoro@192.168.247.141:/home/zoro/testwork/testchannel.block  ./\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看结果")]),t._v("\n$ tree ./ -L "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n./\n├── chaincode\n├── crypto-config\n└── testchannel.block\n")])])])]),t._v(" "),a("li",[a("p",[t._v("为了方便操作可以将"),a("code",[t._v("通道块文件")]),t._v("放入到客户端容器挂载的目录中")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建目录")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" channel-artifacts  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 移动")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" testchannel.block channel-artifacts/\n")])])])])]),t._v(" "),a("h4",{attrs:{id:"_7-4-2-编写配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-2-编写配置文件"}},[t._v("#")]),t._v(" 7.4.2 编写配置文件")]),t._v(" "),a("blockquote",[a("p",[t._v("编写启动"),a("code",[t._v("peer0.orgcpp")]),t._v("节点的配置文件 "),a("code",[t._v("docker-compose.yaml")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose.yaml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("peer0.orgcpp.test.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" peer0.orgcpp.test.com\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hyperledger/fabric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("peer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_VM_ENDPOINT=unix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("///host/var/run/docker.sock\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=testwork_default\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_LOGGING_LEVEL=INFO\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#- CORE_LOGGING_LEVEL=DEBUG")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_GOSSIP_USELEADERELECTION=true\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_GOSSIP_ORGLEADER=false\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_PROFILE_ENABLED=true\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_LOCALMSPID=OrgCppMSP\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_ID=peer0.orgcpp.test.com\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_ADDRESS=peer0.orgcpp.test.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_GOSSIP_BOOTSTRAP=peer0.orgcpp.test.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.orgcpp.test.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TLS")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_ENABLED=true\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/run/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/host/var/run/\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config/peerOrganizations/orgcpp.test.com/peers/peer0.orgcpp.test.com/msp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/hyperledger/fabric/msp\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config/peerOrganizations/orgcpp.test.com/peers/peer0.orgcpp.test.com/tls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/hyperledger/fabric/tls\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working_dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /opt/gopath/src/github.com/hyperledger/fabric/peer\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" peer node start\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("aliases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" testwork\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7051"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7053"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7053")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("extra_hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 声明域名和IP的对应关系")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orderer.test.com:192.168.247.129"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"peer0.orggo.test.com:192.168.247.141"')]),t._v("\n        \n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cli")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cli\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hyperledger/fabric"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tools"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stdin_open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" GOPATH=/opt/gopath\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_VM_ENDPOINT=unix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("///host/var/run/docker.sock\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#- CORE_LOGGING_LEVEL=DEBUG")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_LOGGING_LEVEL=INFO\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_ID=cli\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_ADDRESS=peer0.orgcpp.test.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_LOCALMSPID=OrgCppMSP\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_ENABLED=true\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/orgcpp.test.com/peers/peer0.orgcpp.test.com/tls/server.crt\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/orgcpp.test.com/peers/peer0.orgcpp.test.com/tls/server.key\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/orgcpp.test.com/peers/peer0.orgcpp.test.com/tls/ca.crt\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/orgcpp.test.com/users/Admin@orgcpp.test.com/msp\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working_dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /opt/gopath/src/github.com/hyperledger/fabric/peer\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /bin/bash\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/run/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/host/var/run/\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./chaincode/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/gopath/src/github.com/chaincode\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("artifacts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/gopath/src/github.com/hyperledger/fabric/peer/channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("artifacts\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动顺序")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" peer0.orgcpp.test.com\n      \n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("aliases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" testwork\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("extra_hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orderer.test.com:192.168.247.129"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"peer0.orggo.test.com:192.168.247.141"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"peer0.orgcpp.test.com:192.168.247.131"')]),t._v(" \n")])])]),a("blockquote",[a("p",[a("font",{attrs:{color:"red"}},[t._v("注意: 该配置文件中已经将"),a("code"),t._v(" 映射删掉了")])],1)]),t._v(" "),a("h4",{attrs:{id:"_7-4-3-启动当前节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-3-启动当前节点"}},[t._v("#")]),t._v(" 7.4.3 启动当前节点")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("启动客户端容器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ docker-compose up -d\nCreating network "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testwork_default"')]),t._v(" with the default driver\nCreating peer0.orgcpp.test.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nCreating cli                   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看启动情况")]),t._v("\n$ docker-compose "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n        Name                Command       State                       Ports                     \n------------------------------------------------------------------------------------------------\ncli                     /bin/bash         Up                                                    \npeer0.orgcpp.test.com   peer node start   Up      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:7051-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7051")]),t._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:7053-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7053")]),t._v("/tcp\n")])])])])]),t._v(" "),a("h4",{attrs:{id:"_7-4-4-对peer0-orgcpp节点的操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-4-对peer0-orgcpp节点的操作"}},[t._v("#")]),t._v(" 7.4.4 对peer0.orgcpp节点的操作")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("进入到操作该节点的客户端中")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it cli "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("加入到通道中")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ peer channel "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),t._v(" -b ./channel-artifacts/testchannel.block \n")])])])]),t._v(" "),a("li",[a("p",[t._v("安装链码")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ peer chaincode "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -n testcc -v "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v(" -l golang -p github.com/chaincode\n")])])])]),t._v(" "),a("li",[a("p",[t._v("查询")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ peer chaincode query -C testchannel -n testcc -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"Args":["query","a"]}\'')]),t._v(" \n$ peer chaincode query -C testchannel -n testcc -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"Args":["query","b"]}\'')]),t._v(" \n")])])])]),t._v(" "),a("li",[a("p",[t._v("交易")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 转账")]),t._v("\n$ peer chaincode invoke -o orderer.test.com:7050  -C testchannel -n testcc --tls "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/test.com/orderers/orderer.test.com/msp/tlscacerts/tlsca.test.com-cert.pem --peerAddresses peer0.orgGo.test.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/orgGo.test.com/peers/peer0.orgGo.test.com/tls/ca.crt --peerAddresses peer0.orgcpp.test.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/orgcpp.test.com/peers/peer0.orgcpp.test.com/tls/ca.crt -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"Args":["invoke","a","b","10"]}\'')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查询")]),t._v("\n$ peer chaincode query -C testchannel -n testcc -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"Args":["query","a"]}\'')]),t._v(" \n$ peer chaincode query -C testchannel -n testcc -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"Args":["query","b"]}\'')]),t._v(" \n")])])])])]),t._v(" "),a("h3",{attrs:{id:"_7-5-其余节点的部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-5-其余节点的部署"}},[t._v("#")]),t._v(" 7.5. 其余节点的部署")]),t._v(" "),a("blockquote",[a("p",[t._v("关于其余节点的部署, 在此不再过多赘述, 部署方式请参考 第 7.4节内容, 步骤是完全一样的")])]),t._v(" "),a("h3",{attrs:{id:"_7-6-链码的打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-6-链码的打包"}},[t._v("#")]),t._v(" 7.6. 链码的打包")]),t._v(" "),a("blockquote",[a("p",[t._v("我们在进行多机多节点部署的时候, 所有的peer节点都需要安装链码, 有时候会出现链码安装失败的问题, 提示链码的指纹（哈希）不匹配，我们可以通过以下方法解决")])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("通过客户端在第1个peer节点中安装好链码之后， 将链码打包")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ peer chaincode package -n testcc -p github.com/chaincode -v "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v(" mycc.1.0.out\n\t-n: 链码的名字\n\t-p: 链码的路径\n\t-v: 链码的版本号\n\t-mycc.1.0.out: 打包之后生成的文件\n")])])])]),t._v(" "),a("li",[a("p",[t._v("将打包之后的链码从容器中拷贝出来")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ docker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" cli:/xxxx/mycc.1.0.out ./\n")])])])]),t._v(" "),a("li",[a("p",[t._v("将得到的打包之后的链码文件拷贝到其他的peer节点上")])]),t._v(" "),a("li",[a("p",[t._v("通过客户端在其他peer节点上安装链码")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ peer chaincode "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" mycc.1.0.out\n")])])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);