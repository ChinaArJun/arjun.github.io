(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{514:function(s,t,n){"use strict";n.r(t);var a=n(44),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("DOCKER")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/dockerlogo.jpg",alt:"dockerlogo"}})]),s._v(" "),n("h1",{attrs:{id:"第-1-章-docker基础"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第-1-章-docker基础"}},[s._v("#")]),s._v(" 第 1 章 Docker基础")]),s._v(" "),n("h2",{attrs:{id:"_1-1-docker简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-docker简介"}},[s._v("#")]),s._v(" 1.1 docker简介")]),s._v(" "),n("p",[s._v("在这一部分我们主要讲两个方面：\ndocker是什么、docker特点")]),s._v(" "),n("h3",{attrs:{id:"_1-1-1-docker是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-docker是什么"}},[s._v("#")]),s._v(" 1.1.1 docker是什么")]),s._v(" "),n("h4",{attrs:{id:"docker是什么？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker是什么？"}},[s._v("#")]),s._v(" docker是什么？")]),s._v(" "),n("p",[s._v("​\tdocker的中文解释是"),n("strong",[s._v("码头工人")]),s._v("。")]),s._v(" "),n("p",[n("strong",[s._v("官方解释：")])]),s._v(" "),n("p",[s._v("​\tDocker是一个开源的容器引擎，它基于LCX容器技术，使用Go语言开发。")]),s._v(" "),n("p",[s._v("​\t源代码托管在Github上，并遵从Apache2.0协议。")]),s._v(" "),n("p",[s._v("​\tDocker采用C/S架构，其可以轻松的为任何应用创建一个轻量级的、可移植的、自给自足的容器。")]),s._v(" "),n("p",[s._v("​\tDocker就是一种快速解决生产问题的一种技术手段,开发，运行和部署应用程序的开放管理平台。")]),s._v(" "),n("p",[s._v("​\t"),n("strong",[s._v("开发人员")]),s._v("能利用docker 开发和运行应用程序")]),s._v(" "),n("p",[s._v("​\t"),n("strong",[s._v("运维人员")]),s._v("能利用docker 部署和管理应用程序")]),s._v(" "),n("h4",{attrs:{id:"docker的生活场景对比："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker的生活场景对比："}},[s._v("#")]),s._v(" Docker的生活场景对比：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th"),s._v(" "),n("th")])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("物理机")]),s._v(" "),n("td",[n("img",{attrs:{src:"assets/%E7%8B%AC%E6%A0%8B%E5%88%AB%E5%A2%85.jpg",alt:"独栋别墅"}})])]),s._v(" "),n("tr",[n("td",[s._v("虚拟机")]),s._v(" "),n("td",[n("img",{attrs:{src:"assets/%E5%85%AC%E5%AF%93%E4%BD%8F%E5%AE%85.jpg",alt:"公寓住宅"}})])]),s._v(" "),n("tr",[n("td",[s._v("容器是")]),s._v(" "),n("td",[n("img",{attrs:{src:"assets/%E8%83%B6%E5%9B%8A%E5%85%AC%E5%AF%93.jpg",alt:"胶囊公寓"}})])])])]),s._v(" "),n("h4",{attrs:{id:"单独的理解一下容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单独的理解一下容器"}},[s._v("#")]),s._v(" 单独的理解一下容器:")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("动画片《七龙珠》里面的胶囊")]),s._v(" "),n("th",[s._v("1号胶囊启动后的效果")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[n("img",{attrs:{src:"assets/%E9%BE%99%E7%8F%A0%E8%83%B6%E5%9B%8A.jpg",alt:"龙珠胶囊"}})]),s._v(" "),n("td",[n("img",{attrs:{src:"assets/%E5%AE%8C%E6%88%90%E4%BA%86.jpg",alt:"完成了"}})])])])]),s._v(" "),n("p",[s._v("​\tDocker提供了在一个完全隔离的环境中打包和运行应用程序的能力，这个隔离的环境被称为容器。")]),s._v(" "),n("p",[s._v("​\t由于容器的隔离性和安全性，因此可以在一个主机(宿主机)上同时运行多个相互隔离的容器，互不干预。")]),s._v(" "),n("h3",{attrs:{id:"_1-1-2为什么使用docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2为什么使用docker"}},[s._v("#")]),s._v(" 1.1.2为什么使用Docker")]),s._v(" "),n("p",[s._v("​\tDocker使您能够将应用程序与基础架构分开，以便您可以快速交付软件。")]),s._v(" "),n("p",[s._v("​\t借助Docker，您可以像管理应用程序一样管理基础架构。")]),s._v(" "),n("p",[s._v("​\t通过利用Docker的方法快速进行运输，测试和部署代码，您可以显着缩短编写代码和在生产环境中运行代码之间的延迟。")]),s._v(" "),n("p",[n("strong",[s._v("例如:")]),s._v("\n​\t开发人员在本地编写代码，可以使用Docker同事进行共享，实现协同工作。")]),s._v(" "),n("p",[s._v("​\t使用Docker开发完成程序，可以直接对应用程序执行自动和手动测试。")]),s._v(" "),n("p",[s._v("​\t当开发人员发现错误或BUG时，可以直接在开发环境中修复后，并迅速将它们重新部署到测试环境进行测试和验证。")]),s._v(" "),n("p",[s._v("​\t利用Docker开发完成后，交付时，直接交付Docker，也就意味着交付完成。后续如果有提供修补程序或更新，需要推送到生成环境运行起来，也是一样的简单。")]),s._v(" "),n("p",[n("strong",[s._v("Docker主要解决的问题：")])]),s._v(" "),n("p",[s._v("​\t保证程序运行环境的一致性；")]),s._v(" "),n("p",[s._v("​\t降低配置开发环境、生产环境的复杂度和成本；")]),s._v(" "),n("p",[s._v("​\t实现程序的快速部署和分发。")]),s._v(" "),n("h3",{attrs:{id:"_1-1-3docker的架构与结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3docker的架构与结构"}},[s._v("#")]),s._v(" 1.1.3Docker的架构与结构")]),s._v(" "),n("p",[n("strong",[s._v("架构图")])]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/jg.png",alt:"jg"}})]),s._v(" "),n("p",[n("strong",[s._v("Docker")]),s._v("是采用了(c/s)架构模式的应用程序")]),s._v(" "),n("p",[s._v("Client dockerCLI :客户端docker命令行")]),s._v(" "),n("p",[s._v("REST API : 一套介于客户端与服务端的之间进行通信并指示其执行的接口")]),s._v(" "),n("p",[s._v("Server docker daemon:服务端dacker守护进程等待客户端发送命令来执行")]),s._v(" "),n("p",[n("strong",[s._v("Docker")]),s._v("的四大核心技术")]),s._v(" "),n("p",[s._v("镜像：一个Docker的可执行文件，其中包括运行应用程序所需的所有代码内容、依赖库、环境变量和配置文件等。")]),s._v(" "),n("p",[s._v("容器：镜像被运行起来后的实例。")]),s._v(" "),n("p",[s._v("网络：外部或者容器间如何互相访问的网络方式，如host模式、bridge模式。")]),s._v(" "),n("p",[s._v("数据卷：容器与宿主机之间、容器与容器之间共享存储方式，类似虚拟机与主机之间的共享文件目录。")]),s._v(" "),n("p",[n("strong",[s._v("结构图")])]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/jiegou.png",alt:"jiegou"}})]),s._v(" "),n("ul",[n("li",[n("p",[s._v("客户端 -> 一个服务")]),s._v(" "),n("ul",[n("li",[s._v("一个守护进程, 通过shell终端可以进行一些操作")])])]),s._v(" "),n("li",[n("p",[s._v("服务器 -> 守护进程")]),s._v(" "),n("ul",[n("li",[s._v("接收客户端的请求")]),s._v(" "),n("li",[s._v("管理容器, 管理镜像")])])]),s._v(" "),n("li",[n("p",[s._v("docker镜像")]),s._v(" "),n("ul",[n("li",[s._v("一个可执行程序")]),s._v(" "),n("li",[s._v("只占用硬盘资源")])])]),s._v(" "),n("li",[n("p",[s._v("docker容器")]),s._v(" "),n("ul",[n("li",[s._v("镜像启动之后运行在docker容器中")]),s._v(" "),n("li",[s._v("占用cpu和内存资源")])])]),s._v(" "),n("li",[n("p",[s._v("docker仓库")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("存储镜像")])]),s._v(" "),n("li",[n("p",[s._v("docker hub")])])])])]),s._v(" "),n("h3",{attrs:{id:"_1-1-4官方资料："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-4官方资料："}},[s._v("#")]),s._v(" 1.1.4官方资料：")]),s._v(" "),n("p",[s._v("Docker 官网：http://www.docker.com")]),s._v(" "),n("p",[s._v("Github Docker 源码：https://github.com/docker/docker")]),s._v(" "),n("p",[s._v("Docker 英文文档网址：https://docs.docker.com/")]),s._v(" "),n("p",[s._v("Docker 中文文档网址：http://docker-doc.readthedocs.io/zh_CN/latest/")]),s._v(" "),n("h2",{attrs:{id:"_1-2-docker快速入门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-docker快速入门"}},[s._v("#")]),s._v(" 1.2 docker快速入门")]),s._v(" "),n("h3",{attrs:{id:"_1-2-1docker历程："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1docker历程："}},[s._v("#")]),s._v(" 1.2.1docker历程：")]),s._v(" "),n("p",[s._v("​\t自2013年出现以来，发展势头很猛，现在可说是风靡全球。")]),s._v(" "),n("p",[s._v("​\tdocker的第一版为0.1.0 发布于2013年03月23日")]),s._v(" "),n("p",[s._v("​\tDocker2017年改版前的版本号是1.13.1发布于2017年02月08日")]),s._v(" "),n("p",[s._v("​\tDocker从1.13.x版本开始，版本分为企业版EE和社区版CE，版本号也改为按照时间线来发布，比如17.03就是2017年3月，有点类似于ubuntu的版本发布方式。\n​\t企业版自然会提供一些额外的服务，当然肯定也是收费的。\n​\t企业版说明https://blog.docker.com/2017/03/docker-enterprise-edition/\n社区版分为stable和edge两种发布方式。")]),s._v(" "),n("p",[s._v("stable版本是季度发布方式，比如17.03, 17.06, 17.09")]),s._v(" "),n("p",[s._v("edge版本是月份发布方式， 比如17.03, 17.04......")]),s._v(" "),n("h3",{attrs:{id:"_1-2-2-官方要求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-官方要求"}},[s._v("#")]),s._v(" 1.2.2 官方要求")]),s._v(" "),n("p",[s._v("为什么用ubuntu学docker")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/docker%E4%B8%8Eubuntu%E6%94%AF%E6%8C%81.png",alt:"docker与ubuntu支持"}})]),s._v(" "),n("p",[s._v("图片来源：https://docs.docker.com/engine/installation/#server")]),s._v(" "),n("p",[s._v("docker要求的ubuntu环境")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/ubuntu%E6%94%AF%E6%8C%81%E7%89%88%E6%9C%AC.png",alt:"ubuntu支持版本"}})]),s._v(" "),n("p",[s._v("ubuntu下载地址：https://www.ubuntu.com/download/desktop")]),s._v(" "),n("h4",{attrs:{id:"ubuntu主机环境需求"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu主机环境需求"}},[s._v("#")]),s._v(" ubuntu主机环境需求")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行命令")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -a\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l /sys/class/misc/device-mapper\n")])])]),n("h5",{attrs:{id:"执行效果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行效果"}},[s._v("#")]),s._v(" 执行效果")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/docker%E7%8E%AF%E5%A2%83%E9%9C%80%E6%B1%82%E6%89%A7%E8%A1%8C%E6%95%88%E6%9E%9C.png",alt:"docker环境需求执行效果"}})]),s._v(" "),n("h3",{attrs:{id:"_1-2-3-部署docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-部署docker"}},[s._v("#")]),s._v(" 1.2.3 部署docker")]),s._v(" "),n("h4",{attrs:{id:"官网参考："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#官网参考："}},[s._v("#")]),s._v(" 官网参考：")]),s._v(" "),n("p",[s._v("https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/#upgrade-docker-after-using-the-convenience-script")]),s._v(" "),n("h4",{attrs:{id:"安装步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装步骤"}},[s._v("#")]),s._v(" 安装步骤")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装基本软件")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" apt-transport-https ca-certificates "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" software-properties-common lrzsz -y\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用官方推荐源{不推荐}#")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -fsSL https://download.docker.com/linux/ubuntu/gpg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" apt-key "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -\nadd-apt-repository "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb [arch=amd64] https://download.docker.com/linux/ubuntu '),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("lsb_release -cs"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(' stable"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用阿里云的源{推荐}")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" apt-key "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" add-apt-repository "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu '),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("lsb_release -cs"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(' stable"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#软件源升级")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装docker")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce -y\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以指定版本安装docker：")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("VERSION"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" -y\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看支持的docker版本")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-cache")]),s._v(" madison docker-ce\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#测试docker")]),s._v("\ndocker version\n")])])]),n("h4",{attrs:{id:"网卡区别："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网卡区别："}},[s._v("#")]),s._v(" 网卡区别：")]),s._v(" "),n("p",[s._v("安装前：只有ens33和lo网卡")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/docker%E5%AE%89%E8%A3%85%E5%89%8D.png",alt:"docker安装前"}})]),s._v(" "),n("p",[s._v("安装后：docker启动后，多出来了docker0网卡，网卡地址172.17.0.1")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/docker%E5%AE%89%E8%A3%85%E5%90%8E.png",alt:"docker安装后"}})]),s._v(" "),n("h3",{attrs:{id:"_1-2-4-docker加速器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-docker加速器"}},[s._v("#")]),s._v(" 1.2.4 docker加速器")]),s._v(" "),n("p",[s._v("在国内使用docker的官方镜像源，会因为网络的原因，造成无法下载，或者一直处于超时。所以我们使用 daocloud的方法进行加速配置。\n加速器文档链接：http://guide.daocloud.io/dcs/daocloud-9153151.html")]),s._v(" "),n("h4",{attrs:{id:"方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方法"}},[s._v("#")]),s._v(" 方法:")]),s._v(" "),n("p",[s._v("访问 https://dashboard.daocloud.io 网站，登录 daocloud 账户")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/doacloud%E7%99%BB%E5%BD%95.png",alt:"doacloud登录"}})]),s._v(" "),n("p",[s._v("点击右上角的 加速器")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/%E5%8A%A0%E9%80%9F%E5%99%A8.png",alt:"加速器"}})]),s._v(" "),n("p",[s._v("在新窗口处会显示一条命令，")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/%E5%8A%A0%E9%80%9F%E5%99%A8%E5%91%BD%E4%BB%A4.png",alt:"加速器命令"}})]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#我们执行这条命令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL https://get.daocloud.io/daotools/set_mirror.sh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -s http://f1361db2.m.daocloud.io\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改daemon.json文件，增加")]),s._v("\n\n, "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#到大括号后")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/docker/daemon.json")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://f1361db2.m.daocloud.io"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker cloud加速器的默认内容是少了一条配置，所以我们要编辑文件把后面的内容补全")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启docker")]),s._v("\nsystemctl restart docker\n")])])]),n("h3",{attrs:{id:"_1-2-5-docker-其他简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-5-docker-其他简介"}},[s._v("#")]),s._v(" 1.2.5 docker 其他简介")]),s._v(" "),n("h4",{attrs:{id:"docker的基本命令格式："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker的基本命令格式："}},[s._v("#")]),s._v(" docker的基本命令格式：")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#基本格式")]),s._v("\nsystemctl "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#参数详解：")]),s._v("\n\tstart         开启服务\n    stop          关闭\n    restart       重启\n    status        状态\n")])])]),n("h4",{attrs:{id:"删除docker命令："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除docker命令："}},[s._v("#")]),s._v(" 删除docker命令：")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" purge docker-ce -y\n$  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /etc/docker\n$  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /var/lib/docker/\n")])])]),n("h4",{attrs:{id:"docker基本目录简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker基本目录简介"}},[s._v("#")]),s._v(" docker基本目录简介:")]),s._v(" "),n("div",{staticClass:"language-SHELL extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("/etc/docker/                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker的认证目录")]),s._v("\n/var/lib/docker/            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker的应用目录")]),s._v("\n")])])]),n("h4",{attrs:{id:"docker常见bug"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker常见bug"}},[s._v("#")]),s._v(" docker常见bug:")]),s._v(" "),n("h5",{attrs:{id:"背景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),n("p",[s._v("​\t因为使用的是sudo安装docker，所以会导致一个问题。以普通用户登录的状况下，在使用docker images时必须添加sudo，那么如何让docker免sudo依然可用呢？")]),s._v(" "),n("h5",{attrs:{id:"理清问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#理清问题"}},[s._v("#")]),s._v(" 理清问题")]),s._v(" "),n("p",[s._v("​\t当以普通用户身份去使用docker命令时，出现以下错误：")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("Got permission denied "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Post http://%2Fvar%2Frun%2Fdocker.sock/v1.35/images/create?fromSrc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("message")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("repo")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ubuntu-16.04"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tag")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(": dial unix /var/run/docker.sock: connect: permission denied\n")])])]),n("p",[s._v("​\t可以看都，最后告知我们时权限的问题。那么在linux文件权限有三个数据左右drwxrwxrwx，其中第一为d代表该文件是一个文件夹前三位、中三位、后三位分别代表这属主权限、属组权限、其他人权限。")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/dockersock%E6%9D%83%E9%99%90.png",alt:"dockersock权限"}})]),s._v(" "),n("p",[s._v("​\t上图是报错文件的权限展示，可以看到其属主为root，权限为rw，可读可写；其属组为docker，权限为rw，可读可写。如果要当前用户可直接读取该文件，那么我们就为docker.sock 添加一个其他用户可读写权限 或者添加1个用户组就可以了")]),s._v(" "),n("h5",{attrs:{id:"方法1：一劳永逸"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方法1：一劳永逸"}},[s._v("#")]),s._v(" 方法1：一劳永逸")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果还没有 docker group 就添加一个：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将用户加入该 group 内。然后退出并重新登录就生效啦。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sudo")]),s._v(" gpasswd -a "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${"),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("}")]),s._v(" docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启 docker 服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$systemctl")]),s._v(" restart docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#切换当前会话到新 group 或者重启 X 会话")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$newgrp")]),s._v(" - docker\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意:最后一步是必须的，否则因为 groups 命令获取到的是缓存的组信息，刚添加的组信息未能生效，")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所以 docker images 执行时同样有错。")]),s._v("\n")])])]),n("h5",{attrs:{id:"方法2："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方法2："}},[s._v("#")]),s._v(" 方法2：")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每次启动docker或者重启docker的之后")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cd")]),s._v(" /var/run\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v(" docker.sock\n")])])]),n("h5",{attrs:{id:"方法3：每条命令前面加上sudo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方法3：每条命令前面加上sudo"}},[s._v("#")]),s._v(" 方法3：每条命令前面加上sudo")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/%E5%90%83%E9%B2%B8.jpg",alt:"吃鲸"}}),s._v(".AVI")]),s._v(" "),n("h1",{attrs:{id:"第-2-章-docker-核心技术"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第-2-章-docker-核心技术"}},[s._v("#")]),s._v(" 第 2 章 Docker 核心技术")]),s._v(" "),n("p",[s._v("Docker的核心技术内容很多，我们学习则从以下四个方面来介绍Docker的核心技术\n"),n("strong",[s._v("镜像")]),s._v("、"),n("strong",[s._v("容器")]),s._v("、"),n("strong",[s._v("数据")]),s._v("、"),n("strong",[s._v("网络")])]),s._v(" "),n("h2",{attrs:{id:"_2-1-docker镜像管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-docker镜像管理"}},[s._v("#")]),s._v(" 2.1 docker镜像管理")]),s._v(" "),n("h3",{attrs:{id:"_2-1-1-镜像简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-镜像简介"}},[s._v("#")]),s._v(" 2.1.1 镜像简介")]),s._v(" "),n("p",[s._v("Docker镜像是什么？\n​\t镜像是一个Docker的可执行文件，其中包括运行应用程序所需的所有代码内容、依赖库、环境变量和配置文件等。\n​\t通过镜像可以创建一个或多个容器。")]),s._v(" "),n("h3",{attrs:{id:"_2-1-2-搜索、查看、获取"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-搜索、查看、获取"}},[s._v("#")]),s._v(" 2.1.2 搜索、查看、获取")]),s._v(" "),n("h4",{attrs:{id:"搜索镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#搜索镜像"}},[s._v("#")]),s._v(" 搜索镜像")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用")]),s._v("\n\t搜索Docker Hub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("镜像仓库"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("上的镜像\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n    docker search "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n$ docker search ubuntu\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#NAME：名称")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DESCRIPTION：基本功能描述")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#STARS：星级（收到关注程度）")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#OFFICIAL：是否官方创建")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#AUTOMATED：是否自动创建")]),s._v("\n")])])]),n("h4",{attrs:{id:"获取镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取镜像"}},[s._v("#")]),s._v(" 获取镜像")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t下载远程仓库（如Docker Hub）中的镜像\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker pull "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n$ docker pull ubuntu\n$ docker pull nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取的镜像在哪里？")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/var/lib/docker 目录下")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#由于权限的原因我们需要切换root用户")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#那我们首先要重设置root用户的密码：")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" root\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这样就可以设置root用户的密码了。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#之后就可以自由的切换到root用户了")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输入root用户的密码即可。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当然，如果想从root用户切换回一般用户，则可使用 su -val(一般用户名)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#而当你再次切回到root用户，则只需要键入exit,再次输入exit则回到最初的用户下")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#操作下面的文件可以查看相关的镜像信息       ")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /var/lib/docker/image/overlay2/repositories.json \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件所在")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n/var/lib/docker/image/overlay2/imagedb/content/sha256\n\n")])])]),n("h4",{attrs:{id:"查看镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看镜像"}},[s._v("#")]),s._v(" 查看镜像")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n   列出本地镜像\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker images "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndocker image "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n$ docker images\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像的ID唯一标识了镜像，如果ID相同,说明是同一镜像。TAG信息来区分不同发行版本，如果不指定具体标记,默认使用latest标记信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker images -a 列出所有的本地的images(包括已删除的镜像记录)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#REPOSITORY：镜像的名称 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#TAG ：镜像的版本标签")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#IMAGE ID：镜像id")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CREATED：镜像是什么时候创建的")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SIZE：大小")]),s._v("\n")])])]),n("h3",{attrs:{id:"_2-1-3-重命名、删除"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-重命名、删除"}},[s._v("#")]),s._v(" 2.1.3 重命名、删除")]),s._v(" "),n("h4",{attrs:{id:"镜像重命名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像重命名"}},[s._v("#")]),s._v(" 镜像重命名")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t对本地镜像的NAME、TAG进行重命名，并新产生一个命名后镜像\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker tag "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("老镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("老镜像版本"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("新镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("新镜像版本"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n$ docker tag nginx:latest panda-nginx:v1.0\n")])])]),n("h4",{attrs:{id:"删除镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除镜像"}},[s._v("#")]),s._v(" 删除镜像")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t将本地的一个或多个镜像删除\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像版本"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndocker image "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" rmi 3fa822599e10\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" rmi mysql:latest\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\n如果一个image_id存在多个名称，那么应该使用 名称:版本 的格式删除镜像\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令参数(OPTIONS)：\t")]),s._v("\n\t-f, --force      \t\t强制删除\n")])])]),n("h3",{attrs:{id:"_2-1-4-导出、导入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-导出、导入"}},[s._v("#")]),s._v(" 2.1.4 导出、导入")]),s._v(" "),n("h4",{attrs:{id:"导出镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#导出镜像"}},[s._v("#")]),s._v(" 导出镜像")]),s._v(" "),n("p",[s._v("将已经下载好的镜像，导出到本地，以备后用。")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t将本地的一个或多个镜像打包保存成本地tar文件\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker save "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("导出镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("本地镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令参数(OPTIONS)：\t")]),s._v("\n\t-o, --output string   \t\t指定写入的文件名和路径\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#导出镜像")]),s._v("\n:~$ docker save -o nginx.tar nginx\n")])])]),n("h4",{attrs:{id:"导入镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#导入镜像"}},[s._v("#")]),s._v(" 导入镜像")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t将save命令打包的镜像导入本地镜像库中\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#导入镜像命令格式：")]),s._v("\n$ docker load "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("被导入镜像压缩文件的名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n$ docker load "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("被导入镜像压缩文件的名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n$ docker load --input "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("被导入镜像压缩文件的名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令参数(OPTIONS)：\t")]),s._v("\n\t-i,  --input string   \t指定要打入的文件，如没有指定，默认是STDIN\n\t\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#为了更好的演示效果，我们先将nginx的镜像删除掉")]),s._v("\ndocker rmi nginx:v1.0\ndocker rmi nginx    \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#导入镜像文件：")]),s._v("\n$ docker load "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" nginx.tar\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\n\t如果发现导入的时候没有权限需要使用chmod命令修改镜像文件的权限\n")])])]),n("h3",{attrs:{id:"_2-1-5-历史、详细信息、创建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-5-历史、详细信息、创建"}},[s._v("#")]),s._v(" 2.1.5 历史、详细信息、创建")]),s._v(" "),n("h4",{attrs:{id:"查看镜像历史"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看镜像历史"}},[s._v("#")]),s._v(" 查看镜像历史")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t查看本地一个镜像的历史"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("历史分层"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("信息\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看镜像命令格式：")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像版本"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#我们获取到一个镜像，想知道他默认启动了哪些命令或者都封装了哪些系统层，那么我们可以使用docker history这条命令来获取我们想要的信息")]),s._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" sswang-nginx:v1.0\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#IMAGE：编号           ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CREATED：创建的  ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CREATED BY ：基于那些命令创建的                                 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SIZE：大小")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#COMMENT：评论")]),s._v("\n")])])]),n("h4",{attrs:{id:"镜像详细信息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像详细信息"}},[s._v("#")]),s._v(" 镜像详细信息")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t查看本地一个或多个镜像的详细信息\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n$ docker image inspect "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像版本"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n$ docker inspect "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看镜像详细信息：")]),s._v("\n$ docker inspect nginx\n")])])]),n("h4",{attrs:{id:"根据模板创建镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#根据模板创建镜像"}},[s._v("#")]),s._v(" 根据模板创建镜像")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录系统模板镜像网站：  ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#https://download.openvz.org/template/precreated/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#找到一个镜像模板进行下载，比如说ubuntu-16.04-x86_64.tar.gz，地址为：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#https://download.openvz.org/template/precreated/ubuntu-16.04-x86_64.tar.gz    ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" 模板文件名.tar "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" - "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("自定义镜像名"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#演示效果：")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ubuntu-16.04-x86_64.tar.gz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" - ubuntu-mini\n")])])]),n("h3",{attrs:{id:"_2-1-6总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-6总结"}},[s._v("#")]),s._v(" 2.1.6总结")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/1541570009278.png",alt:"1541570009278"}})]),s._v(" "),n("h2",{attrs:{id:"_2-2-容器管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-容器管理"}},[s._v("#")]),s._v(" 2.2 容器管理")]),s._v(" "),n("p",[s._v("​\tdocker容器技术指Docker是一个由GO语言写的程序运行的“容器”（Linux containers， LXCs）")]),s._v(" "),n("p",[s._v("​       containers的中文解释是集装箱。")]),s._v(" "),n("p",[s._v("​    Docker则实现了一种应用程序级别的隔离，它改变我们基本的开发、操作单元，由直接操作虚拟主机（VM）,转换到操作程序运行的“容器”上来。")]),s._v(" "),n("h3",{attrs:{id:"_2-2-1-容器简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-容器简介"}},[s._v("#")]),s._v(" 2.2.1 容器简介")]),s._v(" "),n("h4",{attrs:{id:"容器是什么？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器是什么？"}},[s._v("#")]),s._v(" 容器是什么？")]),s._v(" "),n("p",[s._v("​\t容器（Container）：容器是一种轻量级、可移植、并将应用程序进行的打包的技术，使应用程序可以在几乎任何地方以相同的方式运行")]),s._v(" "),n("p",[s._v("​\t•Docker将镜像文件运行起来后，产生的对象就是容器。容器相当于是镜像运行起来的一个实例。")]),s._v(" "),n("p",[s._v("​\t•容器具备一定的生命周期。")]),s._v(" "),n("p",[s._v("​\t•另外，可以借助docker ps命令查看运行的容器，如同在linux上利用ps命令查看运行着的进程那样。")]),s._v(" "),n("p",[s._v("​\t我们就可以理解容器就是被封装起来的进程操作,只不过现在的进程可以简单也可以复杂,复杂的话可以运行1个操作系统.简单的话可以运行1个回显字符串.")]),s._v(" "),n("h4",{attrs:{id:"容器与虚拟机的相同点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器与虚拟机的相同点"}},[s._v("#")]),s._v(" 容器与虚拟机的相同点")]),s._v(" "),n("p",[s._v("•容器和虚拟机一样，都会对物理硬件资源进行共享使用。")]),s._v(" "),n("p",[s._v("•容器和虚拟机的生命周期比较相似（创建、运行、暂停、关闭等等）。")]),s._v(" "),n("p",[s._v("•容器中或虚拟机中都可以安装各种应用，如redis、mysql、nginx等。也就是说，在容器中的操作，如同在一个虚拟机(操作系统)中操作一样。")]),s._v(" "),n("p",[s._v("•同虚拟机一样，容器创建后，会存储在宿主机上：linux上位于/var/lib/docker/containers下")]),s._v(" "),n("h4",{attrs:{id:"容器与虚拟机的不同点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器与虚拟机的不同点"}},[s._v("#")]),s._v(" 容器与虚拟机的不同点")]),s._v(" "),n("p",[n("strong",[s._v("注意")]),s._v("：容器并不是虚拟机，但它们有很多相似的地方")]),s._v(" "),n("p",[s._v("•虚拟机的创建、启动和关闭都是基于一个完整的操作系统。一个虚拟机就是一个完整的操作系统。而容器直接运行在宿主机的内核上，其本质上以一系列进程的结合。")]),s._v(" "),n("p",[s._v("•容器是轻量级的，虚拟机是重量级的。")]),s._v(" "),n("p",[s._v("​\t首先容器不需要额外的资源来管理，虚拟机额外更多的性能消耗；")]),s._v(" "),n("p",[s._v("​\t其次创建、启动或关闭容器，如同创建、启动或者关闭进程那么轻松，而创建、启动、关闭一个操作系统就没那么方便了。")]),s._v(" "),n("p",[s._v("•也因此，意味着在给定的硬件上能运行更多数量的容器，甚至可以直接把Docker运行在虚拟机上。")]),s._v(" "),n("h3",{attrs:{id:"_2-2-2-查看、创建、启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-查看、创建、启动"}},[s._v("#")]),s._v(" 2.2.2 查看、创建、启动")]),s._v(" "),n("h4",{attrs:{id:"查看容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看容器"}},[s._v("#")]),s._v(" 查看容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用")]),s._v("\n\t显示docker容器列表\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CONTAINER ID 容器ID        ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#IMAGE 基于那个镜像              ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#COMMAND  运行镜像使用了哪些命令？           ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CREATED多久前创建时间             ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#STATUS   开启还是关闭           ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#PORTS端口号               ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#NAMES容器名称默认是随机的")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\n管理docker容器可以通过名称，也可以通过ID\nps是显示正在运行的容器， -a是显示所有运行过的容器，包括已经不运行的容器\n")])])]),n("h4",{attrs:{id:"创建待启动容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建待启动容器"}},[s._v("#")]),s._v(" 创建待启动容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t利用镜像创建出一个Created 状态的待启动容器\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n\tdocker create "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" IMAGE "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("COMMAND"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ARG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\tdocker create "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("参数命令"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 依赖镜像 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器内命令"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令参数(OPTIONS)：查看更多")]),s._v("\n\t-t, --tty           \t\t分配一个伪TTY，也就是分配虚拟终端\n    -i, --interactive    \t    即使没有连接，也要保持STDIN打开\n        --name          \t\t为容器起名，如果没有指定将会随机产生一个名称\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令参数（COMMAND\\ARG）:")]),s._v("\n\tCOMMAND 表示容器启动后，需要在容器中执行的命令，如ps、ls 等命令\n\tARG 表示执行 COMMAND 时需要提供的一些参数，如ps 命令的 aux、ls命令的-a等等\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建容器（附上ls命令和a参数）")]),s._v("\n\tdocker create -it --name ubuntu-1  ubuntu "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -a\n")])])]),n("p",[n("strong",[s._v("启动容器")])]),s._v(" "),n("p",[s._v("启动容器有三种方式")]),s._v(" "),n("p",[s._v("1、启动待启动或已关闭容器")]),s._v(" "),n("p",[s._v("2、基于镜像新建一个容器并启动")]),s._v(" "),n("p",[s._v("3、守护进程方式启动docker")]),s._v(" "),n("h4",{attrs:{id:"启动容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动容器"}},[s._v("#")]),s._v(" 启动容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t将一个或多个处于创建状态或关闭状态的容器启动起来\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker start "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("或"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令参数(OPTIONS)：")]),s._v("\n\t-a, --attach\t\t将当前shell的 STDOUT/STDERR 连接到容器上\n\t-i, --interactive\t\t将当前shell的 STDIN连接到容器上\t\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动上面创建的容器 ")]),s._v("\n\tdocker start -a ubuntu-1\n")])])]),n("h4",{attrs:{id:"创建新容器并启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建新容器并启动"}},[s._v("#")]),s._v(" 创建新容器并启动")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t利用镜像创建并启动一个容器\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker run "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("执行的命令"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n命令参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OPTIONS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("：\n\t-t, --tty           \t分配一个伪TTY，也就是分配虚拟终端\n    -i, --interactive    \t即使没有连接，也要保持STDIN打开\n        --name          \t为容器起名，如果没有指定将会随机产生一个名称\n\t-d, --detach\t\t\t在后台运行容器并打印出容器ID\n\t--rm\t\t\t\t\t当容器退出运行后，自动删除容器\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动一个镜像输出内容并删除容器")]),s._v("\n$ docker run --rm  --name nginx1   nginx  /bin/echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker"')]),s._v(" \n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\ndocker run 其实 是两个命令的集合体 docker create + docker start\n")])])]),n("h4",{attrs:{id:"守护进程方式启动容器-常用的方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#守护进程方式启动容器-常用的方式"}},[s._v("#")]),s._v(" 守护进程方式启动容器<常用的方式>")]),s._v(" "),n("p",[s._v("更多的时候，需要让Docker容器在后台以守护形式运行。此时可以通过添加-d参数来实现")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("image_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#守护进程方式启动容器:")]),s._v("\n:~$ docker run -d nginx\n")])])]),n("h3",{attrs:{id:"_2-2-3暂停与取消暂停与重启"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3暂停与取消暂停与重启"}},[s._v("#")]),s._v(" 2.2.3暂停与取消暂停与重启")]),s._v(" "),n("h4",{attrs:{id:"容器暂停"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器暂停"}},[s._v("#")]),s._v(" 容器暂停")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t暂停一个或多个处于运行状态的容器\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n\tdocker pause "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("或"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#暂停容器")]),s._v("\n\tdocker pause a229eabf1f32 \n\n")])])]),n("h4",{attrs:{id:"容器取消暂停"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器取消暂停"}},[s._v("#")]),s._v(" 容器取消暂停")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t取消一个或多个处于暂停状态的容器，恢复运行\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n\tdocker unpause "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("或"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#恢复容器")]),s._v("\n\tdocker unpause a229eabf1f32\n")])])]),n("h4",{attrs:{id:"重启"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#重启"}},[s._v("#")]),s._v(" 重启")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t重启一个或多个处于运行状态、暂停状态、关闭状态或者新建状态的容器\n\t该命令相当于stop和start命令的结合\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n\tdocker restart "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("或"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令参数(OPTIONS)：")]),s._v("\n\t -t, --time int   \t\t重启前，等待的时间，单位秒"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("默认 10s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#恢复容器")]),s._v("\n\tdocker restart -t "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" a229eabf1f32\n")])])]),n("h3",{attrs:{id:"_2-2-4-关闭、终止、删除"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-关闭、终止、删除"}},[s._v("#")]),s._v(" 2.2.4 关闭、终止、删除")]),s._v(" "),n("h4",{attrs:{id:"关闭容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关闭容器"}},[s._v("#")]),s._v(" 关闭容器")]),s._v(" "),n("p",[s._v("在生产中，我们会以为临时情况，要关闭某些容器，我们使用 stop 命令来关闭某个容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t延迟关闭一个或多个处于暂停状态或者运行状态的容器\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n  docker stop "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("或"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭容器:")]),s._v("\n$ docker stop  8005c40a1d16\n")])])]),n("h4",{attrs:{id:"终止容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#终止容器"}},[s._v("#")]),s._v(" 终止容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t强制并立即关闭一个或多个处于暂停状态或者运行状态的容器\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n\tdocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("或"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#终止容器")]),s._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v("  8005c40a1d16\n")])])]),n("h4",{attrs:{id:""}},[n("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")])]),s._v(" "),n("h4",{attrs:{id:"删除容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除容器"}},[s._v("#")]),s._v(" 删除容器")]),s._v(" "),n("p",[s._v("删除容器有三种方法：\n正常删除    --        删除已关闭的")]),s._v(" "),n("p",[s._v("强制删除    --        删除正在运行的")]),s._v(" "),n("p",[s._v("强制批量删除 --        删除全部的容器")]),s._v(" "),n("h5",{attrs:{id:"正常删除容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#正常删除容器"}},[s._v("#")]),s._v(" 正常删除容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t删除一个或者多个容器\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("或"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除已关闭的容器:")]),s._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" 1a5f6a0c9443\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Error response from daemon: You cannot remove a running container c7f5e7fe5aca00e0cb987d486dab3502ac93d7180016cfae9ddcc64e56149fc9. Stop the container before attempting removal or force remove\n错误响应守护进程:你不能删除一个容器c7f5e7fe5aca00e0cb987d486dab3502ac93d7180016cfae9ddcc64e56149fc9运行。在尝试拆卸或强制拆卸之前，先停止容器。\n")])])]),n("h5",{attrs:{id:"强制删除运行容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#强制删除运行容器"}},[s._v("#")]),s._v(" 强制删除运行容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t强制删除一个或者多个容器\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n  docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("或"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除正在运行的容器")]),s._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f 8005c40a1d16\n")])])]),n("p",[n("img",{attrs:{src:"assets/%E5%89%8D%E6%96%B9%E9%AB%98%E8%83%BD.png",alt:"前方高能"}})]),s._v(" "),n("h5",{attrs:{id:"拓展批量关闭容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#拓展批量关闭容器"}},[s._v("#")]),s._v(" 拓展批量关闭容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t批量强制删除一个或者多个容器\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#按照执行顺序$（）， 获取到现在容器的id然后进行删除")]),s._v("\n")])])]),n("h3",{attrs:{id:"_2-2-5-进入、退出"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-进入、退出"}},[s._v("#")]),s._v(" 2.2.5 进入、退出")]),s._v(" "),n("p",[n("strong",[s._v("进入容器我们学习三种方法：")])]),s._v(" "),n("p",[s._v("1、创建容器的同时进入容器\n2、手工方式进入容器\n3、生产方式进入容器")]),s._v(" "),n("h4",{attrs:{id:"创建并进入容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建并进入容器"}},[s._v("#")]),s._v(" 创建并进入容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker run --name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("container_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -it "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("docker_image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" /bin/bash\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n$  docker run -it --name panda-nginx nginx /bin/bash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器后")]),s._v("\nroot@7c5a24a68f96:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "hello world"')]),s._v("\nhello world\n\nroot@7c5a24a68f96:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("        \n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker 容器启动命令参数详解：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#--name:给容器定义一个名称")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-i:则让容器的标准输入保持打开。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-t:让docker分配一个伪终端,并绑定到容器的标准输入上")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/bin/bash:执行一个命令")]),s._v("\n")])])]),n("h4",{attrs:{id:"退出容器："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#退出容器："}},[s._v("#")]),s._v(" 退出容器：")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#方法一：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#方法二：")]),s._v("\nCtrl + D\n")])])]),n("h4",{attrs:{id:"手工方式进入容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#手工方式进入容器"}},[s._v("#")]),s._v(" 手工方式进入容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it  容器id  /bin/bash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#效果演示：")]),s._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it d74fff341687 /bin/bash\n")])])]),n("h4",{attrs:{id:"生产方式进入容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生产方式进入容器"}},[s._v("#")]),s._v(" 生产方式进入容器")]),s._v(" "),n("p",[s._v("我们生产中常用的进入容器方法是使用脚本，脚本内容如下")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#定义进入仓库函数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("docker_in")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAME_ID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker inspect --format "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".State.Pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" $NAME_ID"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  nsenter --target "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PID")]),s._v(" --mount --uts --ipc --net --pid\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ndocker_in "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n")])])]),n("p",[s._v("直接执行的话是没有执行权限的所以需要赋值权限")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#赋权执行")]),s._v("\n$  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x docker_in.sh \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入指定的容器，并测试")]),s._v("\n$  ./docker_in.sh b3fbcba852fd\n")])])]),n("h4",{attrs:{id:"注意："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意："}},[s._v("#")]),s._v(" 注意：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("当拷贝到linux下的时候会出现")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("-bash: ./docker_in.sh: /bin/bash^M: 解释器错误: 没有那个文件或目录"),n("br"),s._v("这个问题大多数是因为你的脚本文件在windows下编辑过。windows下，每一行的结尾是\\n\\r，而在linux下文件的结尾是\\n，那么你在windows下编辑过的文件在linux下打开看的时候每一行的结尾就会多出来一个字符\\r,用cat -A docker_in.sh时你可以看到这个\\r字符被显示为^M，这时候只需要删除这个字符就可以了。"),n("br"),s._v("可以使用命令   sed -i 's/\\r$//' docker_in.sh")])])])]),s._v(" "),n("h3",{attrs:{id:"_2-2-6-基于容器创建镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-6-基于容器创建镜像"}},[s._v("#")]),s._v(" 2.2.6 基于容器创建镜像")]),s._v(" "),n("h4",{attrs:{id:"方式一："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方式一："}},[s._v("#")]),s._v(" 方式一：")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker commit -m "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'改动信息'")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"作者信息"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("container_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("new_image:tag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入一个容器，创建文件后并退出:")]),s._v("\n$ ./docker_in.sh d74fff341687\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /hello\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /world\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建一个镜像:")]),s._v("\n$ docker commit -m "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mkdir /hello /world '")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"panda"')]),s._v("  d74fff341687  nginx:v0.2\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看镜像:")]),s._v("\n$ docker images\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动一个容器")]),s._v("\n$ docker run -itd  nginx:v0.2 /bin/bash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器进行查看")]),s._v("\n$ ./docker_in.sh ae63ab299a84\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n")])])]),n("h4",{attrs:{id:"方式二"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#方式二"}},[s._v("#")]),s._v(" 方式二:")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 模板文件名.tar\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建镜像:")]),s._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" ae63ab299a84 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nginx.tar\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#导入镜像:")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" nginx.tar "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" - panda-test\n")])])]),n("table",[n("thead",[n("tr",[n("th",[s._v("导出（export）导入（import）与保存（save）加载（load）的恩怨情仇")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("import与load的区别："),n("br"),s._v("import可以重新指定镜像的名字，docker load不可以")])]),s._v(" "),n("tr",[n("td",[s._v("export 与 保存 save 的区别："),n("br"),s._v("1、export导出的镜像文件大小，小于 save保存的镜像。"),n("br"),s._v("2、export 导出（import导入）是根据容器拿到的镜像，再导入时会丢失镜像所有的历史。")])])])]),s._v(" "),n("h3",{attrs:{id:"_2-2-7-日志、信息、端口、重命名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-7-日志、信息、端口、重命名"}},[s._v("#")]),s._v(" 2.2.7 日志、信息、端口、重命名")]),s._v(" "),n("h4",{attrs:{id:"查看容器运行日志"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看容器运行日志"}},[s._v("#")]),s._v(" 查看容器运行日志")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker logs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令效果：")]),s._v("\n$ docker logs 7c5a24a68f96\n")])])]),n("h4",{attrs:{id:"查看容器详细信息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看容器详细信息"}},[s._v("#")]),s._v(" 查看容器详细信息")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker inspect "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令效果：")]),s._v("\n查看容器全部信息:\n$ docker inspect 930f29ccdf8a\n\n")])])]),n("h4",{attrs:{id:"查看容器端口信息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看容器端口信息"}},[s._v("#")]),s._v(" 查看容器端口信息")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker port "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令效果：")]),s._v("\n$ docker port 930f29ccdf8a\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#没有效果没有和宿主机关联")]),s._v("\n")])])]),n("h4",{attrs:{id:"容器重命名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器重命名"}},[s._v("#")]),s._v(" 容器重命名")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#作用：")]),s._v("\n\t修改容器的名称\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n\tdocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rename")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("或"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器新名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令效果：")]),s._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rename")]),s._v(" 930f29ccdf8a u1\n\n")])])]),n("h4",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/rqz2.png",alt:"rqz2"}})]),s._v(" "),n("h2",{attrs:{id:"_2-3-数据管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-数据管理"}},[s._v("#")]),s._v(" 2.3 数据管理")]),s._v(" "),n("p",[s._v("​\t生产环境使用Docker的过程中，往往需要对数据进行持久化保存，或者需要更多容器之间进行数据共享，那我们需要怎么要的操作呢？")]),s._v(" "),n("p",[s._v("​\t答案就是：数据卷（Data Volumes）和数据卷容器（Data Volume Containers）")]),s._v(" "),n("h3",{attrs:{id:"_2-3-1-数据卷简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-数据卷简介"}},[s._v("#")]),s._v(" 2.3.1 数据卷简介")]),s._v(" "),n("h4",{attrs:{id:"什么是数据卷？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是数据卷？"}},[s._v("#")]),s._v(" 什么是数据卷？")]),s._v(" "),n("p",[s._v("​\t就是将宿主机的某个目录，映射到容器中，作为数据存储的目录，我们就可以在宿主机对数据进行存储")]),s._v(" "),n("p",[s._v("​\t数据卷（Data Volumes）：容器内数据直接映射到本地主机环境")]),s._v(" "),n("h5",{attrs:{id:"数据卷特性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据卷特性"}},[s._v("#")]),s._v(" 数据卷特性")]),s._v(" "),n("p",[s._v("1、数据卷可以在容器之间共享和重用，本地与容器间传递数据更高效；")]),s._v(" "),n("p",[s._v("2、对数据卷的修改会立马有效，容器内部与本地目录均可；")]),s._v(" "),n("p",[s._v("3、对数据卷的更新，不会影响镜像，对数据与应用进行了解耦操作；")]),s._v(" "),n("p",[s._v("4、卷会一直存在，直到没有容器使用。")]),s._v(" "),n("h4",{attrs:{id:"docker-数据卷命令详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-数据卷命令详解"}},[s._v("#")]),s._v(" docker 数据卷命令详解")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v(":~$ docker run --help\n\n-v, --volume list               Bind "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" a volume "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                    挂载一个数据卷，默认为空\n")])])]),n("p",[s._v("​\t我们可以使用命令 docker run 用来创建容器，可以在使用docker run 命令时添加 -v 参数，就可以创建并挂载一个到多个数据卷到当前运行的容器中。\n​\t-v 参数的作用是将宿主机的一个目录作为容器的数据卷挂载到docker容器中，使宿主机和容器之间可以共享一个 目录，如果本地路径不存在，Docker也会自动创建。")]),s._v(" "),n("h3",{attrs:{id:"_2-3-2-数据卷实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-数据卷实践"}},[s._v("#")]),s._v(" 2.3.2 数据卷实践")]),s._v(" "),n("p",[s._v("​\t关于数据卷的管理我们从两个方面来说：")]),s._v(" "),n("p",[s._v("1、目录")]),s._v(" "),n("p",[s._v("2、普通文件")]),s._v(" "),n("h4",{attrs:{id:"数据卷实践-之-目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据卷实践-之-目录"}},[s._v("#")]),s._v(" 数据卷实践 之 目录")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker run -itd --name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名字"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("宿主机目录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器目录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("可选"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建测试文件:")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file1"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" tmp/file1.txt\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动一个容器，挂载数据卷:")]),s._v("\n$ docker run -itd --name test1 -v /home/itcast/tmp/:/test1/  nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意宿主机目录需要绝对路径")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#测试效果")]),s._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it a53c61c77 /bin/bash\nroot@a53c61c77bde:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /test1/file1.txt ")]),s._v("\nfile1\n")])])]),n("h4",{attrs:{id:"数据卷实践-之-文件-不推荐"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据卷实践-之-文件-不推荐"}},[s._v("#")]),s._v(" 数据卷实践 之 文件{不推荐}")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker run -itd --name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名字"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("宿主机文件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器文件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("可选"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建测试文件")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file1"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /tmp/file1.txt\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动一个容器，挂载数据卷")]),s._v("\n$ docker run -itd --name test2 -v /home/itcast/tmp/file1.txt:/nihao/nihao.sh nginx\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#测试效果")]),s._v("\n:~$ docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it 84c37743 /bin/bash\nroot@84c37743d339:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /nihao/nihao.sh ")]),s._v("\nfile1\n")])])]),n("h4",{attrs:{id:"注意：-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意：-2"}},[s._v("#")]),s._v(" 注意：")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、Docker挂载数据卷的默认读写权限（rw），用户可以通过ro设置为只读\n格式："),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("宿主机文件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器文件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":ro\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、如果直接挂载一个文件到容器，使用文件工具进行编辑，可能会造成文件的改变，从Docker1.1.0起，这会导致报错误信息。所以推荐的方式是直接挂在文件所在的目录。\n")])])]),n("h3",{attrs:{id:"_2-3-3-数据卷容器简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-数据卷容器简介"}},[s._v("#")]),s._v(" 2.3.3 数据卷容器简介")]),s._v(" "),n("p",[s._v("什么是数据卷容器？\n需要在多个容器之间共享一些持续更新的数据，最简单的方式是使用数据卷容器。数据卷容器也是一个容器，但是它的目的是专门用来提供数据卷供其他容器挂载。")]),s._v(" "),n("p",[s._v("数据卷容器（Data Volume Containers）：使用特定容器维护数据卷")]),s._v(" "),n("p",[s._v("简单点：数据卷容器就是为其他容器提供数据交互存储的容器")]),s._v(" "),n("h4",{attrs:{id:"docker-数据卷命令详解-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-数据卷命令详解-2"}},[s._v("#")]),s._v(" docker 数据卷命令详解")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v(":~$  docker run --help\n。。。\n-v, --volumes-from list     Mount volumes from the specified container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从指定的容器挂载卷，默认为空")]),s._v("\n")])])]),n("h4",{attrs:{id:"数据卷容器操作流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据卷容器操作流程"}},[s._v("#")]),s._v(" 数据卷容器操作流程")]),s._v(" "),n("p",[s._v("如果使用数据卷容器，在多个容器间共享数据，并永久保存这些数据，需要有一个规范的流程才能做得到：")]),s._v(" "),n("p",[s._v("1、创建数据卷容器")]),s._v(" "),n("p",[s._v("2、其他容器挂载数据卷容器")]),s._v(" "),n("p",[s._v("注意：\n数据卷容器自身并不需要启动，但是启动的时候依然可以进行数据卷容器的工作。")]),s._v(" "),n("h3",{attrs:{id:"_2-3-4-数据卷容器实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-数据卷容器实践"}},[s._v("#")]),s._v(" 2.3.4 数据卷容器实践")]),s._v(" "),n("p",[s._v("数据卷容器实践包括两部分：创建数据卷容器和使用数据卷容器")]),s._v(" "),n("h4",{attrs:{id:"创建一个数据卷容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建一个数据卷容器"}},[s._v("#")]),s._v(" 创建一个数据卷容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker create -v "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器数据卷目录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名字"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("可选"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行效果")]),s._v("\n$ docker create -v /data --name v1-test1 nginx\n")])])]),n("h4",{attrs:{id:"创建两个容器，同时挂载数据卷容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建两个容器，同时挂载数据卷容器"}},[s._v("#")]),s._v(" 创建两个容器，同时挂载数据卷容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker run --volumes-from "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("数据卷容器id/name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -tid --name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名字"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("命令"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("可选"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行效果：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建 vc-test1 容器:")]),s._v("\ndocker run --volumes-from 4693558c49e8 -tid --name vc-test1 nginx /bin/bash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建 vc-test2 容器:")]),s._v("\ndocker run --volumes-from 4693558c49e8 -tid --name vc-test2 nginx /bin/bash\n\n")])])]),n("h4",{attrs:{id:"确认卷容器共享"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#确认卷容器共享"}},[s._v("#")]),s._v(" 确认卷容器共享")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入vc-test1，操作数据卷容器:")]),s._v("\n:~$  docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it vc-test1 /bin/bash\nroot@c408f4f14786:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /data/")]),s._v("\nroot@c408f4f14786:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 'v-test1' > /data/v-test1.txt")]),s._v("\nroot@c408f4f14786:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入vc-test2，确认数据卷:")]),s._v("\n:~$  docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it vc-test2 /bin/bash\nroot@7448eee82ab0:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 'v-test2' > /data/v-test2.txt")]),s._v("\nroot@7448eee82ab0:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /data/")]),s._v("\nv-test1.txt\nroot@7448eee82ab0:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#回到vc-test1进行验证")]),s._v("\n:~$  docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it vc-test1 /bin/bash\nroot@c408f4f14786:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /data/")]),s._v("\nv-test1.txt  v-test2.txt\nroot@c408f4f14786:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /data/v-test2.txt ")]),s._v("\nv-test2\n")])])]),n("h3",{attrs:{id:"_2-3-5-数据备份原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-5-数据备份原理"}},[s._v("#")]),s._v(" 2.3.5 数据备份原理")]),s._v(" "),n("p",[s._v("为什么需要数据备份和恢复？\n工作中很多的容器的数据需要查看，所有需要备份将数据很轻松的拿到本地目录。")]),s._v(" "),n("p",[s._v("原理图：")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/%E5%A4%87%E4%BB%BD.png",alt:"备份"}})]),s._v(" "),n("p",[s._v("数据备份方案：\n1 创建一个挂载数据卷容器的容器")]),s._v(" "),n("p",[s._v("2 挂载宿主机本地目录作为备份数据卷")]),s._v(" "),n("p",[s._v("3 将数据卷容器的内容备份到宿主机本地目录挂载的数据卷中")]),s._v(" "),n("p",[s._v("4 完成备份操作后销毁刚创建的容器")]),s._v(" "),n("h3",{attrs:{id:"_2-3-6-数据备份实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-6-数据备份实践"}},[s._v("#")]),s._v(" 2.3.6 数据备份实践")]),s._v(" "),n("p",[s._v("在2.3.4的数据卷容器基础上做数据的备份")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n$ docker run --rm --volumes-from "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("数据卷容器id/name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("宿主机目录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器目录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("备份命令"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建备份目录:")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /backup/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建备份的容器:")]),s._v("\n$ docker run --rm --volumes-from 60205766d61a  -v /home/itcast/backup/:/backup/ nginx "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zcPf /backup/data.tar.gz /data\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#验证操作:")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /backup\n$ zcat /backup/data.tar.gz\n")])])]),n("p",[s._v("注释:\n​\t-P：使用原文件的原来属性（属性不会依据使用者而变），恢复字段到它们的原始方式，忽略现有的用户权限屏蔽位（umask)。 加了-p之后，tar进行解压后，生成的文件的权限，是直接取自tar包里面文件的权限（不会再使用该用户的umask值进行运算），那么不加-p参数，将还要再减去umask的值（位运算的减），但是如果使用root用户进行操作，加不加-p参数都一样。")]),s._v(" "),n("h3",{attrs:{id:"_2-3-7-数据还原原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-7-数据还原原理"}},[s._v("#")]),s._v(" 2.3.7 数据还原原理")]),s._v(" "),n("p",[s._v("原理图：")]),s._v(" "),n("p",[s._v("数据恢复方案"),n("img",{attrs:{src:"assets/%E8%BF%98%E5%8E%9F.png",alt:"还原"}}),s._v("\n1、创建一个新的数据卷容器（或删除原数据卷容器的内容）")]),s._v(" "),n("p",[s._v("2、创建一个新容器，挂载数据卷容器，同时挂载本地的备份目录作为数据卷")]),s._v(" "),n("p",[s._v("3、将要恢复的数据解压到容器中")]),s._v(" "),n("p",[s._v("4、完成还原操作后销毁刚创建的容器")]),s._v(" "),n("h3",{attrs:{id:"_2-3-8-数据还原实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-8-数据还原实践"}},[s._v("#")]),s._v(" 2.3.8 数据还原实践")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker run --rm -itd --volumes-from "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("数据要到恢复的容器"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("宿主机备份目录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器备份目录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("解压命令"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令实践：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动数据卷容器:")]),s._v("\n$ docker start c408f4f14786\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除源容器内容:")]),s._v("\n$  docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it vc-test1 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" \nroot@c408f4f14786:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rm -rf /data/*")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#恢复数据:")]),s._v("\ndocker run --rm --volumes-from v-test  -v /home/itcast/backup/:/backup/ nginx "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xPf /backup/data.tar.gz -C /data\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#验证:")]),s._v("\n:~$ docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it vc-test1/bin/bash \nroot@c408f4f14786:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /data/data/")]),s._v("\nv-test1.txt  v-test2.txt\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新建新的数据卷容器：")]),s._v("\n:~$ docker create -v /newdata --name v-test2 nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#简历新的容器挂载数据卷容器")]),s._v("\n:~$ docker run --volumes-from a7e9a33f3acb -tid --name vc-test3 nginx /bin/bash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#恢复数据：")]),s._v("\ndocker run --rm --volumes-from v-test2  -v /home/itcast/backup/:/backup/ nginx "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xPf /backup/data.tar.gz -C /newdata\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#验证:")]),s._v("\n:~$ docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it vc-test3 /bin/bash \nroot@c408f4f14786:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /newdata")]),s._v("\nv-test1.txt  v-test2.txt\n")])])]),n("p",[s._v("注意：\n解压的时候，如果使用目录的话，一定要在解压的时候使用 -C 制定挂载的数据卷容器，不然的话容器数据是无法恢复的，因为容器中默认的backup目录不是数据卷，即使解压后，也看不到文件。")]),s._v(" "),n("p",[s._v("数据是最宝贵的资源，docker在设计上考虑到了这点，并且为数据的操作提供了充分的支持。")]),s._v(" "),n("h2",{attrs:{id:"_2-4-网络管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-网络管理"}},[s._v("#")]),s._v(" 2.4 网络管理")]),s._v(" "),n("p",[s._v("​\tDocker 网络很重要，重要的，我们在上面学到的所有东西都依赖于网络才能工作。我们从两个方面来学习网络：端口映射和网络模式\n​\t为什么先学端口映射呢？\n在一台主机上学习网络，学习端口映射最简单，避免过多干扰。")]),s._v(" "),n("h3",{attrs:{id:"_2-4-1-端口映射详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1-端口映射详解"}},[s._v("#")]),s._v(" 2.4.1 端口映射详解")]),s._v(" "),n("p",[s._v("默认情况下，容器和宿主机之间网络是隔离的，我们可以通过端口映射的方式，将容器中的端口，映射到宿主机的某个端口上。这样我们就可以通过宿主机的ip+port的方式来访问容器里的内容")]),s._v(" "),n("p",[n("strong",[s._v("Docker的端口映射")])]),s._v(" "),n("p",[s._v("1、随机映射     -P(大写)")]),s._v(" "),n("p",[s._v("2、指定映射     -p 宿主机ip:宿主机端口:容器端口")]),s._v(" "),n("p",[s._v("注意：\n生产场景一般不使用随机映射，但是随机映射的好处就是由docker分配，端口不会冲突,\n不管哪种映射都会有所消耗，影响性能，因为涉及到映射的操作")]),s._v(" "),n("h3",{attrs:{id:"_2-4-2-随机映射实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2-随机映射实践"}},[s._v("#")]),s._v(" 2.4.2 随机映射实践")]),s._v(" "),n("p",[s._v("随机映射我们从两个方面来学习：\n1、默认随机映射\n2、指定主机随机映射")]),s._v(" "),n("h4",{attrs:{id:"默认随机映射"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#默认随机映射"}},[s._v("#")]),s._v(" 默认随机映射")]),s._v(" "),n("div",{staticClass:"language-SHELL extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker run -d -P "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令效果：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先启动一个普通的nginx镜像")]),s._v("\n$ docker run -d  nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看当前宿主机开放了哪些端口")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tnulp\n")])])]),n("p",[n("img",{attrs:{src:"assets/clip_image002.jpg",alt:"Proto  tcp  o.o.o.o:22  tcp  tcp  tcp6  tcp6  udp  udp  udp  udp  udp  udp6  udp6  Recv-Q  Send-Q  Local  Address  Foreign  o.o.o  o.o.o  o.o.o  o.o.o  o.o.o  o.o.o  o.o.o  o.o.o  Address  State  LISTEN  LISTEN  LISTEN  LISTEN  LISTEN  PID/Program name  127.0.1.1:53  127.0.0.1:631  o.o.o.o:5353  o.o.o.o:38319  o.o.o.o:48822  127.0. 1.1 53  o.o.o.o:55919  o ..:33152 "}})]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动一个默认随机映射的nginx镜像")]),s._v("\n$ docker run -d -P nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看当前宿主机开放了哪些端口")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tnulp\n")])])]),n("p",[n("img",{attrs:{src:"assets/clip_image002-1538459623213.jpg",alt:"N31S11  N31S11  N31S11  N31S11  N31S11  N31S11  aweu we-150-1d/OId  ssauppv  ZSIEE  ESES.  ES:VVYLZI  89LZE...  189. I..  ES:VVYLZI  ssauppv  leoo-l  D-puas  9dpn  9dpn  dpn  dpn  dpn  dpn  dpn  9dm  dm  dm  dm  modd "}})]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/clip_image004.jpg",alt:'docker  CONTAINER ID  564843c57f56  of..."  -g  1b8875c344fe  of..."  -g  itcast@itcast-virtual-machine : —$  IMAGE  nglnx  nglnx  ps  COMMAND  " nglnx  " nglnx  daemon  daemon  CREATED  6 minutes  6 minutes  ago  ago  STATUS  Up 6 minutes  Up 6 minutes  PORTS  o.o.o.o:32768  80/tcp  ->80/tcp  NAMES  modest swartz  zealous jackson '}})]),s._v(" "),n("p",[n("strong",[s._v("注意：")]),s._v("\n​    宿主机的32768被映射到容器的80端口\n-P 自动绑定所有对外提供服务的容器端口，映射的端口将会从没有使用的端口池中自动随机选择，\n但是如果连续启动多个容器的话，则下一个容器的端口默认是当前容器占用端口号+1")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/1541588399807.png",alt:"1541588399807"}})]),s._v(" "),n("p",[s._v("在浏览器中访问http://192.168.110.20:32768")]),s._v(" "),n("p",[s._v("效果显示\n"),n("img",{attrs:{src:"assets/1541588444804.png",alt:"1541588444804"}})]),s._v(" "),n("p",[s._v("注意：\n浏览器输入的格式是： docker容器宿主机的ip:容器映射的端口")]),s._v(" "),n("h4",{attrs:{id:"指定主机随机映射"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#指定主机随机映射"}},[s._v("#")]),s._v(" 指定主机随机映射")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式")]),s._v("\n    :~$ docker run -d -p "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("宿主机ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("::"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器端口"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令效果")]),s._v("\n    :~$ docker run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".8.14::80 --name nginx-1 nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检查效果")]),s._v("\n    :~$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" \n")])])]),n("h3",{attrs:{id:"_2-4-3-指定映射实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-3-指定映射实践"}},[s._v("#")]),s._v(" 2.4.3 指定映射实践")]),s._v(" "),n("p",[n("strong",[s._v("指定端口映射我们从二个方面来讲")]),s._v("：")]),s._v(" "),n("p",[s._v("指定端口映射")]),s._v(" "),n("p",[s._v("指定多端口映射")]),s._v(" "),n("h4",{attrs:{id:"指定端口映射"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#指定端口映射"}},[s._v("#")]),s._v(" 指定端口映射")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n    docker run -d -p "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("宿主机ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("宿主机端口"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器端口"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名字"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果不指定宿主机ip的话，默认使用 0.0.0.0，")]),s._v("\n    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令实践：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#现状我们在启动容器的时候，给容器指定一个访问的端口 1199")]),s._v("\n    docker run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".8.14:1199:80 --name nginx-2 nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看新容器ip")]),s._v("\n    docker inspect --format"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'")]),s._v(" 0ad3acfbfb76\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器端口映射")]),s._v("\n    docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" \n")])])]),n("h4",{attrs:{id:"多端口映射方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多端口映射方法"}},[s._v("#")]),s._v(" 多端口映射方法")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式")]),s._v("\n    docker run -d -p "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("宿主机端口1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器端口1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  -p "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("宿主机端口2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器端口2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开起多端口映射实践")]),s._v("\n    docker run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("520")]),s._v(":443 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6666")]),s._v(":80 --name nginx-3 nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器进程")]),s._v("\n    docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" \n")])])]),n("h3",{attrs:{id:"_2-4-4-网络管理基础"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-4-网络管理基础"}},[s._v("#")]),s._v(" 2.4.4 网络管理基础")]),s._v(" "),n("h4",{attrs:{id:"docker网络命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker网络命令"}},[s._v("#")]),s._v(" docker网络命令")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看网络命令帮助")]),s._v("\n:~$ docker network "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v("\n    。。。。。。\nconnect     Connect a container to a network\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将一个容器连接到一个网络")]),s._v("\ncreate      Create a network\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建一个网络")]),s._v("\ndisconnect  Disconnect a container from a network\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#从网络断开一个容器")]),s._v("\ninspect     Display detailed information on one or "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" networks\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在一个或多个网络上显示详细信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("          List networks\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网络列表")]),s._v("\nprune       Remove all unused networks\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除所有未使用的网络")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("          Remove one or "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" networks\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除一个或多个网络。")]),s._v("\n")])])]),n("h4",{attrs:{id:"经常使用的网络查看命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#经常使用的网络查看命令"}},[s._v("#")]),s._v(" 经常使用的网络查看命令")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看当前主机网络")]),s._v("\n$ docker network "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\nNETWORK ID          NAME                DRIVER              SCOPE\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网络id             #名称               #驱动                #范围")]),s._v("\nc2dcffa83a29        bridge              bridge              "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\nc4deefdaf53b        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n57942890c6d6        none                null                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看bridge的网络内部信息")]),s._v("\n:~$ docker network inspect bridge\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),s._v(",\n。。。。。。\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Config"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Subnet"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.0/16"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.1"')]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n。。。。。。\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1f182f7163cb194c7d49c75e46fc6dc7cbee59b55f04d74319df75b45a6f5ba0"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-2"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9e91f5d77b9c0ef85bb8a4f8aa2f4fb883243371b0946ee5f5e728ba9a409b0d"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:ac:11:00:03"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.3/16"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"faecdcae982a658b1c1a1abbd57125ca5eae5234d3e684ce771b8a952317a3b6"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-1"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"72f7a99c28838ee670240c9e7bd79eee24c0dea28203e4fe0286fdb3ab084ac7"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:ac:11:00:02"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.2/16"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),n("h4",{attrs:{id:"回忆一下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#回忆一下"}},[s._v("#")]),s._v(" "),n("strong",[s._v("回忆一下")])]),s._v(" "),n("h5",{attrs:{id:"查看容器详细信息-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看容器详细信息-2"}},[s._v("#")]),s._v(" 查看容器详细信息")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n    docker inspect "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令效果：")]),s._v("\n    查看容器全部信息:\n    :~$ docker inspect 930f29ccdf8a\n    查看容器网络信息:\n    :~$ docker inspect --format"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'")]),s._v(" 930f29ccdf8a\n")])])]),n("h5",{attrs:{id:"查看容器端口信息-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看容器端口信息-2"}},[s._v("#")]),s._v(" 查看容器端口信息")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n    docker port "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令效果：")]),s._v("\n    :~$ docker port 930f29ccdf8a\n")])])]),n("h3",{attrs:{id:"_2-4-5-网络模式简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-5-网络模式简介"}},[s._v("#")]),s._v(" 2.4.5 网络模式简介")]),s._v(" "),n("p",[s._v("​\t从1.7.0版本开始，Docker正式把网络跟存储这两个部分的功能实现都以插件化的形式剥离出来，允许用户通过指令来选择不同的后端实现。这也就是Docker希望构建围绕着容器的强大生态系统的一些积极尝试。\n​\t剥离出来的独立网络项目叫做libnetwork，libnetwork中的网络模型（Container Networking Model ，CNM）十分简洁，可以让上层的大量应用容器最大程度上不去关心底层实现。")]),s._v(" "),n("h4",{attrs:{id:"docker的常用的网络模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker的常用的网络模式"}},[s._v("#")]),s._v(" docker的常用的网络模式")]),s._v(" "),n("p",[n("strong",[s._v("bridge模式：")]),s._v("\n简单来说：就是穿马甲，打着宿主机的旗号，做自己的事情。\nDocker的"),n("strong",[s._v("默认模式")]),s._v("，它会在docker容器启动时候，自动配置好自己的网络信息，同一宿主机的所有容器都在一个网络下，彼此间可以通信。类似于我们vmware虚拟机的桥接模式。\n利用宿主机的网卡进行通信，因为涉及到网络转换，所以会造成资源消耗，网络效率会低。")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/1541589586675.png",alt:"1541589586675"}})]),s._v(" "),n("p",[n("strong",[s._v("host模式：")]),s._v("\n简单来说，就是鸠占鹊巢，用着宿主机的东西，干自己的事情。容器使用宿主机的ip地址进行通信。\n特点：容器和宿主机共享网络")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/1541589598705.png",alt:"1541589598705"}})]),s._v(" "),n("p",[n("strong",[s._v("container模式：")]),s._v("\n新创建的容器间使用，使用已创建的容器网络，类似一个局域网。\n特点：容器和容器共享网络")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/1541589611351.png",alt:"1541589611351"}})]),s._v(" "),n("p",[n("strong",[s._v("none模式：")]),s._v("\n这种模式最纯粹，不会帮你做任何网络的配置，可以最大限度的定制化。\n不提供网络服务，容器启动后无网络连接。")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/1541589645492.png",alt:"1541589645492"}})]),s._v(" "),n("p",[n("strong",[s._v("overlay模式：")]),s._v("\n容器彼此不再同一网络，而且能互相通行。")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/1541589665251.png",alt:"1541589665251"}})]),s._v(" "),n("h3",{attrs:{id:"_2-4-6-定制bridge实践一"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-6-定制bridge实践一"}},[s._v("#")]),s._v(" 2.4.6 定制bridge实践一")]),s._v(" "),n("p",[s._v("​\t其实我们在端口映射的部分就是bridge模式的简单演示了，因为他们使用的是默认bridge网络模式，现在我们来自定义桥接网络。\n​\t"),n("strong",[s._v("这一部分我们从三个方面来演示：")]),s._v("\n​\t创建桥接网络")]),s._v(" "),n("p",[s._v("​\t使用自定义网络创建容器")]),s._v(" "),n("p",[s._v("​\t容器断开、连接网络")]),s._v(" "),n("h4",{attrs:{id:"创建网络"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建网络"}},[s._v("#")]),s._v(" 创建网络")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\ndocker network create --driver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("网络类型"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("网络名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#参数")]),s._v("\ncreate  \t创建一个网络\n--driver\t指定网络类型\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n$ docker network create --driver bridge bridge-test\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看主机网络类型:")]),s._v("\n:~$ docker network "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nNETWORK ID          NAME                DRIVER              SCOPE\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网络id              #名称               #驱动                #范围")]),s._v("\nc2dcffa83a29        bridge              bridge              "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\nc4deefdaf53b        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n57942890c6d6        none                null                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\nd5c061bc02b1        bridge-test         bridge              "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看新建网络的网络信息")]),s._v("\n:~$ docker network inspect  bridge-test \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge-test"')]),s._v(",\n。。。。。。\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Config"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Subnet"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.0/16"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ip/子网")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.1"')]),s._v("#网关\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n。。。。。。\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#宿主机又多出来一个网卡设备：")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\nbr-17847710137f Link encap:以太网  硬件地址 02:42:cb:8b:48:37  \ninet 地址:172.18.0.1  广播:172.18.255.255  掩码:255.255.0.0\n。。。。。。\n")])])]),n("h4",{attrs:{id:"自定义网段与网关"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义网段与网关"}},[s._v("#")]),s._v(" 自定义网段与网关")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#自定义网段与网关")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看关于网段和网管的相关命令")]),s._v("\n:~$ docker network create --help\n\n--gateway strings      IPv4 or IPv6 Gateway "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the master subnet\n                           主子网的IPv4或IPv6网关。\n\n--subnet strings       Subnet "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" CIDR "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),s._v(" that represents a network segment\n                        表示网络段的CIDR格式的子网。\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看刚刚创建的网络信息")]),s._v("\n:~$ docker network inspect bridge-test \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge-test"')]),s._v(",\n\n。。。\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Config"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Subnet"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.0/16"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ip/子网")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.1"')]),s._v("#网关\n。。。\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建自定义网段与网关信息")]),s._v("\n:~$ docker network create --driver bridge --gateway "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.99")]),s._v(".0.1 --subnet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.99")]),s._v(".0.0/16 bridge-test1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#成功返回对应的sha256码")]),s._v("\n9d02a01fa98b7a538027b624171481a2098232fa707cdc83084fc880d0afd091\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看网络列表")]),s._v("\n:~$ docker network "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nNETWORK ID          NAME                DRIVER              SCOPE\nc2dcffa83a29        bridge              bridge              "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n17847710137f        bridge-test         bridge              "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n9d02a01fa98b        bridge-test1        bridge              "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\nc4deefdaf53b        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n57942890c6d6        none                null                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看自定义网络的网关与网络信息")]),s._v("\n:~$ docker network inspect bridge-test1 \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge-test1"')]),s._v(",\n。。。。。。\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Config"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Subnet"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.99.0.0/16"')]),s._v("#ip/子网\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.99.0.1"')]),s._v("#网关\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n。。。。\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看主机网络信息")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\nbr-9d02a01fa98b Link encap:以太网  硬件地址 02:42:41:18:2c:5a  \n          inet 地址:172.99.0.1  广播:172.99.255.255  掩码:255.255.0.0\n          UP BROADCAST MULTICAST  MTU:1500  跃点数:1\n          接收数据包:0 错误:0 丢弃:0 过载:0 帧数:0\n          发送数据包:0 错误:0 丢弃:0 过载:0 载波:0\n          碰撞:0 发送队列长度:0 \n          接收字节:0 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  发送字节:0 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),n("h4",{attrs:{id:"在自定义网络中启动容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在自定义网络中启动容器"}},[s._v("#")]),s._v(" 在自定义网络中启动容器")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式： ")]),s._v("\n    docker run --net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("网络名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" -itd --name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用效果：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看创建的网络bridge-test")]),s._v("\n    :~$ docker network inspect bridge-test\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器是空的")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看创建的网络bridge-test1")]),s._v("\n    :~$ docker network inspect bridge-test1\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器也是是空的")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建启动1个使用网络为bridge-test  名为nginx--1的容器")]),s._v("\n    :~$ docker run --net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bridge-test -itd --name nginx--1 nginx\n    ff07009ba3c29872145630814d163ccffe72643abef3acda2d443d6848004d87\n\n``"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看下容器")]),s._v("\n:~$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID        IMAGE        COMMAND                  CREATED         STATUS          PORTS      NAMES\nff07009ba3c2        nginx        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" minutes ago   Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" minutes    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp     nginx--1\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器的信息 ")]),s._v("\n:~$ docker inspect ff07009ba3c2\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网络信息已经变成bridge-test的网段了")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.1"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.2"')]),s._v(",\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建启动1个使用网络为bridge-test1  名为nginx--2的容器")]),s._v("\n:~$ docker run --net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bridge-test1 -itd --name nginx--2 nginx\ncc55de5710ad8133991d52482d363b42dcdf6fff50f476b3024c626eb1c14da3\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看下容器")]),s._v("\n:~$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID        IMAGE        COMMAND                  CREATED         STATUS          PORTS      NAMES\ncc55de5710ad        nginx        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" seconds ago   Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp     nginx--2\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器的信息")]),s._v("\n:~$ docker inspect cc55de5710ad\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网络信息已经变成bridge-test1的网段了")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.99.0.1"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.99.0.2"')]),s._v(",\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看bridge-test的网络信息")]),s._v("\n:~$ docker network inspect bridge-test\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#bridge-test下包含了nginx--1")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ff07009ba3c29872145630814d163ccffe72643abef3acda2d443d6848004d87"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx--1"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"e2e8ba3091b27b333cf73673059dbc3a973540873fe64bd6c6300c89dc57eb75"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:ac:12:00:02"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.2/16"')]),s._v(",\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看bridge-test1的网络信息")]),s._v("\n:~$ docker network inspect bridge-test1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#bridge-test下包含了nginx--2")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cc55de5710ad8133991d52482d363b42dcdf6fff50f476b3024c626eb1c14da3"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx--2"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"66eefc70755e94a306a7b71ea08f262ea656f7e7a2b117ee716e9de2014a35e5"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:ac:63:00:02"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.99.0.2/16"')]),s._v(",\n\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("``\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意部分")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用默认的桥接模型创建的容器是可以直接联网的。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用自定义的桥接模型创建的容器不可以直接联网，但是可以通过端口映射来实现联网")]),s._v("\n")])])]),n("h4",{attrs:{id:"容器断开网络"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器断开网络"}},[s._v("#")]),s._v(" 容器断开网络")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式： ")]),s._v("\n    docker network disconnect "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("网络名"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n    docker network disconnect bridge-test nginx1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#效果展示：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#断开容器nginx--1网络bridge-test")]),s._v("\n    :~$ docker network disconnect bridge-test nginx--1\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看下容器")]),s._v("\n    :~$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现nginx-1的网络消失")]),s._v("\n    CONTAINER ID        IMAGE        COMMAND                  CREATED             STATUS              PORTS   NAMES\n    ff07009ba3c2        nginx        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v(" minutes ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v(" minutes               nginx--1\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#断开容器nginx--2网络bridge-test1")]),s._v("\n    :~$ docker network disconnect bridge-test1 nginx--2 \n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看下容器")]),s._v("\n    :~$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现nginx-2的网络消失")]),s._v("\n    CONTAINER ID        IMAGE        COMMAND                  CREATED             STATUS              PORTS   NAMES\n    cc55de5710ad        nginx        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" minutes ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" minutes               nginx--2\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#分别查看网络bridge-test  bridge-test1的网络")]),s._v("\n    :~$ docker network inspect bridge-test\n    :~$ docker network inspect bridge-test1\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现容器内容消失")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#已经没有容器了")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#分别查看两个容器的信息发现容器网络信息消失")]),s._v("\n    :~"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" inspect nginx--1\n    :~"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" inspect nginx--2\n\n \n")])])]),n("h4",{attrs:{id:"容器连接网络"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器连接网络"}},[s._v("#")]),s._v(" 容器连接网络")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式： ")]),s._v("\n    docker network connect "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("网络名"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令演示：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将容器nginx--1连接到bridge-test1网络")]),s._v("\n:~$ docker network connect bridge-test1 nginx--1\n:~$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINERID IMAGE COMMAND             CREATED        STATUS     PORTS NAMES\ncc55de5710ad nginx "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-g\'daemonof…"')]),s._v(" Aboutanhourago UpAboutanhour    nginx--2\n    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将容器nginx--2连接到bridge-test网络")]),s._v("\n:~$ docker network connect bridge-test nginx--2\n:~$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINERID  IMAGE COMMAND             CREATED         STATUS        PORTS    NAMES\nff07009ba3c2 nginx "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-g\'daemonof…"')]),s._v(" Aboutanhourago  UpAboutanhour "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   nginx1\n    \n查看bridge-test网络是否包含容器\n:~$ docker network inspect bridge-test\n           "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cc55de5710ad8133991d52482d363b42dcdf6fff50f476b3024c626eb1c14da3"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx--2"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6eee4258bc62645fd611f292f52e8b0ea2d0262ab5c99bc097f26eed95d1f886"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:ac:12:00:02"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.2/16"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n                    \n查看bridge-test1网络是否包含容器\n:~$ docker network inspect bridge-test1\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ff07009ba3c29872145630814d163ccffe72643abef3acda2d443d6848004d87"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx--1"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0c0367f49338274698e58aed371bf582d931d5824edf7f1385637ea3fabd242c"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:ac:63:00:02"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.99.0.2/16"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n")])])]),n("h3",{attrs:{id:"_2-4-7-定制bridge实践二"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-7-定制bridge实践二"}},[s._v("#")]),s._v(" 2.4.7 定制bridge实践二")]),s._v(" "),n("p",[s._v("​\t之前我们创建的容器，它们的ip都是从docker0自动获取的，接下来我们自己定义一个br0网桥，然后启动的容器就用这个")]),s._v(" "),n("p",[n("strong",[s._v("网桥是什么？")]),s._v("\n他是一种设备，根据设备的物理地址来划分网段，并传输数据的，docker0就是默认的网桥。")]),s._v(" "),n("p",[n("strong",[s._v("需求：")]),s._v("\n定制docker网桥")]),s._v(" "),n("p",[n("strong",[s._v("分析")]),s._v("：\n1、网桥的创建")]),s._v(" "),n("p",[s._v("2、docker服务使用新网桥")]),s._v(" "),n("p",[s._v("3、测试")]),s._v(" "),n("p",[n("strong",[s._v("知识点")]),s._v("：\n1、bridge-utils软件的brctl工具可以实现创建网桥\n2、\n​\t配置/etc/default/docker文件\n​\t编辑systemctl的配置文件使用该docker文件\n​\t重载systemctl配置\n​\t重启docker\n3、创建容器，查看容器信息即可")]),s._v(" "),n("p",[n("strong",[s._v("实施")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1、网桥环境部署")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.1 网桥软件部署")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ubuntu默认不自带网桥管理工具，安装网桥软件")]),s._v("\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" bridge-utils -y\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看网卡")]),s._v("\n    :~$ brctl show\n    bridge name  bridge "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("       STP enabled    interfaces \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网卡名称     网卡id           STP启用         物理接口")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.2 创建网桥")]),s._v("\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" brctl addbr br0\n    :~$ brctl show\n    bridge name bridge "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("       STP enabled interfaces\n    br0     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000.000000000000")]),s._v("   no      \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#给网桥设置网段")]),s._v("\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" br0 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".99.1 netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\n    br0       Link encap:以太网  硬件地址 f2:6c:fb:c6:89:f4  \n          inet 地址:192.168.99.1  广播:192.168.99.255  掩码:255.255.255.0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2、docker配置网桥")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.1    配置docker文件")]),s._v("\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/default/docker\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最末尾添加")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKER_OPTS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-b=br0"')]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.2    systemctl使用docker文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建服务依赖文件")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/systemd/system/docker.service.d\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/systemd/system/docker.service.d/Using_Environment_File.conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#内容如下：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EnvironmentFile")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-/etc/default/docker \n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/dockerd -H fd:// "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOCKER_OPTS")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重载服务配置文件")]),s._v("\n:~$ systemctl daemon-reload\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.3    重启docker ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启前效果")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" docker \nroot      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32949")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.4")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("783160")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("59632")]),s._v(" ?        Ssl  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("月24   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":01 /usr/bin/dockerd -H fd://\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启")]),s._v("\n:~$ systemctl restart docker\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启后效果")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" docker \nroot  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("45737")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.3")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("527600")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50572")]),s._v(" ?  Ssl 09:32 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 /usr/bin/dockerd -H fd:// -b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("br0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3、容器测试")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3.1 创建容器并测试")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建默认网络的容器")]),s._v("\n    :~$ docker run -itd --name nginx--3 nginx\n    92d4b5e434d2ba1a00426e987b113fdaa1dff82364240a9c498ee813529331b4\n    \n    :~$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINERID  IMAGE COMMAND                CREATED      STATUS      PORTS    NAMES\n92d4b5e434d2 nginx "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v(" 5secondsago  Up4seconds  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   nginx--3\n    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看信息已经使用了br0的网卡的网络")]),s._v("\n:~$ docker inspect 92d4b5e434d2\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.1"')]),s._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.2"')]),s._v(",\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看下网络")]),s._v("\n:~$ docker network "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nNETWORK ID          NAME                DRIVER              SCOPE\ne2f5f07d1d54        bridge              bridge              "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看网络下的容器")]),s._v("\n:~$ docker network inspect bridge\n \n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Driver"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Config"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Subnet"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.0/24"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.1"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"92d4b5e434d2ba1a00426e987b113fdaa1dff82364240a9c498ee813529331b4"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx--3"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b5c2e1ea9dcd722b102b7f63f569604cd65be378da649e8f8edd492c083cfec5"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:c0:a8:63:02"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.99.2/24"')]),s._v(",\n")])])]),n("h3",{attrs:{id:"_2-4-8-host模型实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-8-host模型实践"}},[s._v("#")]),s._v(" 2.4.8 host模型实践")]),s._v(" "),n("p",[s._v("host模型我们知道，容器使用宿主机的ip地址进行对外提供服务，本身没有ip地址。")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n    docker run --net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host -itd --name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 镜像名称\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令示例：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看下网络情况")]),s._v("\n    :~$ docker network "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n    NETWORK ID          NAME                DRIVER              SCOPE\n    35e1fe4bfd90        bridge              bridge              "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n    b5a84f949a9f        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n    e70e4cb94db2        none                null                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看host下有哪些容器")]),s._v("\n    :~$ docker network  inspect  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现是空的")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看宿主机启动网络")]),s._v("\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tnulp \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现没有80端口  ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据host网络创建启动容器")]),s._v("\n    :~$ docker run --net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("host -itd --name nginx-1 nginx\n    cf5f44228d7efa6271d494bc658a8073c1a3961dc0c7acab3c58796dfa925f6e\n    :~$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现没有端口映射")]),s._v("\nCONTAINER ID    IMAGE    COMMAND                  CREATED             STATUS              PORTS   NAMES\ncf5f44228d7e    nginx    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" minutes ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" minutes               nginx-1\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看宿主机启动网络")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tnulp \nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多出了80端口           ")]),s._v("\ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      -               \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看host下有哪些容器")]),s._v("\n:~$ docker network  inspect  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现网络下包含了容器 nginx-1")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cf5f44228d7efa6271d494bc658a8073c1a3961dc0c7acab3c58796dfa925f6e"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-1"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"98f3a7d052fabd7aa3e06c5a8d95d1db1ed28ffd81f7b0344b104217a505f94b"')]),s._v(",\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看nginx-1这个容器的全部信息")]),s._v("\n:~$ docker inspect nginx-1 \n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现网络信息为空")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Networks"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAMConfig"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Links"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Aliases"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NetworkID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b5a84f949a9f2466430c7734a9e68d4499382efdee27886cb97bfdec0fb3834f"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"98f3a7d052fabd7aa3e06c5a8d95d1db1ed28ffd81f7b0344b104217a505f94b"')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPPrefixLen"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GlobalIPv6Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GlobalIPv6PrefixLen"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DriverOpts"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null\n")])])]),n("p",[n("strong",[s._v("查看网络运行效果")]),s._v("\nhttp://192.168.110.4")]),s._v(" "),n("p",[n("strong",[s._v("此处IP为对应宿主机ip并不固定")])]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/1541591791777.png",alt:"1541591791777"}})]),s._v(" "),n("p",[n("strong",[s._v("host特点：")]),s._v("\n​\thost模型比较适合于，一台宿主机跑一个固定的容器，比较稳定，或者一个宿主机跑多个占用不同端口的应用的场景，他的网络性能是很高的。\n​\thost模型启动的容器不会有任何地址，他其实是使用了宿主机的所有信息")]),s._v(" "),n("h3",{attrs:{id:"_2-4-9-none-模型实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-9-none-模型实践"}},[s._v("#")]),s._v(" 2.4.9 none 模型实践")]),s._v(" "),n("p",[s._v("none网络模式，是一种自由度非常高的网络模式，我们可以最大化的自定义我们想要的网络")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令格式：")]),s._v("\n     docker run --net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none -itd --name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("容器名称"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 镜像名称     \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令示例：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看网络")]),s._v("\n    itcast@itcast-virtual-machine:~$ docker network "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n    NETWORK ID          NAME                DRIVER              SCOPE\n    35e1fe4bfd90        bridge              bridge              "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n    b5a84f949a9f        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n    e70e4cb94db2        none                null                "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看网络none的信息")]),s._v("\n    :~$ docker  network inspect  none\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现包含容器为空")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"none"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据none网络创建nginx-2容器")]),s._v("\n    :~$ docker run -itd --name nginx-2 --net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none nginx\n    31b52114415459a415ffebb527aea43b857f4c4f82daaab363293a0a98cef713\n \n    :~$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINERID  IMAGE COMMAND             CREATED         STATUS         PORTS  NAMES\n31b521144154 nginx "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-g\'daemonof…"')]),s._v(" Aboutaminuteago UpAboutaminute      nginx-2\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看nginx-2的全部信息")]),s._v("\n    :~$ docker inspect  nginx-2\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现网络信息皆为空 ")]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Networks"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"none"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAMConfig"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Links"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Aliases"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NetworkID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"e70e4cb94db206011a26daa48331d376318fd6060ac20f027709d5e6b70fdbc2"')]),s._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2bcba7434eee8ec827192b45bb0b0d2b71c916fd7da5a21562a34dca3726387a"')]),s._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPPrefixLen"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GlobalIPv6Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GlobalIPv6PrefixLen"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DriverOpts"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    :~$ docker network inspect none\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#none网络下有none的网络下包含容器 nginx-2并且没有网络信息")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"none"')]),s._v(",\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Containers"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"31b52114415459a415ffebb527aea43b857f4c4f82daaab363293a0a98cef713"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-2"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2bcba7434eee8ec827192b45bb0b0d2b71c916fd7da5a21562a34dca3726387a"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv4Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tnulp\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现并没有80端口的网络启动")]),s._v("\nProto Recv-Q Send-Q Local Address      Foreign Address   State      PID/Program name\n    tcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".1.1:53   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*         LISTEN     -               \n    tcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:22     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*         LISTEN     -               \n    tcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:631  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*         LISTEN     -                             \n    tcp6       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::22          :::*              LISTEN     -               \n    tcp6       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:631        :::*              LISTEN     -               \n    udp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".1.1:53   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*                           -               \n    udp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:45194  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*                           -               \n    udp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:631    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*                           -               \n    udp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:39822  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*                           -               \n    udp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:5353   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*                           -               \n    udp6       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::56067       :::*                                -               \n    udp6       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::5353        :::*                                -               \n\n")])])]),n("h3",{attrs:{id:"_2-4-10-none案例-自定义桥接网络"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-10-none案例-自定义桥接网络"}},[s._v("#")]),s._v(" 2.4.10 none案例--自定义桥接网络")]),s._v(" "),n("p",[s._v("**配置自定义桥接网络案例 **\n为了使本地网络中和Docker容器更方便的通信，我们经常会有将Docker容器配置到和主机同一网段，而且还要指定容器的ip地址。")]),s._v(" "),n("p",[n("strong",[s._v("需求")]),s._v("：\n自定义容器网络和宿主机为同一网段，容器ip可以指定。")]),s._v(" "),n("p",[n("strong",[s._v("案例分析：")]),s._v("\n1、自定义容器网络段和宿主机一样")]),s._v(" "),n("p",[s._v("2、自定义容器ip地址\n"),n("strong",[s._v("知识关键点：")]),s._v("\n1、网络配置")]),s._v(" "),n("p",[s._v("docker虚拟网桥配置")]),s._v(" "),n("p",[s._v("docker服务使用网桥")]),s._v(" "),n("p",[s._v("容器创建使用none模式")]),s._v(" "),n("p",[s._v("2、使用pipwork工具实现定制docker容器ip地址")]),s._v(" "),n("p",[s._v("注释：pipwork的命令格式")]),s._v(" "),n("p",[s._v("pipework [桥接设备][容器id或者名字] [容器ip]/[ip掩码]@[宿主机网关]")]),s._v(" "),n("p",[s._v("例子：")]),s._v(" "),n("p",[s._v("pipework br0 ubuntu-test1 192.168.8.201/24@192.168.8.2")]),s._v(" "),n("p",[s._v("3、映射虚拟机软件源进入到容器，替换掉容器内部软件源后进行软件源更新与安装")]),s._v(" "),n("p",[s._v("注释：docker上pull下来的Ubuntu,使用apt-get  install 命令下载速度奇慢无比,需要修改其软件源,进入etc/apt")]),s._v(" "),n("p",[s._v("目录欲修改sources.list     发现vi,vim,gedit都没有,再下这些软件也非常慢.")]),s._v(" "),n("p",[s._v("解决方法：")]),s._v(" "),n("p",[s._v("3.1启动容器时,挂载本地Linux系统的etc/apt文件")]),s._v(" "),n("p",[s._v("docker run -ti -v /etc/apt/:/home/etc ubuntu")]),s._v(" "),n("p",[s._v("3.2删除容器下的sources.lis   rm /etc/apt/sources.list")]),s._v(" "),n("p",[s._v("3.3将本地sources.list 复制过来 cp /home/etc/sources.list  /etc/apt/")]),s._v(" "),n("p",[n("strong",[s._v("自定义桥接网络实施")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1、网络环境部署")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.1 网卡环境部署")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.1.1 网桥软件部署")]),s._v("\n\t:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" bridge-utils -y\n\t\n\t:~$ brctl show\n\tbridge  name    bridge "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("           STP enabled interfaces\n\tdocker0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v(".0242a6e980f2   no      \n\t \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.1.2 桥接网卡配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编辑网卡信息编辑Ubuntu的网卡信息文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对源文件进行备份")]),s._v("\n\t:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/network/interfaces /etc/network/interfaces-old\n\t:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/network/interfaces\n\t\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#与源文件内容进行1行的空行")]),s._v("\nauto br0\niface br0 inet static \naddress "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.14\nnetmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0\ngateway "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.2\ndns-nameservers "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.2 \nbridge_ports ens33\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" networking restart\n    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.2    docker服务配置")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.2.1  配置docker文件")]),s._v("\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/default/docker\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最末尾添加")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKER_OPTS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-b=br0"')]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.2.2  systemctl使用docker文件")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建服务依赖文件")]),s._v("\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/systemd/system/docker.service.d\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/systemd/system/docker.service.d/Using_Environment_File.conf\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#内容如下：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EnvironmentFile")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-/etc/default/docker\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/dockerd -H fd:// "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOCKER_OPTS")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重载服务配置文件")]),s._v("\n    :~$ systemctl daemon-reload\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.2.3  重启docker 第一次配置的时候需要重启linux虚拟机：reboot")]),s._v("\nsystemctl restart docker\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意查看网卡信息")]),s._v("\n    :~$ brctl show\n    bridge      name    bridge "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("           STP enabled     interfaces\n    br0                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v(".000c2960060c   no              ens33\n    docker0             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v(".02427c11f899   no  \n    \n    br0       Link encap:以太网  硬件地址 00:0c:29:60:06:0c  \n         inet 地址:192.168.110.14  广播:192.168.110.255  掩码:255.255.255.0\n         inet6 地址: fe80::20c:29ff:fe60:60c/64 Scope:Link\n         UP BROADCAST RUNNING MULTICAST  MTU:1500  跃点数:1\n     \n    ens33     Link encap:以太网  硬件地址 00:0c:29:60:06:0c  \n      UP BROADCAST RUNNING MULTICAST  MTU:1500  跃点数:1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#广播运行多播")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#验证dns解析是否正常")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" www.baidu.com   \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网络可能会没有dns解析所以我们需要进行dns的配置")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#16.04：")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" vim/etc/resolvconf/resolv.conf.d/base\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#18.04：")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" vim/etc/resolv.conf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#增加内容")]),s._v("\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("223.5")]),s._v(".5.5\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意如果重启后网络并未生效则")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /etc/init.d/networking restart\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.3 容器创建")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#基于ubuntu镜像创建一个容器，网络模式使用none ，启动容器时,挂载本地Linux系统的etc/apt文件")]),s._v("\n    :~$ docker run -itd --net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none --name ubuntu-test1 -v /etc/apt/:/home/etc   ubuntu  /bin/bash\n    5f7b976ddfdf60dbc08cb81569488b70da15bc183d7f21da7030c316cd6ec96b\n    :~$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n    CONTAINER ID  IMAGE     COMMAND      CREATED             STATUS          PORTS   NAMES\n    5f7b976ddfdf  ubuntu    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" seconds ago       Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds            ubuntu-test1\n        \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2、定制容器ip")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.1 pipwork软件部署")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装pipwork")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#方法1：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/jpetazzo/pipework\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#方法2：将软件直接拖入ubuntu虚拟机")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#直接解压安装包")]),s._v("\n    :~"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$unzip")]),s._v(" pipework-master.zip\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将文件拷贝到bin下")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" pipework-master/pipework /usr/local/bin/\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.2 定制容器ip")]),s._v("\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" pipework br0 ubuntu-test1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.129/24@192.168.110.2\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.3 测试效果")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器查看ip地址信息")]),s._v("\n    :~$ docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it ubuntu-test1 /bin/bash\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除容器下的sources.lis")]),s._v("\n    :~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rm /etc/apt/sources.list")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将本地sources.list 复制过来")]),s._v("\n    :~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /home/etc/sources.list  /etc/apt/")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进行软件源更新")]),s._v("\n    :~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt-get update")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装ping命令")]),s._v("\n    :~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt-get install inetutils-ping -y")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装ifconfig命令")]),s._v("\n    :~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt-get install net-tools -y")]),s._v("\n    宿主机ping命令测试\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.14\n")])])]),n("h3",{attrs:{id:"_2-4-11-跨主机容器通信"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-11-跨主机容器通信"}},[s._v("#")]),s._v(" 2.4.11 跨主机容器通信")]),s._v(" "),n("p",[s._v("容器网络拓扑图")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/1541592121462.png",alt:"1541592121462"}})]),s._v(" "),n("p",[s._v("主机信息：")]),s._v(" "),n("p",[s._v("主机1：ubuntu 18.04 192.168.8.14")]),s._v(" "),n("p",[s._v("主机2：ubuntu 16.04 192.168.8.15")]),s._v(" "),n("p",[s._v("均安装 bridge-utils软件")]),s._v(" "),n("p",[s._v("分析：\n1、自定义br0")]),s._v(" "),n("p",[s._v("2、docker服务使用br0")]),s._v(" "),n("p",[s._v("3、创建容器使用br0")]),s._v(" "),n("p",[s._v("4、跨主机间网络测试")]),s._v(" "),n("p",[s._v("知识点：\n1、使用手工方式定制ubuntu的网卡")]),s._v(" "),n("p",[s._v("2、\n配置/etc/default/docker文件")]),s._v(" "),n("p",[s._v("编辑systemctl的配置文件使用该docker文件")]),s._v(" "),n("p",[s._v("重载systemctl配置")]),s._v(" "),n("p",[s._v("重启docker或者重启虚拟机")]),s._v(" "),n("p",[s._v("3、创建容器，查看容器信息即可")]),s._v(" "),n("p",[s._v("4、两台主机分别测试")]),s._v(" "),n("p",[s._v("注意：\n1、2、3 这三条在两台主机的配置大部分一模一样\nip地址划分不一样")]),s._v(" "),n("p",[s._v("方案：\n1、ubuntu桥接网卡配置")]),s._v(" "),n("p",[s._v("1.1 软件安装")]),s._v(" "),n("p",[s._v("1.2 编辑网卡")]),s._v(" "),n("p",[s._v("2、docker配置网桥")]),s._v(" "),n("p",[s._v("2.1 配置docker文件")]),s._v(" "),n("p",[s._v("2.2 systemctl使用docker文件")]),s._v(" "),n("p",[s._v("2.3 重启主机")]),s._v(" "),n("p",[s._v("3、容器测试")]),s._v(" "),n("p",[s._v("3.1 创建容器")]),s._v(" "),n("p",[s._v("3.2 容器间测试")]),s._v(" "),n("p",[s._v("实施：")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1、ubuntu桥接网卡配置")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.1 软件安装")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" bridge-utils -y\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.2 编辑网卡")]),s._v("\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/network/interfaces\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#与文件源内容进行1行的空行")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主机1")]),s._v("\nauto br0\niface br0 inet static\naddress "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.14\nnetmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0\ngateway "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.2\ndns-nameservers "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.2\nbridge_ports ens33\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主机2")]),s._v("\n    auto br0\n    iface br0 inet static\n    address "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.15\n    netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0\n    gateway "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.2\n    dns-nameservers "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.2\n    bridge_ports ens33\n    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2、docker配置网桥")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.1 配置docker文件")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改docker的守护进程文件")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/default/docker\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#末尾添加:")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主机1")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKER_OPTS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-b=br0 --fixed-cidr=192.168.110.99/26"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主机2")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DOCKER_OPTS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-b=br0 --fixed-cidr=192.168.110.170/26"')]),s._v("    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-b 用来指定容器连接的网桥名字")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#--fixed-cidr用来限定为容器分配的IP地址范围")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#192.168.110.99/26地址范围：192.168.110.64~192.168.110.127")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#192.168.110.170/26地址范围：192.168.110.128~192.168.110.191")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网段的计算可以参考网址：http://help.bitscn.com/ip/")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.2 systemctl使用docker文件")]),s._v("\n    创建服务依赖文件\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/systemd/system/docker.service.d\n    :~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/systemd/system/docker.service.d/Using_Environment_File.conf\n    内容如下：\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EnvironmentFile")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-/etc/default/docker\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/dockerd -H fd:// "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DOCKER_OPTS")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重载服务配置文件")]),s._v("\n    :~"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$systemctl")]),s._v(" daemon-reload\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.3 重启主机")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意如果重启后网络并未生效则")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /etc/init.d/networking restart\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意查看网卡信息")]),s._v("\n    :~$ brctl show\n    bridge      name    bridge "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("           STP enabled     interfaces\n    br0                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v(".000c2960060c   no              ens33\n    docker0             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v(".02427c11f899   no  \n    \n    br0       Link encap:以太网  硬件地址 00:0c:29:60:06:0c  \n         inet 地址:192.168.110.14  广播:192.168.110.255  掩码:255.255.255.0\n         inet6 地址: fe80::20c:29ff:fe60:60c/64 Scope:Link\n         UP BROADCAST RUNNING MULTICAST  MTU:1500  跃点数:1\n     \n\n\nens33     Link encap:以太网  硬件地址 00:0c:29:60:06:0c  \n  UP BROADCAST RUNNING MULTICAST  MTU:1500  跃点数:1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#广播运行多播")]),s._v("\n\n\n广播运行多播\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#验证dns解析是否正常 ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" www.baidu.com \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网络可能会没有dns解析所以我们需要进行dns的配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#16.04：")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" vim/etc/resolvconf/resolv.conf.d/base\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#18.04：")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" vim/etc/resolv.conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#增加内容")]),s._v("\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("223.5")]),s._v(".5.5\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("114.114")]),s._v(".114.114\nnameserver "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意如果重启后网络并未生效则")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /etc/init.d/networking restart\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3、容器测试")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3.1 创建容器")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主机1：")]),s._v("\n    :~$ docker run -itd --name ubuntu-test1 -v /etc/apt/:/home/etc ubuntu /bin/bash\n    :~$ docker run -itd --name ubuntu-test2 -v /etc/apt/:/home/etc ubuntu /bin/bash\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主机2                                                                      ")]),s._v("\n    :~$ docker run -itd --name ubuntu-test3 -v /etc/apt/:/home/etc ubuntu /bin/bash\n    :~$ docker run -itd --name ubuntu-test4 -v /etc/apt/:/home/etc ubuntu /bin/bash\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3.2 容器间测试")]),s._v("\n    进入容器\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主机1")]),s._v("\n    :~"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it ubuntu-test1 /bin/bash\n    :~"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it ubuntu-test2 /bin/bash\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主机2")]),s._v("\n    :~"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it ubuntu-test3 /bin/bash\n    :~"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it ubuntu-test4 /bin/bash\n\n:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rm /etc/apt/sources.list")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器内部将本地sources.list 复制过来")]),s._v("\n:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /home/etc/sources.list /etc/apt/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器内部进行软件源更新")]),s._v("\n:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt-get update")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器内部安装ping命令")]),s._v("\n:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt-get install inetutils-ping -y")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器内部安装ifconfig命令")]),s._v("\n:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt-get install net-tools -y")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#四个容器之间相互ping通")]),s._v("\n\n宿主机ping命令测试\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.14\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.15\n\n\n")])])]),n("p",[s._v("总结：\n优点：\n配置简单，不依赖第三方软件\n缺点：\n容器依赖于主机间的网络\n容器与主机在同网段，注意ip地址分配\n生产中不容易实现、不好管理\n​")]),s._v(" "),n("h1",{attrs:{id:"第-3-章-docker-高级实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第-3-章-docker-高级实践"}},[s._v("#")]),s._v(" 第 3 章 Docker 高级实践")]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/timg.jpg",alt:"img"}})]),s._v(" "),n("p",[s._v("在这一部分我们来介绍一些Docker的高级内容：\nDockerfile 和 Docker compose")]),s._v(" "),n("h2",{attrs:{id:"_3-1-dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-dockerfile"}},[s._v("#")]),s._v(" 3.1 Dockerfile")]),s._v(" "),n("h3",{attrs:{id:"_3-1-1-dockerfile简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-dockerfile简介"}},[s._v("#")]),s._v(" 3.1.1 Dockerfile简介")]),s._v(" "),n("p",[n("strong",[s._v("什么是Dockerfile")]),s._v("\n​\tDockerfile类似于我们学习过的脚本，将我们在上面学到的docker镜像，使用自动化的方式实现出来。")]),s._v(" "),n("p",[s._v("注意事项:")]),s._v(" "),n("ul",[n("li",[s._v("文件名首字母大写")]),s._v(" "),n("li",[s._v("存储Dockerfile的目录, 尽量是空目录")]),s._v(" "),n("li",[s._v("制作的镜像功能尽量单一")]),s._v(" "),n("li",[s._v("制作步骤要尽可能精简")])]),s._v(" "),n("p",[n("strong",[s._v("dockerfile的组成")])]),s._v(" "),n("blockquote",[n("p",[s._v("dockerfile中的注释使用: #")])]),s._v(" "),n("ul",[n("li",[s._v("基础镜像信息\n"),n("ul",[n("li",[s._v("要制作的新的镜像, 基于那个镜像来制作的")]),s._v(" "),n("li",[s._v("通过 docker images 查看")])])]),s._v(" "),n("li",[s._v("维护者信息\n"),n("ul",[n("li",[s._v("这个dockerfile是谁写的")])])]),s._v(" "),n("li",[s._v("镜像操作指令\n"),n("ul",[n("li",[s._v("基于原始进行进行的操作")])])]),s._v(" "),n("li",[s._v("容器启动指令\n"),n("ul",[n("li",[s._v("基于第三步得到了新镜像")]),s._v(" "),n("li",[s._v("新的镜像启动之后, 在容器中默认执行的指令")])])])]),s._v(" "),n("p",[n("strong",[s._v("Dockerfile使用命令：")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像命令格式：")]),s._v("\ndocker build -t "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("版本号"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Dockerfile所在目录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建样例：")]),s._v("\ndocker build -t nginx:v0.2 /opt/dockerfile/nginx/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#参数详解：")]),s._v("\n\t-t        \t\t\t\t\t指定构建后的镜像信息，\n\t/opt/dockerfile/nginx/      则代表Dockerfile存放位置，如果是当前目录，则用 ."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("点"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("表示\n")])])]),n("h3",{attrs:{id:"_3-1-2-dockerfile快速入门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-dockerfile快速入门"}},[s._v("#")]),s._v(" 3.1.2 Dockerfile快速入门")]),s._v(" "),n("p",[s._v("​\t接下来我们快速的使用Dockerfile来基于ubuntu创建一个定制化的镜像：nginx。")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建Dockerfile专用目录")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" ./docker/images/nginx -p\n:~$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" docker/images/nginx/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建Dockerfile文件")]),s._v("\n:~/docker/images/nginx$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" Dockerfile\n")])])]),n("p",[n("strong",[s._v("dockerfile内容")])]),s._v(" "),n("div",{staticClass:"language-Dockerfile extra-class"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建一个基于ubuntu的docker定制镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像作者")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" panda kstwoak47@163.com\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行命令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir hello\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir world\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/archive.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/security.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get update  \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80\n")])])]),n("p",[n("strong",[s._v("进行构建操作")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n:~/docker/images/nginx$ docker build -t ubuntu-nginx:v0.1 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看新生成镜像")]),s._v("\n:~/docker/images/nginx$ docker images\nREPOSITORY    TAG     IMAGE ID      CREATED        SIZE\nubuntu-nginx  v0.1    a853de1b8be4  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" seconds ago  208MB\nnginx         latest  e548f1a579cf  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" days ago     109MB\nubuntu        latest  0458a4468cbc  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" weeks ago    112MB\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看构建历史")]),s._v("\n:~/docker/images/nginx$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" a853de1b8be4\nIMAGE         CREATED            CREATED BY                         SIZE   COMMENT\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像\t\t\t创建时间             依赖命令                            大小    评论")]),s._v("\na853de1b8be4  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v(" seconds ago     /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop)  EXPOSE 80                  0B      ")]),s._v("\n925825b680fd  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" seconds ago     /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx -y          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(".5MB  \n4c57d6c99603  About a minute ago /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update                     40MB    \nb6d030a0d123  About a minute ago /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/security.ubuntu.com/mir… 2.77kB  \n3357bf8069ca  About a minute ago /bin/sh -c sed -i'")]),s._v("s/archive.ubuntu.com/mirr… "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".77kB  \n7bfb90c1e20d  About a minute ago /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" world                         0B      \n972d6ab76d01  About a minute ago /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" hello                         0B      \na76394bfad01  About a minute ago /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop) MAINTAINER panda kstwoak4…  0B    ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\n因为容器没有启动命令，所以肯定访问不了\n\n")])])]),n("p",[n("strong",[s._v("优化刚刚的Dockerfile文件")])]),s._v(" "),n("div",{staticClass:"language-Dockerfile extra-class"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建一个基于ubuntu的docker定制镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像作者")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" panda kstwoak47@163.com\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行命令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir hello\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir world\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/archive.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/security.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get update  \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80\n")])])]),n("p",[n("strong",[s._v("运行修改好的Dockerfile进行构建")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v(":~/docker/images/nginx$ docker build -t  ubuntu-nginx:v0.2 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n:~/docker/images/nginx$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" ubuntu-nginx:v0.2\nIMAGE         CREATED         CREATED BY                                     SIZE    COMMENT\neaba9bd1c4ac  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" minutes ago   /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop)  EXPOSE 80                   0B      ")]),s._v("\ned08d6e29eb1  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" minutes ago   /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" install…  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("96")]),s._v(".5MB  \neef6238ec5bd  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" minutes ago   /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i 's/archive.ubuntu.com/mirr…  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".77kB  \n58f755a1b29c  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" minutes ago   /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" hello "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" world         0B      \na76394bfad01  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" minutes ago  /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#(nop)  MAINTAINER panda kstwoak4…  0B    ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#对比两个镜像的大小")]),s._v("\n:~/docker/images/nginx$ docker images \nREPOSITORY    TAG   IMAGE ID      CREATED         SIZE\nubuntu-nginx  v0.2  eaba9bd1c4ac  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" seconds ago   208MB\nubuntu-nginx  v0.1  a853de1b8be4  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" minutes ago  208MB\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#深度对比连个镜像的大小")]),s._v("\n:~/docker/images/nginx$ docker inspect a853de1b8be4\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Size"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("208237435")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VirtualSize"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("208237435")]),s._v(",\n:~/docker/images/nginx$ docker inspect eaba9bd1c4ac\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Size"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("208234662")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VirtualSize"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("208234662")]),s._v(",\n")])])]),n("p",[n("strong",[s._v("Dockerfile构建过程：")]),s._v("\n​\t从基础镜像1运行一个容器A")]),s._v(" "),n("p",[s._v("​\t遇到一条Dockerfile指令，都对容器A做一次修改操作")]),s._v(" "),n("p",[s._v("​\t执行完毕一条命令，提交生成一个新镜像2")]),s._v(" "),n("p",[s._v("​\t再基于新的镜像2运行一个容器B")]),s._v(" "),n("p",[s._v("​\t遇到一条Dockerfile指令，都对容器B做一次修改操作")]),s._v(" "),n("p",[s._v("​\t执行完毕一条命令，提交生成一个新镜像3")]),s._v(" "),n("p",[s._v("​\t…")]),s._v(" "),n("p",[s._v("**构建过程镜像介绍")]),s._v(" "),n("p",[s._v("​       构建过程中，创建了很多镜像，这些中间镜像，我们可以直接使用来启动容器，通过查看容器效果，从侧面能看到我们每次构建的效果。提供了镜像调试的能力")]),s._v(" "),n("h3",{attrs:{id:"_3-1-3-基础指令详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-基础指令详解"}},[s._v("#")]),s._v(" 3.1.3 基础指令详解")]),s._v(" "),n("h4",{attrs:{id:"from"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#from"}},[s._v("#")]),s._v(" "),n("strong",[s._v("FROM")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("FROM\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    FROM "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    FROM "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tag"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#FROM 是 Dockerfile 里的第一条而且只能是除了首行注释之外的第一条指令")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以有多个FROM语句，来创建多个image")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#FROM 后面是有效的镜像名称，如果该镜像没有在你的本地仓库，那么就会从远程仓库Pull取，如果远程也没有，就报错失败")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下面所有的 系统可执行指令 在 FROM 的镜像中执行。")]),s._v("\n\n \n")])])]),n("h4",{attrs:{id:"maintainer"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#maintainer"}},[s._v("#")]),s._v(" "),n("strong",[s._v("MAINTAINER")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("MAINTAINER\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    MAINTAINER "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定该dockerfile文件的维护者信息。类似我们在docker commit 时候使用-a参数指定的信息")]),s._v("\n")])])]),n("h4",{attrs:{id:"run"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#run"}},[s._v("#")]),s._v(" "),n("strong",[s._v("RUN")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("RUN\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    RUN "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("command"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                                   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shell模式"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    RUN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exec 模式"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#表示当前镜像构建时候运行的命令，如果有确认输入的话，一定要在命令中添加 -y")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果命令较长，那么可以在命令结尾使用 \\ 来换行")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生产中，推荐使用上面数组的格式")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#shell模式：类似于  /bin/bash -c command")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#举例： RUN echo hello")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#exec模式：类似于 RUN["/bin/bash", "-c", "command"]')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#举例： RUN["echo", "hello"]')]),s._v("\n")])])]),n("h4",{attrs:{id:"expose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#expose"}},[s._v("#")]),s._v(" "),n("strong",[s._v("EXPOSE")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("EXPOSE\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    EXPOSE "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n    设置Docker容器对外暴露的端口号，Docker为了安全，不会自动对外打开端口，如果需要外部提供访问，\n    还需要启动容器时增加-p或者-P参数对容器的端口进行分配。\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     docker run -itd -p 8888:80")]),s._v("\n  EXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])])]),n("h3",{attrs:{id:"_3-1-4-运行时指令详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-运行时指令详解"}},[s._v("#")]),s._v(" 3.1.4 运行时指令详解")]),s._v(" "),n("h4",{attrs:{id:"cmd"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cmd"}},[s._v("#")]),s._v(" "),n("strong",[s._v("CMD")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("CMD\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    CMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exec 模式"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("推荐\n    CMD "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" param1 param2                     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shell模式"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    CMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("          提供给ENTRYPOINT的默认参数；\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释： ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CMD指定容器启动时默认执行的命令")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每个Dockerfile只能有一条CMD命令，如果指定了多条，只有最后一条会被执行")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果你在启动容器的时候使用docker run 指定的运行命令，那么会覆盖CMD命令。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#举例： CMD ["/usr/sbin/nginx","-g","daemon off；"]')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx"')]),s._v("   nginx命令\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v("\t\t\t\t设置配置文件外的全局指令\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off；"')]),s._v("\t\t后台守护程序开启方式 关闭\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CMD指令实践:")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改Dockerfile文件内容：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在上一个Dockerfile文件内容基础上，末尾增加下面一句话：")]),s._v("\n    CMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n    :~/docker/images/nginx$ docker build  -t ubuntu-nginx:v0.3  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,创建时候，不添加执行命令")]),s._v("\n    :~/docker/images/nginx$ docker run --name nginx-1 -itd ubuntu-nginx:v0.3\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,创建时候，添加执行命令/bin/bash")]),s._v("\n    :~/docker/images/nginx$ docker run  --name nginx-2 -itd ubuntu-nginx:v0.3 /bin/bash\n    docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发现两个容器的命令行是不一样的")]),s._v("\n    itcast@itcast-virtual-machine:~/docker/images/nginx$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\n    CONTAINER ID  IMAGE             COMMAND                 CREATED           NAMES\n    921d00c3689f  ubuntu-nginx:v0.3 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),s._v("             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" seconds ago    nginx-2\n    e6c39be8e696  ubuntu-nginx:v0.3 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx -g …"')]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" seconds ago   nginx-1\n    \n")])])]),n("h4",{attrs:{id:"entrypoint"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint"}},[s._v("#")]),s._v(" "),n("strong",[s._v("ENTRYPOINT")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("ENTRYPOINT\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    ENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exec 模式"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    ENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" param1 param2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shell 模式"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#和CMD 类似都是配置容器启动后执行的命令，并且不会被docker run 提供的参数覆盖。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每个Dockerfile 中只能有一个ENTRYPOINT，当指定多个时，只有最后一个起效。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生产中我们可以同时使用ENTRYPOINT 和CMD，")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#想要在docker run 时被覆盖，可以使用"docker run --entrypoint"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ENTRYPOINT指令实践：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改Dockerfile文件内容：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在上一个Dockerfile 文件内容基础上，修改末尾的CMD 为ENTRYPOINT：")]),s._v("\n    ENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n    :~/docker/images/nginx$ docker build -t ubuntu-nginx:v0.4 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,创建时候，不添加执行命令")]),s._v("\n    :~/docker/images/nginx$ docker run  --name nginx-3 -itd ubuntu-nginx:v0.4\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,创建时候，添加执行命令/bin/bash")]),s._v("\n    :~/docker/images/nginx$ docker run  --name nginx-4 -itd ubuntu-nginx:v0.4 /bin/bash\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看ENTRYPOINT是否被覆盖")]),s._v("\n    :~/docker/images/nginx$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\n    CONTAINER ID  IMAGE               COMMAND                  CREATED              NAMES\n    e7a2f0d0924e  ubuntu-nginx:v0.4   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx -g …"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v(" seconds ago       nginx-4\n    c92b2505e28e  ubuntu-nginx:v0.4   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx -g …"')]),s._v("   About a minute ago   nginx-3\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,创建时候，使用--entrypoint参数，添加执行命令/bin/bash")]),s._v("\n    docker run  --entrypoint "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),s._v(" --name nginx-5 -itd ubuntu-nginx:v0.4\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看ENTRYPOINT是否被覆盖")]),s._v("\n    :~/docker/images/nginx$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" \n    CONTAINER ID  IMAGE               COMMAND                  CREATED              NAMES\n    6c54726b2d96  ubuntu-nginx:v0.4   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),s._v("              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" seconds ago        nginx-5\n\n")])])]),n("h4",{attrs:{id:"cmd-entrypoint-综合使用实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cmd-entrypoint-综合使用实践"}},[s._v("#")]),s._v(" "),n("strong",[s._v("CMD ENTRYPOINT 综合使用实践")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改Dockerfile文件内容：")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在上一个Dockerfile文件内容基础上，修改末尾的ENTRYPOINT")]),s._v("\n\n    :~/docker/images/nginx$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" Dockerfile\n    ENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    CMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n    :~/docker/images/nginx$ docker build -t ubuntu-nginx:v0.5 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,创建时候，不添加执行命令")]),s._v("\n    :~/docker/images/nginx$ docker run --name nginx-6 -d ubuntu-nginx:v0.5\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看效果")]),s._v("\n   :~/docker/images/nginx$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a \n    CONTAINER ID   IMAGE               COMMAND                  CREATED         NAMES\n    e28875d281eb   ubuntu-nginx:v0.5   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx -g"')]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" seconds ago   nginx-6\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#根据镜像创建容器,创建时候，不添加执行命令，覆盖cmd的参数 -g "daemon off;"')]),s._v("\n:~/docker/images/nginx$ docker run  --name nginx-7 -d ubuntu-nginx:v0.5 -g "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看效果")]),s._v("\nitcast@itcast-virtual-machine:~/docker/images/nginx$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a \nCONTAINER ID    IMAGE               COMMAND                  CREATED         NAMES\ne5addad86ef5    ubuntu-nginx:v0.5   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx -g …"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" seconds ago   nginx-7\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#任何docker run设置的命令参数或者CMD指令的命令，都将作为ENTRYPOINT 指令的命令参数，追加到ENTRYPOINT指令之后")]),s._v("\n")])])]),n("h3",{attrs:{id:"_3-1-5-文件编辑指令详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-5-文件编辑指令详解"}},[s._v("#")]),s._v(" 3.1.5 文件编辑指令详解")]),s._v(" "),n("h4",{attrs:{id:"add"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#add"}},[s._v("#")]),s._v(" "),n("strong",[s._v("ADD")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ADD")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    ADD "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("src"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dest"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    ADD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<src>"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<dest>"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将宿主机文件拷贝到容器目录中")]),s._v("\n  \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果宿主机文件是可识别的压缩包, 会进行解压缩 -> tar")]),s._v("\n  \tADD 宿主机文件 容器目录/文件\n  \t\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#\tADD ["宿主机文件", "容器目录"]')]),s._v("\n   - 宿主机文件一般放到Dockerfile对应的目录中\n   - 容器目录, 有可能存在, 有可能不存在\n    \t- 存在: 直接拷贝到容器目录\n      - 不存在: 先在容器中创建一个, 再拷贝\n  ADD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a.txt"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/go/a.txt"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n   - 第二个参数如果指定的是一个文件名\n     - 这个文件存在: 直接覆盖\n     - 不存在: 直接拷贝\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ADD实践：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拷贝普通文件")]),s._v("\n    :~/docker/images/nginx$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" Dockerfile \n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Dockerfile文件内容")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建一个基于ubuntu的docker定制镜像")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像")]),s._v("\n    FROM ubuntu\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像作者")]),s._v("\n    MAINTAINER panda kstwoak47@163.com\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行命令")]),s._v("\n    ADD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sources.list"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/apt/sources.list"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    RUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" clean\n    RUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n    RUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx -y\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外端口")]),s._v("\n    EXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n    :~/docker/images/nginx$ docker build -t ubuntu-nginx:v0.6 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,创建时候，不添加执行命令进入容器查看效果")]),s._v("\n    docker run  --name nginx-8 -it ubuntu-nginx:v0.6\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拷贝压缩文件")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zcvf this.tar.gz ./*\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Dockerfile文件内容")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行命令")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加文件")]),s._v("\n    ADD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linshi.tar.gz"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/nihao/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n    :~/docker/images/nginx$ docker build -t ubuntu-nginx:v0.7 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,创建时候，不添加执行命令进入容器查看效果")]),s._v("\n    docker run --name nginx-9 -it ubuntu-nginx:v0.7\n    :~/docker/images/nginx$ docker run --name nginx-9 -it ubuntu-nginx:v0.7\n")])])]),n("h4",{attrs:{id:"copy"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#copy"}},[s._v("#")]),s._v(" COPY")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#COPY")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    COPY "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("src"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dest"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    COPY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<src>"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<dest>"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#COPY 指令和ADD 指令功能和使用方式类似。只是COPY 指令不会做自动解压工作。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#单纯复制文件场景，Docker 推荐使用COPY")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#COPY实践")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改Dockerfile文件内容:")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建一个基于ubuntu的docker定制镜像")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像")]),s._v("\n    FROM ubuntu\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像作者")]),s._v("\n    MAINTAINER panda kstwoak47@163.com\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行命令")]),s._v("\nADD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sources.list"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/apt/sources.list"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" clean\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx -y\nCOPY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index.html"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/www/html/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外端口")]),s._v("\nEXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行时默认命令 ")]),s._v("\nENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nindex.html 文件内容：\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("hello world "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("hello docker "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("hello nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n:~/docker/images/nginx$ docker build -t ubuntu-nginx:v0.8 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,创建时候，不添加执行命令")]),s._v("\n:~/docker/images/nginx$ docker run  --name nginx-10 -itd ubuntu-nginx:v0.8\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看nginx-10信息")]),s._v("\n:~/docker/images/nginx"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" inspect  nginx-10\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#浏览器访问nginx查看效果    ")]),s._v("\n")])])]),n("p",[n("strong",[s._v("VOLUME")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#VOLUME")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    VOLUME "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#VOLUME 指令可以在镜像中创建挂载点，这样只要通过该镜像创建的容器都有了挂载点")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过VOLUME 指令创建的挂载点，无法指定主机上对应的目录，是自动生成的。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#举例：")]),s._v("\n    VOLUME "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/tomcat7/webapps/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),n("p",[n("strong",[s._v("VOLUME实践")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#VOLUME实践")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改Dockerfile文件内容：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将COPY替换成为VOLUME")]),s._v("\n:~/docker/images/nginx"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$vim")]),s._v(" Dockerfile\nVOLUME "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/helloworld/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n:~/docker/images/nginx"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" build -t ubuntu-nginx:v0.9 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建数据卷容器")]),s._v("\n:~/docker/images/nginx"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" run -itd --name nginx-11 ubuntu-nginx:v0.9\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看镜像信息")]),s._v("\n:~/docker/images/nginx"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" inspect nginx-11\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#验证操作")]),s._v("\n:~/docker/images/nginx"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" run -itd --name vc-nginx-1 --volumes-from nginx-11 nginx\n:~/docker/images/nginx"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" run -itd --name vc-nginx-2 --volumes-from nginx-11 nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器1")]),s._v("\n:~/docker/images/nginx"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it vc-nginx-1 /bin/bash\n:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 'nihao itcast' > helloworld/nihao.txt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器2")]),s._v("\n:~/docker/images/nginx$ docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it vc-nginx-2 /bin/bash\n:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat helloworld/nihao.txt")]),s._v("\n")])])]),n("h3",{attrs:{id:"_3-1-6-环境指令详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-6-环境指令详解"}},[s._v("#")]),s._v(" 3.1.6 环境指令详解")]),s._v(" "),n("h4",{attrs:{id:"env"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#env"}},[s._v("#")]),s._v(" ENV")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ENV")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    ENV "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("value"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                    （一次设置一个环节变量）\n    ENV "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("value"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".                （一次设置一个或多个环节变量）\n    ENV HELLO "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12345")]),s._v("\n  \tENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HELLO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12345")]),s._v("\n  \tENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HELLO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12345")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WORLD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12345")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NIHAO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12345")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置环境变量，可以在RUN 之前使用，然后RUN 命令时调用，容器启动时这些环境变量都会被指定")]),s._v("\n")])])]),n("p",[n("strong",[s._v("ENV实践")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ENV实践：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#命令行创建ENV的容器")]),s._v("\n    :~$ docker run -e "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NIHAO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"helloworld"')]),s._v(" -itd --name ubuntu-111 ubuntu /bin/bash\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器ubuntu-111")]),s._v("\n    :~$ docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it ubuntu-111 /bin/bash\n    :/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo $NIHAO")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改Dockerfile文件内容：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在上一个Dockerfile 文件内容基础上，在RUN 下面增加一个ENV")]),s._v("\n    ENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NIHAO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("helloworld\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n    docker build -t ubuntu-nginx:v0.10 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,创建时候，不添加执行命令")]),s._v("\n    docker run  --name nginx-12 -itd ubuntu-nginx:v0.10\n    docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it nginx-12 /bin/bash\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NIHAO")]),s._v("\n")])])]),n("h4",{attrs:{id:"workdir"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#workdir"}},[s._v("#")]),s._v(" WORKDIR")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#WORKDIR")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    WORKDIR /path/to/workdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shell 模式"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#切换目录，为后续的RUN、CMD、ENTRYPOINT 指令配置工作目录。相当于cd")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以多次切换(相当于cd 命令)，")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#也可以使用多个WORKDIR 指令，后续命令如果参数是相对路径，则会基于之前命令指定的路径。例如")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#举例：")]),s._v("\n    WORKDIR /a\n    WORKDIR b\n    WORKDIR c\n    RUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#则最终路径为/a/b/c")]),s._v("\n")])])]),n("p",[n("strong",[s._v("WORKDIR实践")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#WORKDIR实践：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改Dockerfile文件内容：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在上一个Dockerfile 文件内容基础上，在RUN 下面增加一个WORKDIR")]),s._v("\n    WORKDIR /nihao/itcast/\n    RUN "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"touch"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"itcast1.txt"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    WORKDIR /nihao\n    RUN "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"touch"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"itcast2.txt"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    WORKDIR itcast\n    RUN "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"touch"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"itcast3.txt"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n    :~/docker/images/nginx$ docker build -t ubuntu-nginx:v0.11 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,创建时候，不添加执行命令")]),s._v("\n    docker run  --name nginx-13 -itd ubuntu-nginx:v0.11\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入镜像")]),s._v("\n    docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it nginx-13 /bin/bash\n")])])]),n("p",[n("strong",[s._v("USER与ARG")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#USER")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" daemon\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定运行容器时的用户名和UID，后续的RUN 指令也会使用这里指定的用户。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果不输入任何信息，表示默认使用root 用户")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ARG")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    ARG "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("default value"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ARG 指定了一个变量在docker build 的时候使用，可以使用--build-arg <varname>=<value>来指定参数的值，不过")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果构建的时候不指定就会报错。")]),s._v("\n\n")])])]),n("h3",{attrs:{id:"_3-1-7-触发器指令详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-7-触发器指令详解"}},[s._v("#")]),s._v(" 3.1.7 触发器指令详解")]),s._v(" "),n("p",[s._v("触发器指令")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("ONBUILD\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#格式：")]),s._v("\n    ONBUILD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("command"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解释：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当一个镜像A被作为其他镜像B的基础镜像时，这个触发器才会被执行，")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新镜像B在构建的时候，会插入触发器中的指令。")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用场景对于版本控制和方便传输，适用于其他用户。")]),s._v("\n    \n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 原始镜像 -> 纯净版")]),s._v("\n  \t-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 修改 ONBUILD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello,linux"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  \t   \n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基于原始镜像制作新镜像 -> 镜像A")]),s._v("\n  \t-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 启动镜像A -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 不会输出hello, linux\n  \t\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基于镜像A制作了镜像B")]),s._v("\n  \t-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 启动镜像B -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 会输出 hello, linux\n")])])]),n("p",[s._v("触发器实践")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编辑Dockerfile")]),s._v("\n:~/docker/images/nginx$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" Dockerfile \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#内容如下：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建一个基于ubuntu的docker定制镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像")]),s._v("\nFROM ubuntu\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像作者")]),s._v("\nMAINTAINER panda kstwoak47@163.com\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行命令")]),s._v("\nADD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sources.list"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/apt/sources.list"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" clean\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update \nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx -y \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#触发器")]),s._v("\nONBUILD COPY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index.html"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/www/html/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外端口")]),s._v("\nEXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行时默认命令 ")]),s._v("\nENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n:~/docker/images/nginx$ docker build -t ubuntu-nginx:v0.12 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,")]),s._v("\n:~/docker/images/nginx"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" run -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --name nginx-14 -itd ubuntu-nginx:v0.12\n:~/docker/images/nginx"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看镜像信息")]),s._v("\n:~/docker/images/nginx$ docker inspect ubuntu-nginx:v0.12  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#访问容器页面，是否被更改")]),s._v("\n:~/docker/images/nginx$ docker inspect nginx-14\n\n")])])]),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建子镜像Dockerfile文件")]),s._v("\nFROM ubuntu-nginx:v0.12\nMAINTAINER panda kstwoak47@163.com\nEXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\nENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建子镜像")]),s._v("\n:~/docker/images/nginx$ docker build -t ubuntu-nginx:v0.13 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据镜像创建容器,")]),s._v("\ndocker run -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --name nginx-15 -itd ubuntu-nginx:v0.13\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看镜像信息")]),s._v("\n:~/docker/images/nginx$ docker inspect ubuntu-nginx:v0.13\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#访问容器页面，是否被更改")]),s._v("\n\n")])])]),n("h3",{attrs:{id:"_3-1-8-dockerfile构建缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-8-dockerfile构建缓存"}},[s._v("#")]),s._v(" 3.1.8 Dockerfile构建缓存")]),s._v(" "),n("p",[s._v("我们第一次构建很慢，之后的构建都会很快，因为他们用到了构建的缓存。")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#取消缓存：")]),s._v("\ndocker build --no-cache -t "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像名"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像版本"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Dockerfile位置"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),n("h2",{attrs:{id:"_3-2-dockerfile构建go环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-dockerfile构建go环境"}},[s._v("#")]),s._v(" 3.2 Dockerfile构建go环境")]),s._v(" "),n("p",[s._v("接下来我们就来做一个工作实践，搭建一个go环境,然后尝试使用Dockerfile的方式，构造一个镜像。")]),s._v(" "),n("h3",{attrs:{id:"_3-2-1-项目描述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-项目描述"}},[s._v("#")]),s._v(" 3.2.1 项目描述")]),s._v(" "),n("p",[s._v("beego官方网站：https://beego.me/")]),s._v(" "),n("p",[s._v("我们借助于beego的简介，部署一个go项目，然后运行起来。")]),s._v(" "),n("h3",{attrs:{id:"_3-2-2-手工部署go语言环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-手工部署go语言环境"}},[s._v("#")]),s._v(" 3.2.2 手工部署go语言环境")]),s._v(" "),n("p",[n("strong",[s._v("需求：")])]),s._v(" "),n("p",[s._v("基于docker镜像，手工部署go项目环境")]),s._v(" "),n("p",[n("strong",[s._v("方案分析：")])]),s._v(" "),n("p",[s._v("1、docker环境部署")]),s._v(" "),n("p",[s._v("2、go环境部署")]),s._v(" "),n("p",[s._v("3、go项目部署")]),s._v(" "),n("p",[s._v("4、测试")]),s._v(" "),n("p",[s._v("技术关键点：")]),s._v(" "),n("p",[s._v("1、docker环境部署")]),s._v(" "),n("p",[s._v("使用docker镜像启动一个容器即可")]),s._v(" "),n("p",[s._v("2、go环境部署")]),s._v(" "),n("p",[s._v("go软件的依赖环境")]),s._v(" "),n("p",[s._v("go软件的基本环境配置")]),s._v(" "),n("p",[s._v("3、go项目部署")]),s._v(" "),n("p",[s._v("beego框架的下载")]),s._v(" "),n("p",[s._v("项目文件配置")]),s._v(" "),n("p",[s._v("启动go项目")]),s._v(" "),n("p",[s._v("4、测试")]),s._v(" "),n("p",[s._v("宿主机测试")]),s._v(" "),n("p",[s._v("解决方案：")]),s._v(" "),n("p",[s._v("1、docker环境配置")]),s._v(" "),n("p",[s._v("1.1 获取docker镜像")]),s._v(" "),n("p",[s._v("1.2 启动docker容器")]),s._v(" "),n("p",[s._v("2、go环境部署")]),s._v(" "),n("p",[s._v("2.1 基础环境配置")]),s._v(" "),n("p",[s._v("2.2 go环境配置")]),s._v(" "),n("p",[s._v("3、go项目部署")]),s._v(" "),n("p",[s._v("3.1 获取beego代码")]),s._v(" "),n("p",[s._v("3.2 项目文件配置")]),s._v(" "),n("p",[s._v("3.3 项目启动")]),s._v(" "),n("p",[s._v("4、测试")]),s._v(" "),n("p",[s._v("4.1 宿主机测试")]),s._v(" "),n("p",[n("strong",[s._v("实施方案：")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1、docker环境配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.1 获取docker镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取一个ubuntu的模板文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ubuntu-16.04-x86_64.tar.gz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" - ubuntu-nimi\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.2 启动docker容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动容器，容器名称叫go-test")]),s._v("\ndocker run -itd --name go-test ubuntu-nimi\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it go-test /bin/bash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2、go环境部署")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.1 基础环境配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置国内源")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件内容如下")]),s._v("\ndeb http://mirrors.aliyun.com/ubuntu/ xenial main restricted\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted\ndeb http://mirrors.aliyun.com/ubuntu/ xenial universe\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe\ndeb http://mirrors.aliyun.com/ubuntu/ xenial multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security universe\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果由于网络环境原因不能进行软件源更新可以使用如下内容")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/cn.archive.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#更新软件源，安装基本软件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc libc6-dev "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" lrzsz -y\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.2 go环境配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装go语言软件")]),s._v("\n//apt-get "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" golang -y\n由于软件源问题改使用新版本go\n将go1.10.linux-amd64.tar.gz拷贝到容器中进行解压\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -C /usr/local  -zxf go1.10.linux-amd64.tar.gz\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置go基本环境变量")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOROOT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/go                \n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(":/usr/local/go/bin   \n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/go\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOPATH")]),s._v("/bin/:"),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3、go项目部署")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3.1 获取beego代码")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载项目beego")]),s._v("\ngo get github.com/astaxie/beego\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3.2 项目文件配置")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建项目目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /root/go/src/myTest\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /root/go/src/myTest\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编辑go项目测试文件test.go")]),s._v("\npackage main\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/astaxie/beego"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" MainController struct "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nbeego.Controller\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nfunc "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("this *MainController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("Get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nthis.Ctx.WriteString"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world'),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nfunc "),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nbeego.Router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("MainController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nbeego.Run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3.3 项目启动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行该文件")]),s._v("\ngo run test.go\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以看到：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个go项目运行起来后，开放的端口是8080")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4、测试")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4.1宿主机测试")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器的ip地址")]),s._v("\ndocker inspect go-test\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#浏览器查看效果：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2:8080\n")])])]),n("h3",{attrs:{id:"_3-2-3-dockerfile案例分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-dockerfile案例分析"}},[s._v("#")]),s._v(" 3.2.3 Dockerfile案例分析")]),s._v(" "),n("p",[s._v("环境分析：")]),s._v(" "),n("p",[s._v("1、软件源文件，使用国外源，速度太慢，所以我们可以自己使用国内的软件源。")]),s._v(" "),n("p",[s._v("因为我们在手工部署的时候，使用的是官方(国外)的源，所以为了部署快一点呢，我使用国内的阿里云的源。\n源内容：")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted\ndeb http://mirrors.aliyun.com/ubuntu/ xenial universe\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe\ndeb http://mirrors.aliyun.com/ubuntu/ xenial multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security universe\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse\n")])])]),n("p",[s._v("由于阿里云的源出现问题所有更换为中科大的源 详情见3.1.1")]),s._v(" "),n("p",[s._v("2、软件安装，涉及到了各种软件")]),s._v(" "),n("p",[s._v("3、涉及到了go的环境变量设置")]),s._v(" "),n("p",[s._v("4、软件运行涉及到了软件的运行目录")]),s._v(" "),n("p",[s._v("5、项目访问，涉及到端口")]),s._v(" "),n("p",[s._v("关键点分析：")]),s._v(" "),n("p",[s._v("1、增加文件，使用 ADD 或者 COPY 指令")]),s._v(" "),n("p",[s._v("2、安装软件，使用 RUN 指令")]),s._v(" "),n("p",[s._v("3、环境变量，使用 ENV 指令")]),s._v(" "),n("p",[s._v("4、命令运行，使用 WORKDIR 指令")]),s._v(" "),n("p",[s._v("5、项目端口，使用 EXPOSE 指令")]),s._v(" "),n("p",[s._v("定制方案：")]),s._v(" "),n("p",[s._v("1、基于ubuntu基础镜像进行操作")]),s._v(" "),n("p",[s._v("2、增加国内源文件")]),s._v(" "),n("p",[s._v("3、安装环境基本软件")]),s._v(" "),n("p",[s._v("4、定制命令工作目录")]),s._v(" "),n("p",[s._v("5、执行项目")]),s._v(" "),n("p",[s._v("6、开放端口")]),s._v(" "),n("h3",{attrs:{id:"_3-2-4-dockerfile实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-dockerfile实践"}},[s._v("#")]),s._v(" 3.2.4 Dockerfile实践")]),s._v(" "),n("p",[n("strong",[s._v("创建目录")])]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#创建目录\n#进入标准目录\nmkdir /docker/images/beego\ncd /docker/images/beego\n")])])]),n("p",[n("strong",[s._v("Dockerfile内容")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建一个基于ubuntu 的docker 定制镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像")]),s._v("\nFROM ubuntu\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像作者")]),s._v("\nMAINTAINER panda kstwoak47@163.com\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加国内源")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#COPY sources.list /etc/apt/")]),s._v("\n\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/archive.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/security.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行命令")]),s._v("\n\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc libc6-dev "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" lrzsz -y\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将go复制解压到容器中")]),s._v("\nADD go1.10.linux-amd64.tar.gz  /usr/local/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定制环境变量")]),s._v("\n\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOROOT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/go                \nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(":/usr/local/go/bin   \nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/go\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOPATH")]),s._v("/bin/:"),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载项目")]),s._v("\n\nRUN go get github.com/astaxie/beego\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加文件")]),s._v("\n\nCOPY test.go /root/go/src/myTest/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定制工作目录")]),s._v("\n\nWORKDIR /root/go/src/myTest/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外端口")]),s._v("\n\nEXPOSE "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行项目")]),s._v("\n\nENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test.go"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#把sources.list和test.go文件放到这个目录中")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\ndocker build -t go-test:v0.1 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行镜像")]),s._v("\ndocker run -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 -itd go-test:v0.1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#访问镜像，查看效果")]),s._v("\n")])])]),n("h2",{attrs:{id:"_3-3-docker-compose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-docker-compose"}},[s._v("#")]),s._v(" 3.3 Docker compose")]),s._v(" "),n("p",[s._v("Docker compose是一种docker容器的任务编排工具")]),s._v(" "),n("p",[s._v("官方地址：https://docs.docker.com/compose/")]),s._v(" "),n("h3",{attrs:{id:"_3-3-1-compose简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-compose简介"}},[s._v("#")]),s._v(" 3.3.1 compose简介")]),s._v(" "),n("p",[s._v("任务编排介绍")]),s._v(" "),n("p",[s._v("场景：")]),s._v(" "),n("p",[s._v("​       我们在工作中为了完成业务目标，首先把业务拆分成多个子任务，然后对这些子任务进行顺序组合，当子任务按照方案执行完毕后，就完成了业务目标。")]),s._v(" "),n("p",[s._v("​       任务编排，就是对多个子任务执行顺序进行确定的过程。")]),s._v(" "),n("p",[s._v("常见的任务编排工具：")]),s._v(" "),n("p",[s._v("单机版：   docker compose")]),s._v(" "),n("p",[s._v("集群版：")]),s._v(" "),n("p",[s._v("Docker swarm               Docker")]),s._v(" "),n("p",[s._v("Mesos                 \t\tApache")]),s._v(" "),n("p",[s._v("Kubernetes（k8s）       Google")]),s._v(" "),n("p",[n("strong",[s._v("docker compose是什么")])]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/1541810582833.png",alt:"1541810582833"}})]),s._v(" "),n("p",[n("strong",[s._v("译文：")]),s._v("\ncompose是定义和运行多容器Docker应用程序的工具。通过编写，您可以使用YAML文件来配置应用程序的服务。然后，使用单个命令创建并启动配置中的所有服务。要了解更多有关组合的所有特性，请参见特性列表。")]),s._v(" "),n("p",[n("strong",[s._v("docker compose的特点；")]),s._v("\n本质：docker 工具")]),s._v(" "),n("p",[s._v("对象：应用服务")]),s._v(" "),n("p",[s._v("配置：YAML 格式配置文件")]),s._v(" "),n("p",[s._v("命令：简单")]),s._v(" "),n("p",[s._v("执行：定义和运行容器")]),s._v(" "),n("p",[n("strong",[s._v("docker compose的配置文件")])]),s._v(" "),n("p",[s._v("docker-compose.yml")]),s._v(" "),n("p",[s._v("文件后缀是yml")]),s._v(" "),n("p",[s._v("文件内容遵循 ymal格式")]),s._v(" "),n("h3",{attrs:{id:"docker-和-docker-compose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-和-docker-compose"}},[s._v("#")]),s._v(" docker 和 Docker compose")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[n("strong",[s._v("Compose file format")])]),s._v(" "),n("th",[n("strong",[s._v("Docker Engine release")])]),s._v(" "),n("th"),s._v(" "),n("th",[n("strong",[s._v("Compose file format")])]),s._v(" "),n("th",[n("strong",[s._v("Docker Engine release")])])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("3.4")]),s._v(" "),n("td",[s._v("17.09.0+")]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("2.3")]),s._v(" "),n("td",[s._v("17.06.0+")])]),s._v(" "),n("tr",[n("td",[s._v("3.3")]),s._v(" "),n("td",[s._v("17.06.0+")]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("2.2")]),s._v(" "),n("td",[s._v("1.13.0+")])]),s._v(" "),n("tr",[n("td",[s._v("3.2")]),s._v(" "),n("td",[s._v("17.04.0+")]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("2.1")]),s._v(" "),n("td",[s._v("1.12.0+")])]),s._v(" "),n("tr",[n("td",[s._v("3.1")]),s._v(" "),n("td",[s._v("1.13.1+")]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("2.0")]),s._v(" "),n("td",[s._v("1.10.0+")])]),s._v(" "),n("tr",[n("td",[s._v("3.0")]),s._v(" "),n("td",[s._v("1.13.0+")]),s._v(" "),n("td"),s._v(" "),n("td",[s._v("1.0")]),s._v(" "),n("td",[s._v("1.9.1.+")])])])]),s._v(" "),n("p",[s._v("官方地址：https://docs.docker.com/compose/overview/")]),s._v(" "),n("h3",{attrs:{id:"_3-3-2-compose-快速入门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-compose-快速入门"}},[s._v("#")]),s._v(" 3.3.2 compose 快速入门")]),s._v(" "),n("p",[n("strong",[s._v("docker compose 安装")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装依赖工具")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python-pip -y\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装编排工具")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" pip "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-compose\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看编排工具版本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker-compose version\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看命令帮助")]),s._v("\ndocker-compose --help\n")])])]),n("p",[n("strong",[s._v("PIP 源问题")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用pip安装依赖包时默认访问https://pypi.python.org/simple/，")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#但是经常出现不稳定以及访问速度非常慢的情况，国内厂商提供的pipy镜像目前可用的有：")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在当前用户目录下创建.pip文件夹")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" ~/.pip\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#然后在该目录下创建pip.conf文件填写：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ntrusted-host"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mirrors.aliyun.com\nindex-url"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://mirrors.aliyun.com/pypi/simple/\n")])])]),n("p",[n("strong",[s._v("compose简单配置文件")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建compose文件夹")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p ./docker/compose\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入到文件夹")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ./docker/compose\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建yml文件")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" docker-compose.yml\n")])])]),n("p",[n("strong",[s._v("docker-compose.yml 文件内容")])]),s._v(" "),n("div",{staticClass:"language-yml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9999:80"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("web1\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8888:80"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("web2\n")])])]),n("p",[n("strong",[s._v("运行一个容器")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后台启动：")]),s._v("\ndocker-compose up -d\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果不加-d，那么界面就会卡在前台")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看运行效果")]),s._v("\ndocker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n")])])]),n("h3",{attrs:{id:"_3-3-3-compose命令详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-compose命令详解"}},[s._v("#")]),s._v(" 3.3.3 compose命令详解")]),s._v(" "),n("p",[n("strong",[s._v("注意：")])]),s._v(" "),n("p",[s._v("所有命令尽量都在docker compose项目目录下面进行操作")]),s._v(" "),n("p",[s._v("项目目录：docker-compose.yml所在目录")]),s._v(" "),n("p",[n("strong",[s._v("compose服务启动、关闭、查看")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后台启动：")]),s._v("\ndocker-compose up -d\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除服务")]),s._v("\ndocker-compose down\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看正在运行的服务")]),s._v("\ndocker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n")])])]),n("p",[n("strong",[s._v("容器开启、关闭、删除")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动一个服务")]),s._v("\ndocker-compose start "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("服务名"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果后面不加服务名，会停止所有的服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止一个服务")]),s._v("\ndocker-compose stop "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("服务名"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果后面不加服务名，会停止所有的服务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除服务")]),s._v("\ndocker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个docker-compose rm不会删除应用的网络和数据卷。工作中尽量不要用rm进行删除")]),s._v("\n")])])]),n("p",[n("strong",[s._v("其他信息查看")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看运行的服务")]),s._v("\ndocker-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看服务运行的日志")]),s._v("\ndocker-compose logs -f\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意：")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#加上-f 选项，可以持续跟踪服务产生的日志")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看服务依赖的镜像")]),s._v("\ndocke-compose  images\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入服务容器")]),s._v("\ndocker-compose "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("服务名"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("执行命令"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看服务网络")]),s._v("\ndocker network "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n")])])]),n("h3",{attrs:{id:"_3-3-4-compose文件详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-4-compose文件详解"}},[s._v("#")]),s._v(" 3.3.4 compose文件详解")]),s._v(" "),n("p",[s._v("官方参考资料：\nhttps://docs.docker.com/compose/overview/")]),s._v(" "),n("p",[n("strong",[s._v("文件命名：")])]),s._v(" "),n("p",[s._v("后缀是 .yml")]),s._v(" "),n("h3",{attrs:{id:"_2-2-yaml文件格式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-yaml文件格式"}},[s._v("#")]),s._v(" 2.2 yaml文件格式")]),s._v(" "),n("blockquote",[n("ul",[n("li",[n("p",[s._v("YAML有以下基本规则：\n1、大小写敏感\n2、使用缩进表示层级关系\n3、禁止使用tab缩进，只能使用空格键\n4、缩进长度没有限制，只要元素对齐就表示这些元素属于一个层级。\n5、使用#表示注释\n6、字符串可以不用引号标注")]),s._v(" "),n("p",[s._v('​     \t"我是字符串"')]),s._v(" "),n("p",[s._v("​\t'我是字符串'")]),s._v(" "),n("p",[s._v("​       我是字符串")])])])]),s._v(" "),n("p",[s._v("yaml中的三种数据结构")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("map - 散列表")]),s._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用冒号（：）表示键值对，同一缩进的所有键值对属于一个map，示例：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("age")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" huang\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 也可以这样写")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("age"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("huang"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用json")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('"age"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' "name"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"huang"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])]),s._v(" "),n("li",[n("p",[s._v("list - 数组")]),s._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用连字符（-）表示：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# YAML表示")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" a\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" b\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用json表示")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])])]),s._v(" "),n("li",[n("p",[s._v("scalar - 纯量")]),s._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("字符串\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wos字符串"')]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 我是字符串\n布尔值\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n整数\n浮点数\nNULL \n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 使用 ~ 表示\n")])])])]),s._v(" "),n("li",[n("p",[s._v("例子")]),s._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Websites")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("YAML")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" yaml.org \n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Ruby")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ruby"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lang.org \n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Python")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" python.org \n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Perl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" use.perl.org \n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用json表示")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('"Websites"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('"YAML"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yaml.org "')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' "Ruby"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ruby-lang.org"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("languages")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Ruby\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Perl\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Python \n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" c\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用json表示")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('"languages"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ruby"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"perl"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Ruby\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Perl\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Python \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" c\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" c++\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" java\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用json表示")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ruby"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"perl"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c++"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" huang\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" liao\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用json表示")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('"id"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' "name"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"huang"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v('"id"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(' "name"'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"liao"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n")])])])])]),s._v(" "),n("p",[n("strong",[s._v("compose文件样例：")])]),s._v(" "),n("div",{staticClass:"language-yml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v("                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# compose 版本号")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务标识符")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                             "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 子服务命名")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务依赖镜像属性")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务端口属性")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9999:80"')]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 宿主机端口:容器端口")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("web1      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器命名")]),s._v("\n\n")])])]),n("p",[n("strong",[s._v("格式详解：")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("compose版本号、服务标识符必须顶格写\n属性名和属性值是以"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("': '")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("冒号+空格"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 隔开\n层级使用"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'  '")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("两个空格"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("表示\n服务属性使用"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' - '")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("空格空格-空格"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("来表示\n")])])]),n("p",[n("strong",[s._v("compose属性介绍")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像：")]),s._v("\n    格式：\n        image: 镜像名称:版本号\n    举例：\n        image: nginx:latest\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器命名：")]),s._v("\n    格式：\n        container_name: 自定义容器命名\n    举例：\n        container_name: nginx-web1\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据卷：")]),s._v("\n    格式：\n        volumes:\n          - 宿主机文件:容器文件\n    举例：\n        volumes:\n          - ./linshi.conf:/nihao/haha.sh\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#端口：")]),s._v("\n    格式：\n        ports:\n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"宿主机端口:容器端口"')]),s._v("\n    举例：\n        ports:\n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9999:80"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像构建：")]),s._v("\n    格式：\n        build: Dockerfile 的路径\n    举例：\n        build: "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n        build: ./dockerfile_dir/\n        build: /root/dockerfile_dir/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像依赖：")]),s._v("\n    格式：\n        depends_on:\n          - 本镜像依赖于哪个服务\n    举例：\n        depends_on:\n          - web1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#networks：")]),s._v("\n加入指定网络，格式如下：\nservices:\n  some-service:\n    networks:\n     - some-network\n     - other-network\n")])])]),n("h3",{attrs:{id:"_3-3-5-go项目实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-5-go项目实践"}},[s._v("#")]),s._v(" 3.3.5 go项目实践")]),s._v(" "),n("p",[n("strong",[s._v("项目分析")])]),s._v(" "),n("p",[n("img",{attrs:{src:"assets/1541773097819.png",alt:"1541773097819"}})]),s._v(" "),n("p",[n("strong",[s._v("需求：")])]),s._v(" "),n("p",[s._v("自动部署一个集群，使用nginx代理两个go项目")]),s._v(" "),n("p",[n("strong",[s._v("流程分析：")])]),s._v(" "),n("p",[s._v("1、go项目部署")]),s._v(" "),n("p",[s._v("2、nginx代理部署")]),s._v(" "),n("p",[s._v("3、docker 环境")]),s._v(" "),n("p",[s._v("4、docker compose任务编排")]),s._v(" "),n("p",[n("strong",[s._v("技术点分析：")])]),s._v(" "),n("p",[s._v("1、go项目部署")]),s._v(" "),n("p",[s._v("go项目基础环境")]),s._v(" "),n("p",[s._v("go项目配置")]),s._v(" "),n("p",[s._v("2、nginx代理部署")]),s._v(" "),n("p",[s._v("nginx的配置文件")]),s._v(" "),n("p",[s._v("3、docker 环境")]),s._v(" "),n("p",[s._v("docker基础镜像")]),s._v(" "),n("p",[s._v("go镜像")]),s._v(" "),n("p",[s._v("nginx镜像")]),s._v(" "),n("p",[s._v("4、docker compose任务编排")]),s._v(" "),n("p",[s._v("4个任务：1个镜像构建任务、2个go任务、1个nginx任务")]),s._v(" "),n("p",[s._v("任务依赖关系：go任务执行依赖于nginx任务")]),s._v(" "),n("p",[s._v("镜像依赖：go镜像依赖于nginx镜像完毕")]),s._v(" "),n("p",[n("strong",[s._v("实施方案：")])]),s._v(" "),n("p",[s._v("1、基础环境")]),s._v(" "),n("p",[s._v("1.1 compose基础目录")]),s._v(" "),n("p",[s._v("1.2 环境依赖文件：")]),s._v(" "),n("p",[s._v("sources.list、test.go、test1.go、test2.go、nginx-beego.conf")]),s._v(" "),n("p",[s._v("1.3 dockerfile文件")]),s._v(" "),n("p",[s._v("go项目环境的Dockerfile文件")]),s._v(" "),n("p",[s._v("2、任务编排文件")]),s._v(" "),n("p",[s._v("2.1 nginx任务")]),s._v(" "),n("p",[s._v("基于nginx镜像，增加一个nginx的代理配置即可")]),s._v(" "),n("p",[s._v("2.2 go基础镜像任务")]),s._v(" "),n("p",[s._v("基于ubuntu镜像，构建go基础环境镜像，参考3.2.4内容")]),s._v(" "),n("p",[s._v("该任务依赖于2.1 nginx任务")]),s._v(" "),n("p",[s._v("2.3 go项目任务")]),s._v(" "),n("p",[s._v("基于go基础镜像，增加测试文件即可")]),s._v(" "),n("p",[s._v("该任务依赖于2.2 go基础镜像任务")]),s._v(" "),n("p",[s._v("3、测试")]),s._v(" "),n("p",[s._v("3.1 集群测试")]),s._v(" "),n("p",[s._v("方案实施")]),s._v(" "),n("p",[s._v("1、基础环境")]),s._v(" "),n("p",[s._v("1.1 compose基础目录")]),s._v(" "),n("p",[s._v("创建compose基础目录")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v(":~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /docker/compose/\n:~$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /docker/compose/\n")])])]),n("p",[s._v("1.2 环境依赖文件：")]),s._v(" "),n("p",[n("strong",[s._v("nginx配置文件")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("创建nginx专用目录\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" nginx\n:~$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx\n创建nginx负载均衡配置nginx-beego.conf\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" nginx-beego.conf\n")])])]),n("p",[n("strong",[s._v("文件内容")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("upstream beegos "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#upstream模块")]),s._v("\n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".8.14:10086"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".8.14:10087"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#提供服务的端口 ")]),s._v("\n  server_name _"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#服务名称")]),s._v("\n  location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    proxy_pass http://beegos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#反选代理 upstream模块  beegos")]),s._v("\n    index index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认首页")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),n("p",[s._v("go"),n("strong",[s._v("基础镜像依赖文件")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建go基础镜像目录：")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" go-base\n:~$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" go-base\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建source.lise")]),s._v("\n:~$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" sources.list\n")])])]),n("p",[n("strong",[s._v("文件内容")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted\ndeb http://mirrors.aliyun.com/ubuntu/ xenial universe\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe \ndeb http://mirrors.aliyun.com/ubuntu/ xenial multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse \ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security universe\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse\n")])])]),n("p",[n("strong",[s._v("或者")])]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("RUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/archive.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/security.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n")])])]),n("p",[n("strong",[s._v("test.go配置文件")])]),s._v(" "),n("div",{staticClass:"language-Go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/astaxie/beego"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" MainController "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Controller\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("this "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("MainController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\tthis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("WriteString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Router")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("MainController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),n("p",[s._v("go任务依赖文件：\n"),n("strong",[s._v("beego1/test.go配置文件")])]),s._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/astaxie/beego"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" MainController "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \nbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Controller\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("this "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("MainController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \nthis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("WriteString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<h1>hello beego1</h1>\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Router")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("MainController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),n("p",[n("strong",[s._v("Beego2/test.go配置文件")])]),s._v(" "),n("div",{staticClass:"language-Go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/astaxie/beego"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" MainController "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Controller\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("this "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("MainController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\tthis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("WriteString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<h1>hello beego2</h1>\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Router")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("MainController"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),n("p",[s._v("1.3 dockerfile文件")]),s._v(" "),n("p",[s._v("go项目环境的Dockerfile文件")]),s._v(" "),n("p",[s._v("创建Dockerfile文件")]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(":~$ vim dockerfile\n")])])]),n("p",[s._v("文件内容")]),s._v(" "),n("div",{staticClass:"language-Dockerfile extra-class"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建一个基于ubuntu 的docker 定制镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像作者")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" panda kstwoak47@163.com\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加国内源")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#COPY sources.list /etc/apt/")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/archive.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/security.ubuntu.com/mirrors.ustc.edu.cn/g'")]),s._v(" /etc/apt/sources.list\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行命令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get update\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("get install gcc libc6"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev git lrzsz "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将go复制解压到容器中")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" go1.10.linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("amd64.tar.gz  /usr/local/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定制环境变量")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" GOROOT=/usr/local/go\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PATH=$PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/local/go/bin\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" GOPATH=/root/go\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PATH=$GOPATH/bin/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$PATH\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载项目")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RUN go get github.com/astaxie/beego")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" astaxie.tar.xz  /root/go/src/github.com\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" test.go /root/go/src/myTest/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定制工作目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /root/go/src/myTest/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8080\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行项目")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"run"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test.go"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n")])])]),n("p",[s._v("最终的文件目录结构")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v(":~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree /docker/compose/")]),s._v("\n/docker/compose/beego/\n├── beego1\n│   └── test.go\n├── beego2\n│   └── test.go\n├── docker-compose.yml\n├── go-base\n│   ├── astaxie.tar.xz\n│   ├── Dockerfile\n│   ├── go1.10.linux-amd64.tar.gz\n│   └── test.go\n└── nginx\n    └── nginx-beego.conf\n\n")])])]),n("p",[s._v("2、任务编排文件")]),s._v(" "),n("p",[s._v("docker-compose.yml文件内容")]),s._v(" "),n("div",{staticClass:"language-yml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9999:80"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./nginx/nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("beego.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/nginx/conf.d/default.conf\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将配置文件映射到nginx的配置文件位置")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("web1\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("go-base")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("base/\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("base"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.1\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("beego-web1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("base"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./beego1/test.go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/root/go/src/myTest/test.go\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10086:8080"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" beego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("web1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("base\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("beego-web2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("base"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v0.1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./beego2/test.go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/root/go/src/myTest/test.go\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10087:8080"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" beego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("web2\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("base\n")])])]),n("p",[s._v("3、 最后测试")]),s._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#构建镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v("-compose build\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动任务")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v("-compose up -d\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看效果")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v("-compose "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#浏览器访问")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".110.5:9999\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);