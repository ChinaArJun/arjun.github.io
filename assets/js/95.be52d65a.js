(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{533:function(t,s,n){"use strict";n.r(s);var a=n(44),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"_10-上传用户头像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-上传用户头像"}},[t._v("#")]),t._v(" 10 上传用户头像")]),t._v(" "),n("p",[t._v("发送（上传）用户头像服务（用户相关）")]),t._v(" "),n("h2",{attrs:{id:"流程与接口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#流程与接口"}},[t._v("#")]),t._v(" 流程与接口")]),t._v(" "),n("p",[n("img",{attrs:{src:"assets/clip_image002-1543152066379.jpg",alt:"img"}})]),t._v(" "),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[t._v("#Request"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\nmethod"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" POST\nurl"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("api/v"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v("/user/avatar\n#data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n图片的二进制数据\n#Response\n#返回成功：\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"errno"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"errmsg"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"成功"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"data"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"avatar_url"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://101.200.170.171:9998/group1/M00/00/00/Zciqq1n6_L-AOB04AADexS5wJKs662.png"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//图片地址需要进行拼接")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n#返回失败：\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"errno"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"400x"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//状态码")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"errmsg"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"状态错误信息"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("fastdfs操纵函数")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" models\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/weilaihui/fdfs_client"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/astaxie/beego"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过文件名的方式进行上传")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UploadByFilename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" filename "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GroupName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("RemoteFileId "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过配置文件创建fdfs操作句柄")]),t._v("\n\tfdfsClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" thiserr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("fdfs_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewFdfsClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/itcast/go/src/go-1/homeweb/conf/client.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" thiserr  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//说一下那里出问题了")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UploadByFilename( ) fdfs_client.NewFdfsClient  err"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tGroupName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\tRemoteFileId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\terr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" thiserr\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//unc (this *FdfsClient) UploadByFilename(filename string) (*UploadFileResponse, error)")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过句柄上传文件（被上传的文件）")]),t._v("\n\n\tuploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" thiserr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" fdfsClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UploadByFilename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" thiserr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UploadByFilename( ) fdfsClient.UploadByFilename(filename)  err"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tGroupName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\tRemoteFileId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\terr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" thiserr\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GroupName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemoteFileId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//回传")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("  uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GroupName "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemoteFileId "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//功能函数 操作fdfs上传二进制文件")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UploadByBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filebuffer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fileExtName "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GroupName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("RemoteFileId "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过配置文件创建fdfs操作句柄")]),t._v("\n\tfdfsClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" thiserr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("fdfs_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewFdfsClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/itcast/go/src/go-1/homeweb/conf/client.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" thiserr  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UploadByBuffer( ) fdfs_client.NewFdfsClient  err"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tGroupName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\tRemoteFileId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\terr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" thiserr\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过句柄上传二进制的文件")]),t._v("\n\tuploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" thiserr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("fdfsClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UploadByBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filebuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fileExtName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" thiserr  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UploadByBuffer( ) fdfs_client.UploadByBuffer  err"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tGroupName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\tRemoteFileId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\terr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" thiserr\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GroupName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemoteFileId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//回传入")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GroupName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemoteFileId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("h2",{attrs:{id:"创建命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建命令"}},[t._v("#")]),t._v(" 创建命令")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ micro new  --type "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"srv"')]),t._v(" sss/PostAvatar\n")])])]),n("p",[t._v("proto")]),t._v(" "),n("div",{staticClass:"language-protobuf extra-class"},[n("pre",{pre:!0,attrs:{class:"language-protobuf"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("service")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Example")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\trpc "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PostAvatar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" returns "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("message")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Message")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" say "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("message")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Request")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//二进制图片")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bytes")]),t._v(" Avatar "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//sessionid")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" Sessionid"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//文件大小")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v(" filesize "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//文件名字")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" filename "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("message")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Response")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//错误码")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" Errno "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//错误信息")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" Errmsg "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//回传的url")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" Avatar_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("web中添加路由")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//上传头像 POST")]),t._v("\nrou"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("POST")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/api/v1.0/user/avatar"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PostAvatar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("web下handle")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//上传用户头像 PostAvatar")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PostAvatar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ResponseWriter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" httprouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"上传用户头像 PostAvatar /api/v1.0/user/avatar"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建服务")]),t._v("\n\tservice "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" grpc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewService")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tservice"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建句柄")]),t._v("\n\texampleClient "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" POSTAVATAR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewExampleService")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"go.micro.srv.PostAvatar"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Client")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//查看登陆信息")]),t._v("\n\tuserlogin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Cookie")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"userlogin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果没有登陆就返回错误")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tresp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"errno"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RECODE_SESSIONERR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"errmsg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RecodeText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RECODE_SESSIONERR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t\tw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// encode and write the response as json")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewEncoder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Encode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\thttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//接收前端发送过来的文集")]),t._v("\n\tfile"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("hander"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("FormFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"avatar"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//判断是否接受成功")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Postupavatar   c.GetFile(avatar) err"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t\tresp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"errno"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RECODE_IOERR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"errmsg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RecodeText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RECODE_IOERR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\tw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// encode and write the response as json")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewEncoder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Encode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\thttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//打印基本信息")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("hander"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"文件大小"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("hander"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"文件名"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("hander"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//二进制的空间用来存储文件")]),t._v("\n\tfilebuffer"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("hander"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将文件读取到filebuffer里")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filebuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Postupavatar   file.Read(filebuffer) err"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tresp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"errno"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RECODE_IOERR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"errmsg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RecodeText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RECODE_IOERR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\tw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// encode and write the response as json")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewEncoder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Encode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\thttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//调用函数传入数据")]),t._v("\n\trsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" exampleClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PostAvatar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("TODO")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("POSTAVATAR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tSessionid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("userlogin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tFilename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("hander"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tFilesize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("hander"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tAvatar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("filebuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\thttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//beego.Debug(err)")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//准备回传数据空间")]),t._v("\n\tdata "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//url拼接然回回传数据")]),t._v("\n\tdata"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"avatar_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("AddDomain2Url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AvatarUrl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n\n\tresp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"errno"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errno"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"errmsg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errmsg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tw"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// encode and write the response as json")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewEncoder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Encode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\thttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("服务端")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Call is a single request handler called via client.Call or the generated client code")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Example"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PostAvatar")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("example"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rsp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("example"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"上传用户头像 PostAvatar /api/v1.0/user/avatar"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化返回正确的返回值")]),t._v("\n\trsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errno "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RECODE_OK\n\trsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errmsg "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RecodeText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errno"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//检查下数据是否正常")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("len")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Avatar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Filesize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*获取文件的后缀名*/")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//dsnlkjfajadskfksda.sadsdasd.sdasd.jpg")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"后缀名"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*存储文件到fastdfs当中并且获取 url*/")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//.jpg")]),t._v("\n\tfileext "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Ext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//group1 group1/M00/00/00/wKgLg1t08pmANXH1AAaInSze-cQ589.jpg")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//上传数据")]),t._v("\n\tGroup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("FileId "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("  models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UploadByBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Avatar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fileext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Postupavatar  models.UploadByBuffer err"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\trsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errno "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RECODE_IOERR\n\t\trsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errmsg "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RecodeText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errno"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*通过session 获取我们当前现在用户的uesr_id*/")]),t._v("\n\tredis_config_map "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"key"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("G_server_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//"conn":"127.0.0.1:6379",')]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"conn"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("G_redis_addr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('":"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("G_redis_port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dbNum"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("G_redis_dbnum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("redis_config_map"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tredis_config "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Marshal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("redis_config_map"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("redis_config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//连接redis数据库 创建句柄")]),t._v("\n\tbm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" cache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewCache")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("redis_config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"缓存创建失败"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\trsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errno  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RECODE_DBERR\n\t\trsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errmsg  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RecodeText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errno"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//拼接key")]),t._v("\n\tsessioniduserid "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("  req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Sessionid "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user_id"')]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获得当前用户的userid")]),t._v("\n\tvalue_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("bm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sessioniduserid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("reflect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("TypeOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n\tid "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("reflect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("TypeOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建表对象")]),t._v("\n\tuser "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("Avatar_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("FileId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*将当前fastdfs-url 存储到我们当前用户的表中*/")]),t._v("\n\to"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("orm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewOrm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将图片的地址存入表中")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("o"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"avatar_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t\trsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errno "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RECODE_DBERR\n\t\trsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errmsg "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RecodeText")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Errno"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//回传图片地址")]),t._v("\n\trsp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AvatarUrl"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("FileId\n\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"使用fastdfs-nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用fastdfs-nginx"}},[t._v("#")]),t._v(" 使用fastdfs+nginx")]),t._v(" "),n("h3",{attrs:{id:"fastdfs安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#fastdfs安装"}},[t._v("#")]),t._v(" fastdfs安装")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装libevent")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#解压 ")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" zxvf libevent-2.1.8-stable.tar.gz \n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" libevent-2.1.8-stable/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#检查 ")]),t._v("\n$ ./configure\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编译")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#检查安装是否成功 ")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" -al /usr/local/lib/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" libevent\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#防止在系统默认路径下 找不到库文件")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /usr/local/lib/libevent-2.1.so.6 /usr/lib/libevent-2.1.so.6\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装libfastcommon")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("unzip")]),t._v(" libfastcommon-1.36.zip \n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" libfastcommon-master/\n$ ./make.sh\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" ./make.sh "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装fastdfs")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#解压")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf fastdfs-5.10.tar.gz \n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" fastdfs-5.10/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编译")]),t._v("\n$ ./make.sh \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" ./make.sh "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#验证")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" -al /usr/bin/fdfs*\n$ fdfs_test\n")])])]),n("h3",{attrs:{id:"配置-fastdfs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-fastdfs"}},[t._v("#")]),t._v(" 配置 fastdfs")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认的配置文件地址在/etc/fdfs下")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#因为我们的项目需要")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#所以我们需要将配置文件拷贝到我们的conf文件夹下进配置")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /etc/fdfs\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v("  client.conf.sample  storage.conf.sample  tracker.conf.sample "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$GOPATH")]),t._v("/src/sss/Ihomeweb/conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将配置文件的名字进行下修改")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#客户端")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" client.conf.sample  client.conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#存储文件")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" storage.conf.sample  storage.conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#跟踪器")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" tracker.conf.sample  tracker.conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#准备文件夹在项目下创建文件夹")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /home/itcast/go/src/sss\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" fastdfs \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#在fastdfs下创建四个文件夹 ")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" fastdfs\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" tracker client storage storage_data\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##配置tracker.conf")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#6行的ip地址设置")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# bind an address of this host")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# empty for bind all addresses of this host")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("bind_addr")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".110.123（需要配置的ip）\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#21行的的log日志设置")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the base path to store data and log files")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("base_path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/itcast/go/src/sss/fastdfs/tracker（log目录）\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##配置storage.conf")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#13行配置ip")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# bind an address of this host")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# empty for bind all addresses of this host")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("bind_addr")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".110.123\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#40行的log日志设置")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the base path to store data and log files")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("base_path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/itcast/go/src/sss/fastdfs/storage（log目录）\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#107行的文件存放设置")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# store_path#, based 0, if store_path0 not exists, it's value is base_path")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the paths must be exist")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("store_path0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/itcast/go/src/sss/fastdfs/storage_data（文件存放路径）\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#store_path1=/home/yuqing/fastdfs2")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#116行tracker的ip地址")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tracker_server can ocur more than once, and tracker_server format is")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#  "host:port", host can be hostname or ip address')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("tracker_server")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".110.7:22122\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##配置client.conf日志")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#9行的log日志地址")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the base path to store log files")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("base_path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/itcast/go/src/sss/fastdfs/client（log目录）\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#12行追踪器的ip")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tracker_server can ocur more than once, and tracker_server format is")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#  "host:port", host can be hostname or ip address')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("tracker_server")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".110.123:22122\n\n更新项目目录下的的setup_server.sh文件\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动redis服务")]),t._v("\nredis-server ./conf/redis.conf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动trackerd")]),t._v("\n\nfdfs_trackerd  /home/itcast/go/src/sss/homeweb/conf/tracker.conf restart\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动storaged")]),t._v("\n\nfdfs_storaged  /home/itcast/go/src/sss/homeweb/conf/storage.conf restart\n\n我们先测试下 \nFdfs_upload_file ./conf/client.conf cj.jpg\n\n")])])]),n("h3",{attrs:{id:"安装步骤nginx操作fast步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装步骤nginx操作fast步骤"}},[t._v("#")]),t._v(" 安装步骤nginx操作fast步骤")]),t._v(" "),n("h4",{attrs:{id:"关于nginx操作fastdfs的插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关于nginx操作fastdfs的插件"}},[t._v("#")]),t._v(" 关于nginx操作fastdfs的插件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将事先准备好的fastdfs的插件拷贝到ubuntu中")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#解压nginx关于fastdfs的插件")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf fastdfs-nginx-module_v1.16.tar.gz \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看当前目录下存在两个解压好的文件")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nfastdfs-nginx-module    nginx-1.10.1  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入fastdfs-nginx-module")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" fastdfs-nginx-module\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看当前文件夹下文件")]),t._v("\n$ tree\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n├── HISTORY\n├── INSTALL\n└── src\n    ├── common.c\n    ├── common.h\n    ├── config\n    ├── mod_fastdfs.conf\n    └── ngx_http_fastdfs_module.c\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看INSTALL文件")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" INSTALL\n")])])]),n("h4",{attrs:{id:"关于fastdfs插件的安装介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关于fastdfs插件的安装介绍"}},[t._v("#")]),t._v(" 关于fastdfs插件的安装介绍")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("版权所有 2010开心鱼 / 余庆\n这个软件只能在GNU通用条款下被复制\n公共许可证V3，请访问FastDFS主页以获得更多详细信息。\n英语:http://english.csource.org/\n中文:http://www.csource.org/\n\n#步骤1.首先安装FastDFS存储服务器和客户端库，\nFastDFS版本应该是>= 2.09。下载地址:\nhttps://code.google.com/p/fastdfs/downloads/list\n\n#步骤2.安装nginx服务器\nFastDFS nginx模块测试通过nginx 0.8.53，\n我的nginx安装在/usr/local/nginx\n\n#步骤3.下载FastDFS nginx模块源代码包并解压，如:\ntar xzf fastdfs_nginx_module_v1.16.tar.gz\n\n#步骤4.输入nginx源目录，编译并安装模块，如:\ncd nginx-1.5.12\n./configure --add-module=/home/yuqing/fastdfs-nginx-module/src\nmake; make install\n\n注意:在编译之前，你可以更改FDFS_OUTPUT_CHUNK_SIZE和\nFDFS_MOD_CONF_FILENAME的宏定义在配置文件中:\n\nCFLAGS=\"$CFLAGS -D_FILE_OFFSET_BITS=64 -DFDFS_OUTPUT_CHUNK_SIZE='256*1024' -DFDFS_MOD_CONF_FILENAME='\\\"/etc/fdfs/mod_fastdfs.conf\\\"'\"\n\n\n\n#步骤5.配置nginx配置文件，例如nginx.conf，添加以下行:\n\n        location /M00 {\n            root /home/yuqing/fastdfs/data;\n            ngx_fastdfs_module;\n        }\n\n#步骤6.将一个符号链接${fastdfs_base_path}/data/M00到${fastdfs_base_path}/data，\n\n命令行，例如:\nln -s /home/yuqing/fast /data/ home/yuqing/fast /data/ m00\n\n#步骤7.更改配置文件/etc/fdfs/mod_fastdfs.conf，更多细节请看\n\n#步骤8.重新启动nginx服务器，例如:\n/usr/local/nginx/sbin/nginx -s stop; /usr/local/nginx/sbin/nginx\n")])])]),n("h4",{attrs:{id:"修改fastdfs插件安装的配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改fastdfs插件安装的配置文件"}},[t._v("#")]),t._v(" 修改fastdfs插件安装的配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入到插件的src目录下")]),t._v("\n$ cd/home/itcast/ffdfs/fastdfs-nginx-module/src\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改config配置文件")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" config\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CORE_INCS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$CORE_INCS")]),t._v(' /usr/local/include/fastdfs /usr/local/include/fastcommon/"')]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改为:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CORE_INCS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$CORE_INCS")]),t._v(' /usr/include/fastdfs /usr/include/fastcommon/"')]),t._v("\n")])])]),n("h4",{attrs:{id:"nginx的安装依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx的安装依赖"}},[t._v("#")]),t._v(" nginx的安装依赖")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#讲准备好的依赖文件拷贝到ubuntu中")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#依次解压依赖")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf openssl-1.0.1t.tar.gz \n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf zlib-1.2.11.tar.gz\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -jxvf pcre-8.40.tar.bz2 \n \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入openssl-1.0.1t")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" openssl-1.0.1t\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#检查")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" ./config\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编译")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入zlib-1.2.11")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" zlib-1.2.11\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#检查")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" ./configure\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编译")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入pcre-8.40")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" pcre-8.40\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#检查")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" ./configure\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编译")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])]),n("h4",{attrs:{id:"nginx正规联合编译方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx正规联合编译方法"}},[t._v("#")]),t._v(" nginx正规联合编译方法")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将事先准备好的nginx安装包拷贝到ubuntu中 ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#解压nginx压缩包")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf nginx-1.10.1.tar.gz \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入nginx")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /home/itcast/ffdfs/nginx-1.10.1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进行nginx和fastdfs插件的联合编译")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#检查")]),t._v("\n$ ./configure --with-openssl"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("openssl源码目录 --with-pcre"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("pcre的源码目录 --with-zlib"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("zlib  --add-module"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("插件src目录\n\n$ ./configure --with-openssl"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/itcast/openssl-1.0.1t --with-pcre"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/itcast/pcre-8.40 --with-zlib"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/itcast/zlib-1.2.11 --with-http_ssl_module  --add-module"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/itcast/fastdfs-nginx-module_v1.16/fastdfs-nginx-module/src \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编译")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建软连接方便调用")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /usr/local/nginx/sbin/nginx /usr/bin/nginx\n")])])]),n("h5",{attrs:{id:"注意1：找不到sha1的库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意1：找不到sha1的库"}},[t._v("#")]),t._v(" 注意1：找不到sha1的库")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("#在nginx 下执行 ./configure后最近结果显示会出现如下问题\nsha1 library is not found\n#找不到sha1的库\n#configure的时候增加参数 --with-http_ssl_module\n")])])]),n("h5",{attrs:{id:"注意2：编译异常"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意2：编译异常"}},[t._v("#")]),t._v(" 注意2：编译异常")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#在 make时出现如下问题")]),t._v("\nsrc/core/ngx_murmurhash.c: In "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" ‘ngx_murmur_hash2’:\nsrc/core/ngx_murmurhash.c:37:11: error: this statement may fall through "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-Werror"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("implicit-fallthrough"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n         h ^"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         ~~^~~~~~~~~~~~~~~~\nsrc/core/ngx_murmurhash.c:38:5: note: here\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(":\n     ^~~~\nsrc/core/ngx_murmurhash.c:39:11: error: this statement may fall through "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-Werror"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("implicit-fallthrough"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n         h ^"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         ~~^~~~~~~~~~~~~~~\nsrc/core/ngx_murmurhash.c:40:5: note: here\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":\n     ^~~~\ncc1: all warnings being treated as errors\nobjs/Makefile:485: recipe "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" target "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'objs/src/core/ngx_murmurhash.o'")]),t._v(" failed\nmake"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": *** "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("objs/src/core/ngx_murmurhash.o"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Error "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nmake"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": 离开目录“/home/itcast/ffdfs/nginx-1.10.1”\nMakefile:8: recipe "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" target "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),t._v(" failed\nmake: *** "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Error "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#主要原因是 Makefile 里面  gcc 的参数多了一个"-Werror"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入到/home/itcast/ffdfs/nginx-1.10.1/objs中修改Makefile")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" Makefile \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#删除"-Werror"得到如下内容')]),t._v("\nCFLAGS "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  -pipe  -O -W -Wall -Wpointer-arith -Wno-unused  -g  -D_FILE_OFFSET_BITS"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" -DFDFS_OUTPUT_CHUNK_SIZE"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'256*1024'")]),t._v(" -DFDFS_MOD_CONF_FILENAME"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\"/etc/fdfs/mod_fastdfs.conf\"'")]),t._v("\n\n")])])]),n("h5",{attrs:{id:"注意3：插件配置文件不存在"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意3：插件配置文件不存在"}},[t._v("#")]),t._v(" 注意3：插件配置文件不存在")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#联合编译安装好nginx后启动nginx如下效果发现只有1个进程")]),t._v("\n$ nginx \n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" aux"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" aux "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx \nroot  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("105455")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看 /usr/local/nginx/logs 目录下的日志 ")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /usr/local/nginx/logs/error.log\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#发现这样一条错误")]),t._v("\nERROR - file: shared_func.c, line: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("968")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/fdfs/mod_fastdfs.conf not exist\n错误 - 文件 :shared_func.c "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("968")]),t._v("行 访问 /etc/fdfs/mod_fastdfs.conf 不存在 \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#确认下文件是否存在")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /etc/fdfs/\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nclient.conf.sample  storage.conf.sample  storage_ids.conf.sample  tracker.conf.sample\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#确实不存在")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#解决")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#需要从fastdfs源码目录中复制过来")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /home/itcast/ffdfs/fastdfs-nginx-module/src\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将mod_fastdfs.conf 文件从当前目录下拷贝到/etc/fdfs/目录下")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /home/itcast/ffdfs/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/\n")])])]),n("h5",{attrs:{id:"注意4：配置文件修改"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意4：配置文件修改"}},[t._v("#")]),t._v(" 注意4：配置文件修改")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改fastdfs插件的配置文件进行修改，参数当前存储节点的storage.conf进行修改")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入到/etc/fdfs/目录")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /etc/fdfs/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑 mod_fastdfs.conf 文件")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" mod_fastdfs.conf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 存储log日志的目录")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the base path to store log files")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("base_path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/itcast/go/src/sss/fastdfs/storage\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 追踪器的地址信息")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("37")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# FastDFS tracker_server can ocur more than once, and tracker_server format is")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("38")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#  "host:port", host can be hostname or ip address')]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("39")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# valid only when load_fdfs_parameters_from_tracker is true")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("40")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("tracker_server")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".110.20:22122\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当前存储节点监听的端口")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the port of the local storage server")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("43")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the default value is 23000")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("44")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("storage_server_port")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("23000")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当前存储节点所属的组")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("46")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the group name of the local storage server")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("47")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("group_name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("group1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 客户端访问的url中是不是出现组名")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("49")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# if the url / uri including the group name")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# set to false when uri like /M00/00/00/xxx")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# set to true when uri like ${group_name}/M00/00/00/xxx, such as group1/M00/xxx")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# default value is false")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),t._v(" url_have_group_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当前存储节点存储路径的个数 参照 storage.conf")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("55")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# path(disk or mount point) count, default value is 1")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# must same as storage.conf")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("57")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("store_path_count")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 详细的存储路径")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("59")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# store_path#, based 0, if store_path0 not exists, it's value is base_path")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the paths must be exist")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("61")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# must same as storage.conf")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("62")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("store_path0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/home/itcast/go/src/sss/fastdfs/storage_data\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#完成修改后再次启动nginx 依然是1个nginx进程")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" nginx \n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" aux "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx \nroot  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("106838")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("31384")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("764")]),t._v(" ?    Ss "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":09   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00 nginx: master process nginx\nitcast "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("106841")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("21536")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1048")]),t._v(" pts/15  S+ "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":09   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00 "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" --color"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("auto nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看日志")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /usr/local/nginx/logs/error.log\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#发现新的错误")]),t._v("\nERROR - file: ini_file_reader.c, line: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("631")]),t._v(", include "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http.conf"')]),t._v(" not exists, line: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#include http.conf"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#那么说明我们的配置文件就改好了")]),t._v("\n")])])]),n("h5",{attrs:{id:"注意5：新的错误"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意5：新的错误"}},[t._v("#")]),t._v(" 注意5：新的错误")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#上面我们查看了新的日志发现了新的错误")]),t._v("\nERROR - file: ini_file_reader.c, line: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("631")]),t._v(", include "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http.conf"')]),t._v(" not exists, line: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#include http.conf"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#错误 -文件 ：ini_file_reader.c 的第631行 导入文件的 http.conf 不存在")]),t._v("\n\t- 原因是从/etc/fdfs下加载该http.conf文件没找到\n\t- 从fastdfs的源码安装目录中找\n\t- fastdfs源码安装目录/conf/http.conf\n\t- "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" fastdfs源码安装目录/conf/http.conf /etc/fdfs\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" ./http.conf /etc/fdfs/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入etc下验证是否成功")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /etc/fdfs/\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nclient.conf.sample  http.conf  mod_fastdfs.conf  storage.conf.sample  storage_ids.conf.sample  tracker.conf.sample\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#停掉之前启动的nginx")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" nginx -s stop \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看是否停止")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" aux "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx \nitcast "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("107419")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("21536")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1040")]),t._v(" pts/15 S+ 09:36  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00 "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" --color"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("auto nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动新的nginx")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" nginx \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看还是1个线程")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" aux "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx \nroot   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("107422")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("31384")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("760")]),t._v(" ?      Ss  09:36  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00 nginx: master process nginx\nitcast "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("107425")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("21536")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1048")]),t._v(" pts/15 S+  09:36  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00 "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" --color"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("auto nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#发现还是有错误所以我们再次查看日志")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /usr/local/nginx/logs/error.log\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#又一次出现了新的错误")]),t._v("\nERROR - file: shared_func.c, line: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("968")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" /etc/fdfs/mime.types not exist\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#说明我们http.conf的错误已经解决了")]),t._v("\n")])])]),n("h5",{attrs:{id:"注意6：找不到文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意6：找不到文件"}},[t._v("#")]),t._v(" 注意6：找不到文件")]),t._v(" "),n("div",{staticClass:"language-SHELL extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ERROR - file: shared_func.c, line: 968, file /etc/fdfs/mime.types not exist")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#错误 - file ： shared_func.c 文件的 第968 行 不能找到 /etc/fdfs/mime.types")]),t._v("\n- 从nginx的源码安装目录中找\n- nginx源码安装目录/conf/mime.types\n- "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" nginx源码安装目录/conf/mime.types /etc/fdfs\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#找到nginx源码安装目录的文件")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /home/itcast/ffdfs/nginx-1.10.1/conf\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\nfastcgi.conf  fastcgi_params  koi-utf  koi-win  mime.types  nginx.conf  scgi_params  uwsgi_params  win-utf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#发现文件存在后将其拷贝到/etc/fdfs")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" ./mime.types  /etc/fdfs/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#再次验证是否成功")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#停掉之前启动的nginx")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" nginx -s stop \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看是否停止")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" aux "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx \nitcast "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("107488")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("21536")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1092")]),t._v(" pts/15  S+  09:52  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00 "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" --color"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("auto nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动nginx")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" nginx\nitcast@itcast-virtual-machine:~/ffdfs/nginx-1.10.1/conf$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" aux "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx \nroot   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("107491")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("31384")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("764")]),t._v(" ?     Ss  09:53  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00 nginx: master process nginx\nnobody "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("107492")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("36212")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4016")]),t._v(" ?      S   09:53  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00 nginx: worker process\nitcast "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("107494")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("21536")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1152")]),t._v(" pts/15 S+  09:53  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":00 "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" --color"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("auto nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#发现已经出现了worker的进程说明我们的nginx安装环境算是成功了")]),t._v("\n")])])]),n("h5",{attrs:{id:"注意7：可能出现的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意7：可能出现的问题"}},[t._v("#")]),t._v(" 注意7：可能出现的问题")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#可能出现的问题")]),t._v("\nline: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("177")]),t._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Permission denied"')]),t._v(" can't be accessed\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#没有权限访问")]),t._v("\n    - 修改nginx.conf, 将worker进程的所有者改为root\n    - user root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h4",{attrs:{id:"修改nginx的访问配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改nginx的访问配置文件"}},[t._v("#")]),t._v(" 修改nginx的访问配置文件")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#我们在虚拟机中访问我们的资源图片")]),t._v("\nhttp://127.0.0.1/group1/M00/00/00/wKhuFFuRWriATb4DAADprYlRZN0624.jpg\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#会出现如下效果")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:"assets/%5CUsers%5Ckstwo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1537322430259.png",alt:"1537322430259"}})]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#此时我们需要再次访问我们的日志文件")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /usr/local/nginx/logs/error.log\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# open() "/usr/local/nginx/html/group1/M00/00/00/wKhuFFuRWriATb4DAADprYlRZN0624.jpg" failed (2: No such file or directory), client: 127.0.0.1, server: localhost, request: "GET /group1/M00/00/00/wKhuFFuRWriATb4DAADprYlRZN0624.jpg HTTP/1.1", host: "127.0.0.1"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#打开图片文件失败（没有这样的文件或者是目录） 客户端是 127.0.0.1 服务器是localhost ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#发送请求"GET /group1/M00/00/00/wKhuFFuRWriATb4DAADprYlRZN0624.jpg HTTP/1.1" ')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#主机127.0.0.1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#为什么是404？")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#nginx在解析客户端请求的时查找的资源目录是不对的，所以找不到我们想要的文件 ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#所以我们需要给nginx制定争取的目录")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#nginx 处理 http://127.0.0.1/group1/M00/00/00/wKhuFFuRWriATb4DAADprYlRZN0624.jpg")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#去掉ip与文件名，得到 /group1/M00/00/00/")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#需要给修改nginx的配置文件添加location处理指令\t")]),t._v("\n\tlocation /group1/M00/00/00/\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定正确的资源路径")]),t._v("\n        root /root/fdfs/storage/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" // M00映射的实际路径\n        ngx_fastdfs_module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加nginx对fastdfs模块的调用")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\n\t\n\t\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入nginx的配置文件目录下")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /usr/local/nginx/conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#备份 nginx.conf")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" nginx.conf nginx.conf.old\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑nginx.conf")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" nginx.conf \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改内容为")]),t._v("\n\tlisten       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location  /group1/M00/ {")]),t._v("\n    location  ~/group"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("-9"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("/M00 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#正确的数据路径")]),t._v("\n        root   /home/itcast/go/src/sss/fastdfs/storage_data/data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ngx_fastdfs_module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加nginx对fastdfs模块的调用")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改好文件之后加载文件则会出现1个新的进程就是这个插件的进程")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" nginx -s reload\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("sudo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" itcast 的密码： \nngx_http_fastdfs_set "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("pid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("107791")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改app.conf文件添加配置信息")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#成功之后我们再次访问图片")]),t._v("\nhttp://127.0.0.1:8888/group1/M00/00/00/wKhuFFuRWriATb4DAADprYlRZN0624.jpg\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#会出现以下效果")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:"assets/%5CUsers%5Ckstwo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1537328504896.png",alt:"1537328504896"}})]),t._v(" "),n("h2",{attrs:{id:"go操作fastdfs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#go操作fastdfs"}},[t._v("#")]),t._v(" go操作fastdfs")]),t._v(" "),n("p",[t._v("安装库")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("go get github.com/weilaihui/fdfs_client\n")])])]),n("p",[t._v("在models中创建fastdfs_client.go")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" models\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/weilaihui/fdfs_client"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/astaxie/beego"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过文件名的方式进行上传")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UploadByFilename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" filename "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GroupName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("RemoteFileId "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过配置文件创建fdfs操作句柄")]),t._v("\n\tfdfsClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" thiserr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("fdfs_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewFdfsClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/itcast/go/srcsss/homeweb/conf/client.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" thiserr  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//说一下那里出问题了")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UploadByFilename( ) fdfs_client.NewFdfsClient  err"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tGroupName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\tRemoteFileId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\terr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" thiserr\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//unc (this *FdfsClient) UploadByFilename(filename string) (*UploadFileResponse, error)")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过句柄上传文件（被上传的文件）")]),t._v("\n\n\tuploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" thiserr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" fdfsClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UploadByFilename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" thiserr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UploadByFilename( ) fdfsClient.UploadByFilename(filename)  err"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tGroupName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\tRemoteFileId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\terr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" thiserr\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GroupName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemoteFileId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//回传")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("  uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GroupName "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemoteFileId "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//功能函数 操作fdfs上传二进制文件")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UploadByBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filebuffer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fileExtName "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GroupName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("RemoteFileId "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过配置文件创建fdfs操作句柄")]),t._v("\n\tfdfsClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" thiserr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("fdfs_client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewFdfsClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/itcast/go/src/sss/homeweb/conf/client.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" thiserr  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UploadByBuffer( ) fdfs_client.NewFdfsClient  err"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tGroupName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\tRemoteFileId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\terr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" thiserr\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过句柄上传二进制的文件")]),t._v("\n\tuploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" thiserr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v("fdfsClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UploadByBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filebuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fileExtName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" thiserr  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UploadByBuffer( ) fdfs_client.UploadByBuffer  err"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tGroupName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\tRemoteFileId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\terr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" thiserr\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GroupName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tbeego"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemoteFileId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//回传")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GroupName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("uploadResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RemoteFileId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);